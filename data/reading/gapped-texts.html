
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTUITY - Reading Part 6</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Dynamic color system - updates per test */
            --bg-primary: #1a2332;
            --bg-secondary: #243447;
            --card-bg: rgba(255, 255, 255, 0.08);
            --card-border: rgba(255, 255, 255, 0.12);
            --accent-gold: #f4a261;
            --accent-teal: #2dd4bf;
            --constellation-color: #66bb6a;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --success: #10b981;
            --success-bright: #34d399;
            --error: #ef4444;
            --error-bright: #fb923c;
            --badge-bg: rgba(45, 212, 191, 0.2);
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            
            /* Effects */
            --blur: blur(20px);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Constellation Background */
        .constellation-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--constellation-color);
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }
        
        .star:nth-child(even) {
            animation-delay: 1.5s;
            background: var(--accent-teal);
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }
        
        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(26, 35, 50, 0.9);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-bottom: 1px solid var(--card-border);
            padding: var(--space-md) var(--space-lg);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            text-align: left;
        }
        
        .brand-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-gold);
            letter-spacing: -0.02em;
        }
        
        .exercise-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .nav-buttons {
            display: flex;
            gap: var(--space-sm);
        }
        
        .nav-btn {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            padding: var(--space-sm) var(--space-md);
            border-radius: 0.75rem;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-teal);
            transform: translateY(-2px);
        }
        
        .nav-btn.primary {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-gold));
            color: var(--bg-primary);
            border: none;
        }
        
        /* Main Container */
        .main-container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--space-xl);
        }
        
        /* Reading Area */
        .reading-area {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--card-border);
            border-radius: 1.5rem;
            padding: var(--space-xl);
            box-shadow: var(--shadow);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--card-border);
        }
        
        .test-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: var(--space-sm);
        }
        
        .test-category {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
        }
        
        .test-instructions {
            background: rgba(45, 212, 191, 0.1);
            border: 1px solid rgba(45, 212, 191, 0.3);
            border-radius: 0.75rem;
            padding: var(--space-md);
            font-size: 0.85rem;
            line-height: 1.6;
        }
        
        /* Passage Styling */
        .passage-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            line-height: 1.8;
            font-size: 1.05rem;
        }
        
        .passage-text {
            color: var(--text-primary);
            white-space: pre-line;
        }
        
        /* Gap Styling */
        .gap {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 2.5rem;
            height: 2.5rem;
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 2px solid var(--accent-teal);
            border-radius: 50%;
            margin: 0 var(--space-sm);
            padding: 0 var(--space-md);
            color: var(--accent-teal);
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            max-width: 8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .gap:hover {
            background: rgba(45, 212, 191, 0.2);
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(45, 212, 191, 0.3);
        }
        
        .gap.filled {
            border-color: var(--accent-gold);
            background: rgba(244, 162, 97, 0.2);
            color: var(--accent-gold);
            border-radius: 1.25rem;
            min-width: 3rem;
        }
        
        .gap.correct {
            border-color: var(--success-bright);
            background: rgba(52, 211, 153, 0.3);
            color: var(--success-bright);
            font-weight: 700;
        }
        
        .gap.incorrect {
            border-color: var(--error-bright);
            background: rgba(251, 146, 60, 0.3);
            color: var(--error-bright);
            font-weight: 700;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        
        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }
        
        /* Progress Card */
        .progress-card {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            padding: var(--space-lg);
            box-shadow: var(--shadow);
        }
        
        .progress-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--space-sm);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--constellation-color), var(--accent-gold));
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* Options Card */
        .options-card {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            padding: var(--space-lg);
            box-shadow: var(--shadow);
            flex-grow: 1;
        }
        
        .options-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: var(--space-lg);
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .option-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .option-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-teal);
        }
        
        .option-item.selected {
            background: rgba(244, 162, 97, 0.2);
            border-color: var(--accent-gold);
            border-width: 2px;
        }
        
        .option-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--accent-teal);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: 700;
            margin-right: var(--space-sm);
            font-size: 0.8rem;
        }
        
        .option-item.selected .option-letter {
            background: var(--accent-gold);
        }
        
        .option-text {
            display: inline;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        /* Control Buttons */
        .controls {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-lg);
        }
        
        .btn {
            flex: 1;
            background: var(--accent-teal);
            border: none;
            color: white;
            padding: var(--space-md) var(--space-lg);
            border-radius: 0.75rem;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }
        
        .btn:hover {
            background: var(--accent-gold);
            transform: translateY(-2px);
        }
        
        .btn.primary {
            background: var(--constellation-color);
        }
        
        .btn.primary:hover {
            filter: brightness(1.1);
        }
        
        .btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Test Navigation */
        .test-nav {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            padding: var(--space-lg);
            box-shadow: var(--shadow);
        }
        
        .test-nav-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .test-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-xs);
        }
        
        .test-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            padding: var(--space-sm);
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-teal);
        }
        
        .test-btn.active {
            background: var(--constellation-color);
            border-color: var(--constellation-color);
            color: white;
        }
        
        /* Loading State */
        .loading-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--text-secondary);
        }
        
        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-teal);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: var(--space-md);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: var(--space-lg);
                padding: var(--space-lg) var(--space-md);
            }
            
            .sidebar {
                order: -1;
            }
            
            .reading-area {
                padding: var(--space-lg);
            }
            
            .passage-container {
                padding: var(--space-lg);
                font-size: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: var(--space-sm);
                text-align: center;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .test-selector {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Constellation Background -->
    <div class="constellation-bg" id="constellation"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="brand-name">INTUITY</div>
                <div class="exercise-info" id="exercise-info">Reading - Part 6</div>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" id="repeat-btn">
                    <i class="fas fa-redo"></i> REPEAT
                </button>
                <button class="nav-btn" id="return-btn">
                    <i class="fas fa-arrow-left"></i> RETURN
                </button>
                <button class="nav-btn primary" id="next-btn">
                    NEXT <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Reading Area -->
        <main class="reading-area">
            <!-- Loading State -->
            <div class="loading-state" id="loading-state">
                <div class="spinner"></div>
                <p>Loading reading passage...</p>
            </div>
            
            <!-- Test Content -->
            <div id="test-content" style="display: none;">
                <!-- Test Header -->
                <div class="test-header">
                    <h1 class="test-title" id="test-title">Loading...</h1>
                    <p class="test-category" id="test-category">Category</p>
                    <div class="test-instructions">
                        <strong>Instructions:</strong> You are going to read a text with gaps. Choose the sentence (A-G) which best fits each gap. There is one extra sentence which you do not need to use.
                    </div>
                </div>
                
                <!-- Passage -->
                <div class="passage-container">
                    <div class="passage-text" id="passage-text">Loading passage...</div>
                </div>
            </div>
        </main>
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Progress Card -->
            <div class="progress-card">
                <h3 class="progress-title">
                    <i class="fas fa-chart-line"></i> Progress
                </h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p class="progress-text">
                    <span id="completed-count">0</span> of <span id="total-gaps">6</span> gaps filled
                </p>
            </div>
            
            <!-- Test Navigation -->
            <div class="test-nav">
                <h3 class="test-nav-title">
                    <i class="fas fa-list"></i> Tests
                </h3>
                <div class="test-selector" id="test-selector">
                    <!-- Test buttons populated by JavaScript -->
                </div>
            </div>
            
            <!-- Options Card -->
            <div class="options-card">
                <h3 class="options-title">
                    <i class="fas fa-puzzle-piece"></i> Choose from:
                </h3>
                <div id="options-list">
                    <!-- Options populated by JavaScript -->
                </div>
                
                <!-- Controls -->
                <div class="controls">
                    <button class="btn" id="check-btn" disabled>
                        <i class="fas fa-check"></i> Check
                    </button>
                    <button class="btn primary" id="reset-btn">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                </div>
            </div>
        </aside>
    </div>
    
    <script>
        // Global variables
        let currentTestId = 1;
        let currentTestData = null;
        let testConfig = null;
        let userAnswers = {};
        let selectedOption = null;
        let selectedGap = null;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            createConstellation();
            loadTestConfig();
            setupEventListeners();
        });
        
        // Create constellation background
        function createConstellation() {
            const constellation = document.getElementById('constellation');
            for (let i = 0; i < 25; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                constellation.appendChild(star);
            }
        }
        
        // Load test configuration
        async function loadTestConfig() {
            try {
                const response = await fetch('../../data/test-config.json');
                testConfig = await response.json();
                
                createTestSelector();
                loadTest(currentTestId);
            } catch (error) {
                console.error('Error loading test config:', error);
                showError('Failed to load test configuration');
            }
        }
        
        // Create test selector buttons
        function createTestSelector() {
            const selector = document.getElementById('test-selector');
            selector.innerHTML = '';
            
            testConfig.tests.forEach(test => {
                const btn = document.createElement('button');
                btn.className = 'test-btn';
                btn.textContent = test.id;
                btn.onclick = () => loadTest(test.id);
                
                if (test.id === currentTestId) {
                    btn.classList.add('active');
                }
                
                selector.appendChild(btn);
            });
        }
        
        // Load specific test
        async function loadTest(testId) {
            try {
                document.getElementById('loading-state').style.display = 'block';
                document.getElementById('test-content').style.display = 'none';
                
                currentTestId = testId;
                
                // Load test data
                const response = await fetch(`../../data/passages/test_${String(testId).padStart(2, '0')}_${getTestSlug(testId)}.json`);
                currentTestData = await response.json();
                
                // Get test config
                const testInfo = testConfig.tests.find(t => t.id === testId);
                
                // Update UI theme based on test
                updateTheme(testInfo.constellation);
                
                // Display test
                displayTest(testInfo);
                
                // Reset state
                userAnswers = {};
                selectedOption = null;
                selectedGap = null;
                
                // Update UI
                updateTestSelector();
                updateProgress();
                
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('test-content').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading test:', error);
                showError('Failed to load test data');
            }
        }
        
        // Get test slug from ID
        function getTestSlug(testId) {
            const slugs = {
                1: 'blind_runner',
                2: 'hollywood_sign', 
                3: 'music_running',
                4: 'grand_prix_driver',
                5: 'video_games',
                6: 'standup_comedy',
                7: 'guinness_records',
                8: 'messages_bottles'
            };
            return slugs[testId] || 'test';
        }
        
        // Update theme colors
        function updateTheme(constellation) {
            const root = document.documentElement;
            root.style.setProperty('--constellation-color', constellation.starColor);
            
            if (constellation.bgGradient) {
                const gradient = `linear-gradient(135deg, ${constellation.bgGradient[0]} 0%, ${constellation.bgGradient[1]} 100%)`;
                document.body.style.background = gradient;
            }
        }
        
        // Display test content
        function displayTest(testInfo) {
            document.getElementById('test-title').textContent = currentTestData.title;
            document.getElementById('test-category').textContent = testInfo.category;
            
            // Process passage with gaps
            let passage = currentTestData.passage;
            
            // Replace gap placeholders with clickable elements
            passage = passage.replace(/<span class='gap' data-gap='(\d+)'>\[(\d+)\]<\/span>/g, 
                (match, gapNum, displayNum) => {
                    return `<span class="gap" data-gap="${gapNum}" onclick="selectGap(${gapNum})">${displayNum}</span>`;
                });
            
            document.getElementById('passage-text').innerHTML = passage;
            
            // Display options
            displayOptions();
            
            // Update total gaps counter
            document.getElementById('total-gaps').textContent = currentTestData.answers.length;
        }
        
        // Display options
        function displayOptions() {
            const optionsList = document.getElementById('options-list');
            optionsList.innerHTML = '';
            
            currentTestData.options.forEach((option, index) => {
                const letter = String.fromCharCode(65 + index); // A, B, C, etc.
                
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-item';
                optionDiv.onclick = () => selectOption(letter, index);
                
                optionDiv.innerHTML = `
                    <span class="option-letter">${letter}</span>
                    <span class="option-text">${option}</span>
                `;
                
                optionsList.appendChild(optionDiv);
            });
        }
        
        // Select option
        function selectOption(letter, index) {
            // Clear previous selection
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Select new option
            event.target.closest('.option-item').classList.add('selected');
            selectedOption = { letter, index };
            
            // If gap is selected, fill it
            if (selectedGap) {
                fillGap();
            }
        }
        
        // Select gap
        function selectGap(gapNumber) {
            // Clear previous gap selection
            document.querySelectorAll('.gap').forEach(gap => {
                gap.style.boxShadow = '';
            });
            
            // Highlight selected gap
            const gapElement = document.querySelector(`[data-gap="${gapNumber}"]`);
            gapElement.style.boxShadow = '0 0 20px rgba(244, 162, 97, 0.5)';
            
            selectedGap = gapNumber;
            
            // If option is selected, fill gap
            if (selectedOption) {
                fillGap();
            }
        }
        
        // Fill gap with selected option
        function fillGap() {
            if (!selectedGap || !selectedOption) return;
            
            const gapElement = document.querySelector(`[data-gap="${selectedGap}"]`);
            
            // Store answer
            userAnswers[selectedGap] = selectedOption.index + 1; // Store 1-based index
            
            // Update gap appearance
            gapElement.textContent = selectedOption.letter;
            gapElement.classList.add('filled');
            gapElement.style.boxShadow = '';
            
            // Remove option selection
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Clear selections
            selectedOption = null;
            selectedGap = null;
            
            updateProgress();
        }
        
        // Update test selector
        function updateTestSelector() {
            document.querySelectorAll('.test-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.textContent) === currentTestId) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Update progress
        function updateProgress() {
            const completed = Object.keys(userAnswers).length;
            const total = currentTestData.answers.length;
            const percentage = (completed / total) * 100;
            
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('progress-fill').style.width = percentage + '%';
            
            // Enable check button if all gaps filled
            document.getElementById('check-btn').disabled = completed < total;
            
            if (completed === total) {
                document.getElementById('check-btn').innerHTML = '<i class="fas fa-check-circle"></i> Check';
            }
        }
        
        // Check answers
        function checkAnswers() {
            let correct = 0;
            
            // Clear previous styling
            document.querySelectorAll('.gap').forEach(gap => {
                gap.classList.remove('correct', 'incorrect');
            });
            
            // Check each answer
            currentTestData.answers.forEach((correctAnswer, index) => {
                const gapNumber = index + 1;
                const userAnswer = userAnswers[gapNumber];
                const gapElement = document.querySelector(`[data-gap="${gapNumber}"]`);
                
                if (userAnswer === correctAnswer) {
                    gapElement.classList.add('correct');
                    correct++;
                } else {
                    gapElement.classList.add('incorrect');
                }
            });
            
            const score = Math.round((correct / currentTestData.answers.length) * 100);
            
            // Show results
            setTimeout(() => {
                alert(`Reading Part 6 Result:\n\nTest: ${currentTestData.title}\nScore: ${score}%\nCorrect: ${correct}/${currentTestData.answers.length}\n\n${score >= 70 ? '🎉 Well done!' : '💪 Keep practicing!'}`);
            }, 500);
        }
        
        // Reset test
        function resetTest() {
            userAnswers = {};
            selectedOption = null;
            selectedGap = null;
            
            // Clear all styling
            document.querySelectorAll('.gap').forEach(gap => {
                const gapNumber = gap.dataset.gap;
                gap.textContent = gapNumber;
                gap.classList.remove('filled', 'correct', 'incorrect');
                gap.style.boxShadow = '';
            });
            
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            updateProgress();
        }
        
        // Show error message
        function showError(message) {
            document.getElementById('loading-state').innerHTML = `
                <div style="color: var(--error);">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('check-btn').addEventListener('click', checkAnswers);
            document.getElementById('reset-btn').addEventListener('click', resetTest);
            
            document.getElementById('repeat-btn').addEventListener('click', () => {
                resetTest();
            });
            
            document.getElementById('return-btn').addEventListener('click', () => {
                window.location.href = '../reading.html';
            });
            
            document.getElementById('next-btn').addEventListener('click', () => {
                if (currentTestId < 8) {
                    loadTest(currentTestId + 1);
                } else {
                    alert('Congratulations! You have completed all Reading Part 6 tests.\n\nTry Part 7 next!');
                }
            });
        }
        
        // Global functions
        window.selectGap = selectGap;
    </script>
</body>
</html>
