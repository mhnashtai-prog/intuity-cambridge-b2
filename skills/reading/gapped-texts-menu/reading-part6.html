<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>INTUITY - Reading Part 6: Gapped Text</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
<style>
  * { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }
  
  :root {
    --intuity-gold: #C9A961;
    --gold-light: #fef9c3;
    --lime: #84cc16;
    --blue: #7dd3fc;
    --orange: #fb923c;
    --border: rgba(84, 84, 88, 0.3);
    
    --text-base: 1.0625rem;
    --text-large: 1.25rem;
    --text-small: 0.875rem;
    --text-tiny: 0.75rem;
    
    --space-xs: 0.5rem;
    --space-sm: 0.75rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
  }
  
  body {
    font-family: 'DM Sans', sans-serif;
    background: #0d0d0d;
    color: #e5e5e7;
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100vh;
    height: 100dvh;
  }

  .background {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.10) 0%, transparent 50%),
                #0d0d0d;
    z-index: 0;
  }

  /* TOP BAR */
  .top-bar {
    background: rgba(28, 28, 30, 0.98);
    backdrop-filter: blur(40px);
    border-bottom: 1px solid var(--border);
    padding: 0.5rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    height: 3rem;
  }

  .back-btn {
    background: rgba(28, 28, 30, 0.8);
    border: 0.5px solid rgba(84, 84, 88, 0.3);
    border-radius: 50%;
    width: 1.75rem;
    height: 1.75rem;
    color: #8e8e93;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
  }

  .back-btn:hover {
    color: var(--intuity-gold);
    border-color: rgba(201, 169, 97, 0.4);
  }

  .brand {
    font-family: 'Space Grotesk', sans-serif;
    font-size: var(--text-small);
    font-weight: 700;
    background: linear-gradient(135deg, var(--intuity-gold) 0%, rgba(255,255,255,0.85) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .passage-selector {
    display: flex;
    gap: 0.375rem;
    align-items: center;
  }

  .passage-nav-btn {
    width: 1.75rem;
    height: 1.75rem;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border);
    color: var(--intuity-gold);
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
  }

  .passage-nav-btn:hover:not(:disabled) {
    background: rgba(201, 169, 97, 0.2);
    border-color: var(--intuity-gold);
  }

  .passage-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .passage-number {
    font-size: var(--text-tiny);
    font-weight: 700;
    color: var(--intuity-gold);
    min-width: 2.5rem;
    text-align: center;
  }

  /* READING MODE TOGGLE */
  .toggle-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.625rem 1rem;
    margin: 0 auto;
    max-width: 750px;
  }

  /* NAVIGATION DOTS */
  .nav-dots {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    flex-shrink: 0;
  }

  .nav-dot {
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 50%;
    background: rgba(28, 28, 30, 0.6);
    border: 2px solid rgba(84, 84, 88, 0.4);
    color: #8e8e93;
    font-size: 0.75rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }

  .nav-dot:hover {
    transform: scale(1.1);
    border-color: var(--intuity-gold);
    background: rgba(201, 169, 97, 0.15);
  }

  .nav-dot.filled {
    background: rgba(132, 204, 22, 0.2);
    border-color: var(--lime);
    color: var(--lime);
  }

  .nav-dot.correct {
    background: var(--lime);
    border-color: var(--lime);
    color: #000;
  }

  .nav-dot.incorrect {
    background: var(--orange);
    border-color: var(--orange);
    color: #fff;
  }

  /* TOGGLE SECTION */
  .toggle-section {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    flex-shrink: 0;
  }

  .toggle-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #8e8e93;
    transition: color 0.3s;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }

  .toggle-label.active {
    color: var(--intuity-gold);
  }

  .toggle-switch {
    position: relative;
    width: 3.25rem;
    height: 1.75rem;
    background: rgba(84, 84, 88, 0.3);
    border-radius: 1.75rem;
    cursor: pointer;
    transition: all 0.3s;
    border: 1px solid rgba(84, 84, 88, 0.4);
  }

  .toggle-switch:hover {
    background: rgba(84, 84, 88, 0.4);
  }

  .toggle-switch.active {
    background: rgba(201, 169, 97, 0.3);
    border-color: rgba(201, 169, 97, 0.5);
  }

  .toggle-slider {
    position: absolute;
    top: 0.125rem;
    left: 0.125rem;
    width: 1.375rem;
    height: 1.375rem;
    background: linear-gradient(135deg, #e5e5e7 0%, #ffffff 100%);
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  }

  .toggle-switch.active .toggle-slider {
    left: 1.625rem;
    background: linear-gradient(135deg, var(--intuity-gold) 0%, #d4b46e 100%);
  }

  /* MAIN CONTAINER */
  .main-container {
    position: fixed;
    top: 3rem;
    left: 0;
    right: 0;
    bottom: 3.5rem;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    z-index: 1;
  }

  .main-container::-webkit-scrollbar { width: 6px; }
  .main-container::-webkit-scrollbar-track { background: transparent; }
  .main-container::-webkit-scrollbar-thumb {
    background: rgba(99, 99, 102, 0.3);
    border-radius: 6px;
  }

  .passage-header {
    text-align: center;
    padding: 1rem 1rem 0;
    max-width: 750px;
    margin: 0 auto;
  }

  .passage-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.375rem;
    font-weight: 700;
    color: var(--intuity-gold);
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  /* FULL TEXT MODE */
  .passage-content {
    max-width: 750px;
    margin: 0 auto;
    padding: 1.5rem 1rem;
    font-size: var(--text-base);
    line-height: 1.7;
    color: #e5e5e7;
  }

  .passage-content.hidden {
    display: none;
  }

  .passage-content p {
    margin-bottom: 1.5rem;
  }

  /* GAP CONTAINERS */
  .gap-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 3rem;
    height: 2.5rem;
    margin: 0 0.375rem;
    padding: 0 0.75rem;
    background: rgba(201, 169, 97, 0.15);
    border: 2px dashed var(--intuity-gold);
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    vertical-align: middle;
  }

  .gap-container:hover {
    background: rgba(201, 169, 97, 0.25);
    transform: scale(1.05);
  }

  .gap-container.filled {
    background: rgba(125, 211, 252, 0.15);
    border-color: var(--blue);
    border-style: solid;
  }

  .gap-container.correct {
    background: rgba(132, 204, 22, 0.15);
    border-color: var(--lime);
    border-style: solid;
  }

  .gap-container.incorrect {
    background: rgba(251, 146, 60, 0.15);
    border-color: var(--orange);
    border-style: solid;
  }

  .gap-number {
    font-size: 0.875rem;
    font-weight: 700;
    color: var(--intuity-gold);
    border-radius: 50%;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(201, 169, 97, 0.2);
    border: 1.5px solid var(--intuity-gold);
  }

  .gap-container.filled .gap-number {
    color: var(--blue);
    border-color: var(--blue);
    background: rgba(125, 211, 252, 0.2);
  }

  .gap-container.correct .gap-number {
    color: var(--lime);
    border-color: var(--lime);
    background: rgba(132, 204, 22, 0.2);
  }

  .gap-container.incorrect .gap-number {
    color: var(--orange);
    border-color: var(--orange);
    background: rgba(251, 146, 60, 0.2);
  }

  .gap-sentence {
    margin-left: 0.5rem;
    font-size: 0.8125rem;
    color: #d1d5db;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .gap-icon {
    font-size: 1rem;
  }

  /* SECTION MODE */
  .section-grid {
    display: none;
    grid-template-columns: 1fr;
    gap: 1rem;
    padding: 1.5rem 1rem;
    max-width: 750px;
    margin: 0 auto;
  }

  .section-grid.active {
    display: grid;
  }

  .section-card {
    background: rgba(28, 28, 30, 0.6);
    backdrop-filter: blur(20px);
    border: 1.5px solid rgba(84, 84, 88, 0.3);
    border-radius: 1rem;
    padding: 1.25rem;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }

  .section-card:hover {
    transform: translateY(-2px);
    border-color: rgba(201, 169, 97, 0.4);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  .section-card.filled {
    border-color: rgba(125, 211, 252, 0.5);
    background: rgba(125, 211, 252, 0.05);
  }

  .section-card.correct {
    border-color: rgba(132, 204, 22, 0.6);
    background: rgba(132, 204, 22, 0.08);
  }

  .section-card.incorrect {
    border-color: rgba(251, 146, 60, 0.6);
    background: rgba(251, 146, 60, 0.08);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.875rem;
  }

  .section-number {
    font-size: 0.8125rem;
    font-weight: 700;
    color: var(--intuity-gold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .section-status {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: rgba(84, 84, 88, 0.3);
    border: 1.5px solid rgba(84, 84, 88, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 700;
    transition: all 0.3s;
    color: var(--intuity-gold);
  }

  .section-card.filled .section-status {
    background: rgba(125, 211, 252, 0.2);
    border-color: var(--blue);
    color: var(--blue);
  }

  .section-card.correct .section-status {
    background: rgba(132, 204, 22, 0.2);
    border-color: var(--lime);
    color: var(--lime);
  }

  .section-card.incorrect .section-status {
    background: rgba(251, 146, 60, 0.2);
    border-color: var(--orange);
    color: var(--orange);
  }

  .section-preview {
    font-size: 0.9375rem;
    line-height: 1.6;
    color: #d1d5db;
  }

  /* SENTENCE MODAL */
  .sentence-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 150;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .sentence-modal.active {
    display: flex;
    opacity: 1;
  }

  .modal-content {
    background: rgba(28, 28, 30, 0.98);
    backdrop-filter: blur(60px);
    border: 1px solid var(--border);
    border-radius: 1.25rem;
    padding: 1.5rem;
    max-width: 600px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    transform: scale(0.95);
    transition: transform 0.3s;
  }

  .sentence-modal.active .modal-content {
    transform: scale(1);
  }

  .modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border);
    color: #8e8e93;
    font-size: 1.25rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
  }

  .modal-close:hover {
    color: #e5e5e7;
    background: rgba(0, 0, 0, 0.5);
  }

  .modal-header {
    margin-bottom: 1.25rem;
  }

  .modal-title {
    font-size: var(--text-large);
    font-weight: 700;
    color: var(--intuity-gold);
    margin-bottom: 0.5rem;
  }

  .modal-subtitle {
    font-size: var(--text-small);
    color: #9ca3af;
  }

  .modal-sentences {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .sentence-option {
    background: rgba(0, 0, 0, 0.3);
    border: 1.5px solid rgba(84, 84, 88, 0.3);
    border-radius: 0.75rem;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    gap: 0.75rem;
  }

  .sentence-option:hover:not(.used) {
    border-color: rgba(201, 169, 97, 0.5);
    background: rgba(201, 169, 97, 0.1);
  }

  .sentence-option.used {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .sentence-letter {
    font-weight: 700;
    color: var(--intuity-gold);
    min-width: 1.5rem;
    font-size: 1rem;
  }

  .sentence-content {
    flex: 1;
    font-size: 0.9375rem;
    line-height: 1.5;
    color: #e5e5e7;
  }

  /* BOTTOM BAR */
  .bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(28, 28, 30, 0.98);
    backdrop-filter: blur(40px);
    border-top: 1px solid var(--border);
    padding: 0.625rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
    gap: 0.75rem;
  }

  .bottom-left {
    display: flex;
    gap: 0.625rem;
    align-items: center;
  }

  .bottom-btn {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border);
    border-radius: 0.625rem;
    color: #e5e5e7;
    font-size: var(--text-small);
    font-weight: 600;
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: all 0.3s;
    font-family: inherit;
  }

  .bottom-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

  .bottom-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .bottom-btn.reset {
    background: rgba(255, 59, 48, 0.15);
    border: 1px solid rgba(255, 59, 48, 0.3);
    color: #ff3b30;
  }

  .bottom-btn.primary {
    background: linear-gradient(135deg, var(--intuity-gold) 0%, var(--gold-light) 100%);
    color: #111827;
    border: none;
    font-weight: 700;
    min-width: 7rem;
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }

  .progress-pill {
    font-size: var(--text-small);
    color: var(--intuity-gold);
    font-weight: 700;
    padding: 0.375rem var(--space-sm);
    background: rgba(201, 169, 97, 0.15);
    border-radius: 1rem;
    border: 1px solid rgba(201, 169, 97, 0.3);
  }

  /* RESULTS MODAL */
  .results-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    z-index: 200;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .results-modal.active {
    display: flex;
  }

  .results-content {
    background: rgba(28, 28, 30, 0.98);
    backdrop-filter: blur(60px);
    border: 1px solid var(--border);
    border-radius: 1.25rem;
    padding: 2rem 1.5rem;
    max-width: 400px;
    width: 90%;
    text-align: center;
  }

  .results-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: var(--text-large);
    font-weight: 700;
    color: var(--intuity-gold);
    margin-bottom: 1.5rem;
  }

  .score-circle {
    width: 140px;
    height: 140px;
    margin: 0 auto 1rem;
    border-radius: 50%;
    background: conic-gradient(var(--lime) 0deg, var(--lime) 0deg, rgba(84, 84, 88, 0.3) 0deg);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .score-text {
    font-size: 2rem;
    font-weight: 700;
    color: #e5e5e7;
  }

  .score-percentage {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--intuity-gold);
    margin-bottom: 1.5rem;
  }

  .stats-row {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    justify-content: center;
  }

  .stat-box {
    flex: 1;
    padding: 0.75rem;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 0.75rem;
    border: 1px solid var(--border);
  }

  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.8125rem;
    color: #9ca3af;
  }

  .modal-actions {
    display: flex;
    gap: 0.75rem;
  }

  .results-btn {
    flex: 1;
    padding: 0.75rem;
    border-radius: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-family: inherit;
    font-size: 0.9375rem;
  }

  .results-btn.secondary {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border);
    color: #e5e5e7;
  }

  .results-btn.primary {
    background: linear-gradient(135deg, var(--intuity-gold) 0%, var(--gold-light) 100%);
    color: #111827;
    border: none;
  }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 5rem;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(28, 28, 30, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    padding: 0.75rem 1.25rem;
    color: #e5e5e7;
    font-size: 0.875rem;
    font-weight: 600;
    z-index: 300;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

  .toast.show {
    opacity: 1;
  }

  /* MOBILE */
  @media (max-width: 768px) {
    .passage-title { font-size: 1.125rem; }
    .passage-content { font-size: 0.9375rem; padding: 1rem; }
    .gap-container { min-width: 2.5rem; height: 2rem; }
    .gap-number { width: 1.75rem; height: 1.75rem; font-size: 0.75rem; }
    .toggle-label { font-size: 0.6875rem; }
    
    .toggle-container {
      flex-direction: column;
      gap: 0.75rem;
      align-items: center;
    }
    
    .nav-dots {
      order: 2;
      gap: 0.375rem;
    }
    
    .nav-dot {
      width: 2rem;
      height: 2rem;
      font-size: 0.6875rem;
    }
    
    .toggle-section {
      order: 1;
    }
  }

  @media (max-width: 480px) {
    .nav-dot {
      width: 1.875rem;
      height: 1.875rem;
      font-size: 0.625rem;
    }
  }
</style>
</head>
<body>
  <div class="background"></div>

  <!-- TOP BAR -->
  <div class="top-bar">
    <a href="../../../index.html?openModal=reading" class="back-btn">‚Üê</a>
    <div class="brand">INTUITY</div>
    <div class="passage-selector">
      <button class="passage-nav-btn" id="prevBtn" onclick="prevPassage()">‚Üê</button>
      <span class="passage-number" id="passageNumber">1/8</span>
      <button class="passage-nav-btn" id="nextBtn" onclick="nextPassage()">‚Üí</button>
    </div>
  </div>

  <!-- MAIN CONTAINER -->
  <div class="main-container">
    <div class="passage-header">
      <h1 class="passage-title" id="passageTitle">Loading...</h1>
      
      <!-- TOGGLE SWITCH -->
      <div class="toggle-container">
        <!-- NAVIGATION DOTS (Left) -->
        <div class="nav-dots" id="navDots">
          <!-- Dots will be generated here -->
        </div>
        
        <!-- TOGGLE SWITCH (Right) -->
        <div class="toggle-section">
          <span class="toggle-label active" id="fullTextLabel" onclick="switchMode('full')">
            üìÑ Full
          </span>
          <div class="toggle-switch" id="toggleSwitch" onclick="toggleMode()">
            <div class="toggle-slider"></div>
          </div>
          <span class="toggle-label" id="sectionsLabel" onclick="switchMode('sections')">
            üî≤ Sections
          </span>
        </div>
      </div>
    </div>

    <!-- FULL TEXT MODE -->
    <div class="passage-content" id="passageContent">
      <!-- Passage with gaps will load here -->
    </div>

    <!-- SECTION MODE -->
    <div class="section-grid" id="sectionGrid">
      <!-- Section cards will load here -->
    </div>
  </div>

  <!-- BOTTOM BAR -->
  <div class="bottom-bar">
    <div class="bottom-left">
      <button class="bottom-btn reset" onclick="resetTest()">Reset</button>
      <div class="progress-pill" id="progressPill">0/6</div>
    </div>
    <button class="bottom-btn primary" id="checkBtn" onclick="checkAnswers()">Check</button>
  </div>

  <!-- SENTENCE MODAL -->
  <div class="sentence-modal" id="sentenceModal" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-close" onclick="closeModal()">√ó</div>
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Select sentence for gap 37</div>
        <div class="modal-subtitle">Choose from sentences A ‚Äì G</div>
      </div>
      <div class="modal-sentences" id="modalSentences">
        <!-- Sentence options will load here -->
      </div>
    </div>
  </div>

  <!-- RESULTS MODAL -->
  <div class="results-modal" id="resultsModal">
    <div class="results-content">
      <div class="results-title">Results</div>
      <div class="score-circle" id="scoreCircle">
        <div class="score-text" id="scoreText">0/6</div>
      </div>
      <div class="score-percentage" id="scorePercentage">0%</div>
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-value" id="correctStat">0</div>
          <div class="stat-label">Correct</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="wrongStat">0</div>
          <div class="stat-label">Wrong</div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="results-btn secondary" onclick="closeResults()">Close</button>
        <button class="results-btn primary" onclick="resetTest(); closeResults();">Try Again</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script>
    // STATE
    let currentPassageData = null;
    let userAnswers = {};
    let isChecked = false;
    let currentGap = null;
    let currentPassageNum = 1;
    const MAX_PASSAGES = 8;
    let currentMode = 'full'; // 'full' or 'sections'

    // LOAD PASSAGE
    async function loadPassage(num = 1) {
      const paths = [
        `data/gapped-text${num}.json`,
        `./data/gapped-text${num}.json`,
        `../data/gapped-text${num}.json`,
        `../../data/gapped-text${num}.json`
      ];

      for (const path of paths) {
        try {
          const response = await fetch(path);
          if (response.ok) {
            currentPassageData = await response.json();
            console.log(`‚úÖ Loaded passage ${num} from:`, path);
            resetState();
            renderPassage();
            updateNavButtons();
            return;
          }
        } catch (e) {
          console.log(`‚ùå Failed:`, path);
        }
      }
      
      showToast('Failed to load passage');
    }

    function resetState() {
      userAnswers = {};
      isChecked = false;
      currentGap = null;
      updateProgress();
    }

    // RENDER NAVIGATION DOTS
    function renderNavDots() {
      const dotsContainer = document.getElementById('navDots');
      dotsContainer.innerHTML = '';
      
      if (!currentPassageData) return;
      
      for (let i = 1; i <= 6; i++) {
        const gapNum = 36 + i;
        const dot = document.createElement('div');
        dot.className = 'nav-dot';
        dot.dataset.gap = i;
        
        // Determine state
        if (isChecked) {
          if (userAnswers[i] === currentPassageData.answers[i - 1]) {
            dot.classList.add('correct');
            dot.innerHTML = '‚úì';
          } else if (userAnswers[i] !== undefined) {
            dot.classList.add('incorrect');
            dot.innerHTML = '‚úó';
          } else {
            dot.textContent = gapNum;
          }
        } else if (userAnswers[i]) {
          dot.classList.add('filled');
          const letter = String.fromCharCode(64 + userAnswers[i]);
          dot.textContent = letter;
        } else {
          dot.textContent = gapNum;
        }
        
        dot.onclick = () => openGapModal(i);
        dotsContainer.appendChild(dot);
      }
    }

    // RENDER PASSAGE
    function renderPassage() {
      if (!currentPassageData) return;
      
      document.getElementById('passageTitle').textContent = currentPassageData.title;
      
      // Render navigation dots
      renderNavDots();
      
      // Render full text mode
      const fullContent = document.getElementById('passageContent');
      let passageHTML = currentPassageData.passage;
      
      // Replace gap placeholders with interactive containers
      for (let i = 1; i <= 6; i++) {
        const gapNum = 36 + i;
        const regex = new RegExp(`<span class=['"]gap['"] data-gap=['"]${i}['"]>\\[${i}\\]<\\/span>`, 'g');
        
        let gapContent = '';
        let statusClass = '';
        let iconHTML = `<span class="gap-number">${gapNum}</span>`;
        
        if (userAnswers[i]) {
          const sentenceIndex = userAnswers[i] - 1;
          const sentence = currentPassageData.options[sentenceIndex];
          const letter = String.fromCharCode(64 + userAnswers[i]);
          
          if (isChecked) {
            if (currentPassageData.answers[i - 1] === userAnswers[i]) {
              statusClass = 'correct';
              iconHTML = '<span class="gap-icon">‚úì</span>';
            } else {
              statusClass = 'incorrect';
              iconHTML = '<span class="gap-icon">‚úó</span>';
            }
          } else {
            statusClass = 'filled';
          }
          
          gapContent = `
            <div class="gap-container ${statusClass}" onclick="openGapModal(${i})">
              ${iconHTML}
              <span class="gap-sentence">${letter}. ${sentence.substring(0, 30)}...</span>
            </div>
          `;
        } else {
          gapContent = `
            <div class="gap-container" onclick="openGapModal(${i})">
              <span class="gap-number">${gapNum}</span>
            </div>
          `;
        }
        
        passageHTML = passageHTML.replace(regex, gapContent);
      }
      
      fullContent.innerHTML = passageHTML;
      
      // Render section mode
      const sectionGrid = document.getElementById('sectionGrid');
      sectionGrid.innerHTML = '';
      
      const paragraphs = currentPassageData.passage.split('\n\n');
      
      for (let i = 1; i <= 6; i++) {
        const gapNum = 36 + i;
        const cardDiv = document.createElement('div');
        cardDiv.className = 'section-card';
        
        // Find the paragraph containing this gap
        let gapContext = '';
        for (const para of paragraphs) {
          if (para.includes(`data-gap='${i}'`) || para.includes(`data-gap="${i}"`)) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = para;
            gapContext = tempDiv.textContent.substring(0, 200) + '...';
            break;
          }
        }
        
        let statusIcon = gapNum;
        let statusClass = '';
        
        if (userAnswers[i]) {
          const letter = String.fromCharCode(64 + userAnswers[i]);
          statusIcon = letter;
          
          if (isChecked) {
            if (currentPassageData.answers[i - 1] === userAnswers[i]) {
              statusClass = 'correct';
              statusIcon = '‚úì';
            } else {
              statusClass = 'incorrect';
              statusIcon = '‚úó';
            }
          } else {
            statusClass = 'filled';
          }
        }
        
        if (statusClass) cardDiv.classList.add(statusClass);
        
        cardDiv.innerHTML = `
          <div class="section-header">
            <span class="section-number">Gap ${gapNum}</span>
            <span class="section-status">${statusIcon}</span>
          </div>
          <div class="section-preview">${gapContext}</div>
        `;
        
        cardDiv.onclick = () => openGapModal(i);
        sectionGrid.appendChild(cardDiv);
      }
    }

    // TOGGLE MODE
    function toggleMode() {
      currentMode = currentMode === 'full' ? 'sections' : 'full';
      switchMode(currentMode);
    }

    function switchMode(mode) {
      currentMode = mode;
      const toggleSwitch = document.getElementById('toggleSwitch');
      const fullLabel = document.getElementById('fullTextLabel');
      const sectionsLabel = document.getElementById('sectionsLabel');
      const fullContent = document.getElementById('passageContent');
      const sectionGrid = document.getElementById('sectionGrid');
      
      if (mode === 'sections') {
        toggleSwitch.classList.add('active');
        fullLabel.classList.remove('active');
        sectionsLabel.classList.add('active');
        fullContent.classList.add('hidden');
        sectionGrid.classList.add('active');
      } else {
        toggleSwitch.classList.remove('active');
        fullLabel.classList.add('active');
        sectionsLabel.classList.remove('active');
        fullContent.classList.remove('hidden');
        sectionGrid.classList.remove('active');
      }
    }

    // OPEN GAP MODAL
    function openGapModal(gapIndex) {
      if (isChecked) return;
      
      currentGap = gapIndex;
      const gapNum = 36 + gapIndex;
      document.getElementById('modalTitle').textContent = `Select sentence for gap ${gapNum}`;
      
      renderSentences();
      document.getElementById('sentenceModal').classList.add('active');
    }

    function renderSentences() {
      const sentencesDiv = document.getElementById('modalSentences');
      sentencesDiv.innerHTML = '';
      
      const usedSentences = Object.values(userAnswers);
      
      currentPassageData.options.forEach((sentence, index) => {
        const sentenceIndex = index + 1;
        const letter = String.fromCharCode(64 + sentenceIndex);
        const isUsed = usedSentences.includes(sentenceIndex) && userAnswers[currentGap] !== sentenceIndex;
        
        const optionDiv = document.createElement('div');
        optionDiv.className = 'sentence-option';
        if (isUsed) optionDiv.classList.add('used');
        
        optionDiv.innerHTML = `
          <div class="sentence-letter">${letter}</div>
          <div class="sentence-content">${sentence}</div>
        `;
        
        if (!isUsed) {
          optionDiv.onclick = () => selectSentence(sentenceIndex);
        }
        
        sentencesDiv.appendChild(optionDiv);
      });
    }

    function selectSentence(sentenceIndex) {
      // Remove this sentence from any other gap
      for (let gap in userAnswers) {
        if (userAnswers[gap] === sentenceIndex) {
          delete userAnswers[gap];
        }
      }
      
      // Place in current gap
      userAnswers[currentGap] = sentenceIndex;
      
      updateProgress();
      renderPassage();
      closeModal();
      
      // Auto-navigate to next empty gap
      const nextGap = findNextEmptyGap(currentGap);
      if (nextGap !== -1) {
        setTimeout(() => openGapModal(nextGap), 300);
      }
    }

    function findNextEmptyGap(startFrom) {
      for (let i = startFrom + 1; i <= 6; i++) {
        if (!userAnswers[i]) return i;
      }
      for (let i = 1; i < startFrom; i++) {
        if (!userAnswers[i]) return i;
      }
      return -1;
    }

    function closeModal(event) {
      if (event && event.target.id !== 'sentenceModal') return;
      document.getElementById('sentenceModal').classList.remove('active');
    }

    // CHECK ANSWERS
    function checkAnswers() {
      if (Object.keys(userAnswers).length === 0) {
        showToast('Please fill at least one gap');
        return;
      }
      
      isChecked = true;
      renderPassage();
      showResults();
    }

    function showResults() {
      let correct = 0;
      
      for (let i = 1; i <= 6; i++) {
        if (userAnswers[i] === currentPassageData.answers[i - 1]) {
          correct++;
        }
      }
      
      const total = 6;
      const percentage = Math.round((correct / total) * 100);
      
      document.getElementById('scoreText').textContent = `${correct}/${total}`;
      document.getElementById('scorePercentage').textContent = `${percentage}%`;
      document.getElementById('correctStat').textContent = correct;
      document.getElementById('wrongStat').textContent = total - correct;
      
      const circle = document.getElementById('scoreCircle');
      const degrees = (correct / total) * 360;
      circle.style.background = `conic-gradient(var(--lime) ${degrees}deg, rgba(84, 84, 88, 0.3) ${degrees}deg)`;
      
      document.getElementById('resultsModal').classList.add('active');
    }

    function closeResults() {
      document.getElementById('resultsModal').classList.remove('active');
    }

    // RESET
    function resetTest() {
      userAnswers = {};
      isChecked = false;
      renderPassage();
      updateProgress();
      showToast('Test reset');
    }

    // NAVIGATION
    function prevPassage() {
      if (currentPassageNum > 1) {
        currentPassageNum--;
        loadPassage(currentPassageNum);
      }
    }

    function nextPassage() {
      if (currentPassageNum < MAX_PASSAGES) {
        currentPassageNum++;
        loadPassage(currentPassageNum);
      }
    }

    function updateNavButtons() {
      document.getElementById('passageNumber').textContent = `${currentPassageNum}/${MAX_PASSAGES}`;
      document.getElementById('prevBtn').disabled = currentPassageNum === 1;
      document.getElementById('nextBtn').disabled = currentPassageNum === MAX_PASSAGES;
    }

    // PROGRESS
    function updateProgress() {
      const filled = Object.keys(userAnswers).length;
      document.getElementById('progressPill').textContent = `${filled}/6`;
    }

    // TOAST
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // INIT
    loadPassage(1);
  </script>
</body>
</html>
