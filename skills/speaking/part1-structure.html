<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY - Grammar: Present Simple</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
      background: #0d0d0d;
      background-image: radial-gradient(circle at 20% 50%, rgba(201, 169, 97, 0.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(201, 169, 97, 0.03) 0%, transparent 50%);
      color: #e5e5e5;
      min-height: 100vh;
      padding: 1rem;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
    }

    /* HEADER */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 0;
      margin-bottom: 1.5rem;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .home-link {
      color: #8e8e93;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .home-link:hover {
      color: #C9A961;
    }

    .brand-section {
      text-align: left;
    }

    .brand {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.04em;
    }

    .subtitle {
      font-size: 0.75rem;
      color: #8e8e93;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(84, 84, 88, 0.3);
      color: #8e8e93;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.875rem;
    }

    .header-icon:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
    }

    .audio-toggle {
      position: relative;
    }

    .audio-toggle.muted {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.4);
    }

    .audio-toggle.muted:hover {
      background: rgba(239, 68, 68, 0.3);
      border-color: rgba(239, 68, 68, 0.6);
    }

    .streak {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: #C9A961;
    }

    /* TIER 1: TIME FRAME */
    /* TIER 1: TIME (Present/Past/Future) - Text Links */
    .tier-1 {
      display: flex;
      justify-content: center;
      gap: 2.5rem;
      margin-bottom: 1.25rem;
    }

    .tier-1-btn {
      padding: 0;
      background: transparent;
      border: none;
      color: #8e8e93;
      font-size: 0.9375rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      text-decoration: none;
    }

    .tier-1-btn::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      right: 0;
      height: 2px;
      background: transparent;
      transition: all 0.2s ease;
    }

    .tier-1-btn:hover {
      color: #C9A961;
    }

    .tier-1-btn.active {
      color: #C9A961;
      font-weight: 600;
    }

    .tier-1-btn.active::after {
      background: #C9A961;
    }

    /* TIER 2: ASPECT (Simple/Continuous/Perfect) - Text Links */
    .tier-2 {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.25rem;
    }

    .tier-2-btn {
      padding: 0;
      background: transparent;
      border: none;
      color: #8e8e93;
      font-size: 0.8125rem;
      font-weight: 400;
      text-transform: capitalize;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .tier-2-btn:hover {
      color: #C9A961;
    }

    .tier-2-btn.active {
      color: #C9A961;
      font-weight: 600;
      text-decoration: underline;
      text-decoration-color: #C9A961;
      text-underline-offset: 4px;
    }

    /* TIER 3: CONTEXT - Minimal Text Links */
    .tier-3 {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .tier-3-btn {
      padding: 0;
      background: transparent;
      border: none;
      color: #636366;
      font-size: 0.75rem;
      font-weight: 400;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .tier-3-btn:hover {
      color: #C9A961;
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    .tier-3-btn.active {
      color: #C9A961;
      font-weight: 500;
    }

    /* MAIN CONTAINER */
    .main-container {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1.5rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      overflow: hidden;
      margin-bottom: 2rem;
    }

    /* CONTROLS HEADER */
    .controls-header {
      padding: 1.25rem 1.5rem;
      background: rgba(0, 0, 0, 0.15);
      border-bottom: 1px solid rgba(84, 84, 88, 0.2);
    }

    .context-label {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      margin-bottom: 1rem;
    }

    .context-icon {
      font-size: 1.25rem;
    }

    .context-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #e5e5e7;
    }

    /* TOGGLE BARS */
    .toggle-bars {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 0.875rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .toggle-group {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .toggle-label-text {
      font-size: 0.6875rem;
      color: #8e8e93;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .toggle-switch:hover {
      border-color: rgba(201, 169, 97, 0.4);
    }

    .toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: #C9A961;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.4);
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(24px);
    }

    .toggle-option {
      font-size: 0.75rem;
      color: #636366;
      font-weight: 500;
      transition: color 0.3s;
    }

    .toggle-option.active {
      color: #C9A961;
      font-weight: 600;
    }

    /* MODE SELECTOR (Watch, Read, Drill) - Text Links */
    .mode-selector {
      display: flex;
      gap: 1.5rem;
    }

    .mode-btn {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0;
      background: transparent;
      border: none;
      color: #8e8e93;
      font-size: 0.8125rem;
      font-weight: 400;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'DM Sans', sans-serif;
      text-decoration: none;
    }

    .mode-btn:hover {
      color: #C9A961;
    }

    .mode-btn.active {
      color: #C9A961;
      font-weight: 500;
    }

    .mode-icon {
      font-size: 1rem;
      display: flex;
      align-items: center;
    }

    .mode-label {
      font-size: 0.8125rem;
    }

    @media (max-width: 768px) {
      .mode-label {
        font-size: 0.75rem;
      }
    }

    /* FORMAT SELECTOR - Text Links */
    .format-selector {
      display: flex;
      gap: 1.25rem;
    }

    .format-btn {
      padding: 0;
      background: transparent;
      border: none;
      color: #8e8e93;
      font-size: 0.75rem;
      font-weight: 400;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.375rem;
      text-decoration: none;
    }

    .format-btn:hover {
      color: #C9A961;
    }

    .format-btn.active {
      color: #C9A961;
      font-weight: 500;
    }

    /* PLAYBACK CONTROLS */
    .playback-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .control-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(84, 84, 88, 0.3);
      color: #8e8e93;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .control-btn:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
    }

    .control-btn.play {
      width: 56px;
      height: 56px;
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
      font-size: 1.25rem;
    }

    .control-btn.play:hover {
      background: rgba(201, 169, 97, 0.25);
      border-color: rgba(201, 169, 97, 0.6);
    }

    /* RED LINE when playing */
    .control-btn.playing::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 3px;
      background: #ef4444;
      border-radius: 2px;
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
    }

    .control-btn.play.playing::after {
      width: 32px;
      height: 4px;
      bottom: -10px;
    }

    .slide-nav {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.75rem;
      color: #8e8e93;
      font-weight: 500;
    }

    .slide-nav-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(84, 84, 88, 0.3);
      color: #8e8e93;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .slide-nav-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
    }

    .slide-nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* CONTENT AREA */
    .content-area {
      padding: 3rem 2rem;
      min-height: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* TEXT VIEW */
    .text-content {
      max-width: 800px;
      width: 100%;
    }

    .text-paragraph {
      font-size: 1.25rem;
      line-height: 1.9;
      color: #e5e5e7;
    }

    .text-paragraph .highlight {
      color: #60a5fa;
      font-weight: 600;
      background: rgba(96, 165, 250, 0.1);
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
    }

    /* SLIDES VIEW */
    .slide-container {
      width: 100%;
      max-width: 900px;
      min-height: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
      opacity: 0;
      animation: slideIn 0.5s ease forwards;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .slide-icon {
      font-size: 5rem;
      margin-bottom: 2rem;
      animation: iconPop 0.6s ease;
    }

    @keyframes iconPop {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .slide-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .slide-subtitle {
      font-size: 1.5rem;
      color: #e5e5e7;
      font-weight: 600;
      margin-bottom: 0.5rem;
      line-height: 1.4;
    }

    .slide-text {
      font-size: 2rem;
      line-height: 1.6;
      color: #e5e5e7;
      font-weight: 600;
      max-width: 700px;
    }

    .slide-text .highlight {
      color: #60a5fa;
      font-weight: 700;
      position: relative;
    }

    .slide-text .highlight::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      right: 0;
      height: 3px;
      background: #60a5fa;
      border-radius: 2px;
    }

    /* SLIDE PROGRESS */
    .slide-progress {
      margin-top: 3rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(84, 84, 88, 0.4);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .progress-dot:hover {
      background: rgba(201, 169, 97, 0.4);
      transform: scale(1.2);
    }

    .progress-dot.active {
      background: #C9A961;
      width: 32px;
      border-radius: 5px;
      box-shadow: 0 0 12px rgba(201, 169, 97, 0.6);
    }

    /* READ MODE SLIDES */
    .formula-box {
      background: rgba(96, 165, 250, 0.1);
      border: 2px solid rgba(96, 165, 250, 0.3);
      border-radius: 1rem;
      padding: 1.5rem 2.5rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      color: #60a5fa;
      margin: 2rem 0;
      letter-spacing: 0.05em;
    }

    .examples-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-top: 2rem;
      width: 100%;
      max-width: 600px;
    }

    .example-item {
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      font-size: 1.25rem;
      color: #e5e5e7;
      font-weight: 600;
    }

    .uses-list {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      margin-top: 2rem;
      width: 100%;
      max-width: 500px;
    }

    .use-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 1.5rem;
      color: #e5e5e7;
      font-weight: 600;
    }

    .use-icon {
      font-size: 2rem;
    }

    .frequency-bars {
      width: 100%;
      max-width: 500px;
      margin-top: 2rem;
    }

    .frequency-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .frequency-word {
      width: 120px;
      font-size: 1.125rem;
      font-weight: 600;
      color: #e5e5e7;
      text-align: right;
    }

    .frequency-bar {
      flex: 1;
      height: 32px;
      background: rgba(139, 92, 246, 0.2);
      border-radius: 999px;
      position: relative;
      overflow: hidden;
    }

    .frequency-fill {
      height: 100%;
      background: linear-gradient(90deg, #8b5cf6, rgba(139, 92, 246, 0.6));
      border-radius: 999px;
      transition: width 0.8s ease;
    }

    .frequency-percentage {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.75rem;
      font-weight: 700;
      color: #e5e5e7;
    }

    .time-words {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 2rem;
      max-width: 600px;
    }

    .time-word-chip {
      background: rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.3);
      padding: 0.75rem 1.25rem;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: 600;
      color: #a78bfa;
    }

    .mistake-comparison {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .mistake-wrong {
      font-size: 2rem;
      font-weight: 700;
      color: #ef4444;
      text-decoration: line-through;
      opacity: 0.7;
    }

    .mistake-arrow {
      font-size: 2.5rem;
      color: #C9A961;
    }

    .mistake-correct {
      font-size: 2rem;
      font-weight: 700;
      color: #10b981;
    }

    .mistake-tip {
      font-size: 1.125rem;
      color: #e5e5e7;
      margin-top: 1rem;
      font-style: italic;
    }

    .sentences-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 2rem;
      width: 100%;
      max-width: 700px;
    }

    .sentence-item {
      background: rgba(245, 158, 11, 0.1);
      border-left: 4px solid #f59e0b;
      padding: 1.25rem 1.75rem;
      border-radius: 0.5rem;
      font-size: 1.5rem;
      color: #e5e5e7;
      font-weight: 600;
      line-height: 1.6;
    }

    .practice-question {
      background: rgba(236, 72, 153, 0.1);
      border: 2px solid rgba(236, 72, 153, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      margin-top: 2rem;
      max-width: 600px;
      width: 100%;
    }

    .practice-prompt {
      font-size: 1rem;
      color: #8e8e93;
      margin-bottom: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* DRILL MODE STYLES */
    .drill-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 500px;
      padding: 3rem 2rem;
    }

    .drill-counter {
      font-size: 0.875rem;
      color: #8e8e93;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 3rem;
    }

    .drill-sentence {
      background: rgba(201, 169, 97, 0.08);
      border: 2px solid rgba(201, 169, 97, 0.2);
      border-radius: 1.5rem;
      padding: 3rem 4rem;
      max-width: 800px;
      width: 100%;
      text-align: center;
      margin-bottom: 3rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .drill-sentence-text {
      font-size: 2.5rem;
      font-weight: 600;
      color: #e5e5e7;
      line-height: 1.5;
      font-family: 'Space Grotesk', sans-serif;
    }

    .drill-controls {
      display: flex;
      gap: 1.5rem;
      align-items: center;
      margin-bottom: 2rem;
    }

    .drill-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      background: rgba(201, 169, 97, 0.15);
      border: 2px solid rgba(201, 169, 97, 0.3);
      border-radius: 12px;
      color: #C9A961;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'DM Sans', sans-serif;
      position: relative;
    }

    .drill-btn:hover {
      background: rgba(201, 169, 97, 0.25);
      border-color: rgba(201, 169, 97, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    .drill-btn:active {
      transform: translateY(0);
    }

    /* RED LINE when drill audio is playing */
    .drill-btn.playing::after {
      content: '';
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 4px;
      background: #ef4444;
      border-radius: 2px;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
      animation: pulse-red 1s ease-in-out infinite;
    }

    @keyframes pulse-red {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .drill-btn-icon {
      font-size: 1.25rem;
    }

    .drill-progress {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 600px;
    }

    .drill-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(142, 142, 147, 0.3);
      transition: all 0.3s ease;
    }

    .drill-dot.active {
      background: #C9A961;
      box-shadow: 0 0 8px rgba(201, 169, 97, 0.6);
    }

    .drill-dot.completed {
      background: rgba(16, 185, 129, 0.6);
    }

    .drill-transformation {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 700px;
      width: 100%;
      margin-top: 2rem;
    }

    .drill-transformation-title {
      font-size: 0.875rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }

    .drill-transformation-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.75rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 0.5rem;
      font-size: 1.125rem;
    }

    .drill-transformation-label {
      font-size: 0.75rem;
      color: #8e8e93;
      text-transform: uppercase;
      font-weight: 600;
      min-width: 100px;
    }

    .drill-transformation-text {
      color: #e5e5e7;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .drill-sentence {
        padding: 2rem;
      }
      .drill-sentence-text {
        font-size: 1.75rem;
      }
      .drill-controls {
        flex-direction: column;
        width: 100%;
      }
      .drill-btn {
        width: 100%;
        justify-content: center;
      }
    }
      font-weight: 600;
    }

    .practice-sentence {
      font-size: 1.75rem;
      font-weight: 600;
      color: #e5e5e7;
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .practice-hint {
      font-size: 1rem;
      color: #8e8e93;
      font-style: italic;
    }

    /* READ TEXT VIEW */
    .read-text-container {
      max-width: 900px;
      width: 100%;
    }

    .read-section {
      background: rgba(48, 48, 51, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .read-section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .read-section-icon {
      font-size: 1.25rem;
    }

    .read-content {
      font-size: 1rem;
      line-height: 1.8;
      color: #e5e5e7;
    }

    .read-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .read-item {
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem;
      border-radius: 0.5rem;
      font-size: 0.9375rem;
      color: #e5e5e7;
    }

    .read-use-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 0.5rem;
    }

    .read-use-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .read-use-text {
      flex: 1;
    }

    .read-use-label {
      font-weight: 600;
      color: #e5e5e7;
      margin-bottom: 0.25rem;
    }

    .read-use-example {
      font-size: 0.875rem;
      color: #8e8e93;
      font-style: italic;
    }

    /* MOBILE */
    @media (max-width: 768px) {
      body { padding: 0.75rem; }
      .brand { font-size: 1.25rem; }
      .tier-1 { gap: 2rem; }
      .tier-1-btn { font-size: 0.875rem; }
      .tier-2 { gap: 1.5rem; }
      .tier-2-btn { font-size: 0.75rem; }
      .tier-3 { gap: 1.25rem; }
      .tier-3-btn { font-size: 0.6875rem; }
      .controls-header { padding: 1rem; }
      .context-title { font-size: 0.8125rem; }
      .toggle-bars { gap: 1.25rem; }
      .mode-btn { font-size: 0.75rem; }
      .mode-icon { font-size: 0.9375rem; }
      .format-btn { font-size: 0.6875rem; }
      .content-area { padding: 2rem 1.5rem; }
      .slide-text { font-size: 1.5rem; }
      .slide-title { font-size: 1.5rem; }
      .examples-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 480px) {
      body { padding: 0.5rem; }
      .tier-1 { gap: 1.5rem; }
      .tier-1-btn { font-size: 0.8125rem; }
      .tier-2 { gap: 1.25rem; }
      .tier-2-btn { font-size: 0.6875rem; }
      .tier-3 { gap: 1rem; }
      .tier-3-btn { font-size: 0.625rem; }
      .controls-header { padding: 0.875rem; }
      .toggle-bars { gap: 1rem; }
      .mode-selector { gap: 1rem; }
      .mode-btn { font-size: 0.6875rem; }
      .mode-icon { font-size: 0.875rem; }
      .mode-label { font-size: 0.6875rem; }
      .format-selector { gap: 1rem; }
      .format-btn { font-size: 0.625rem; }
      .slide-text { font-size: 1.25rem; }
      .slide-icon { font-size: 3.5rem; }
      .formula-box { font-size: 1.25rem; padding: 1rem 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- HEADER -->
    <div class="header">
      <div class="header-left">
        <a href="#" class="home-link">‚Üê HOME</a>
        <div class="brand-section">
          <div class="brand">INTUITY</div>
          <div class="subtitle">Grammar ¬∑ B1</div>
        </div>
      </div>
      <div class="header-right">
        <div class="header-icon audio-toggle" id="audioToggle" title="Toggle Audio">
          <span class="audio-on">üîä</span>
          <span class="audio-off" style="display: none;">üîá</span>
        </div>
        <div class="header-icon">‚öôÔ∏è</div>
        <div class="streak">üî• 3</div>
      </div>
    </div>

    <!-- TIER 1: TIME FRAME -->
    <div class="tier-1">
      <button class="tier-1-btn active" data-time="present">PRESENT</button>
      <button class="tier-1-btn" data-time="past">PAST</button>
      <button class="tier-1-btn" data-time="future">FUTURE</button>
    </div>

    <!-- TIER 2: ASPECT -->
    <div class="tier-2">
      <button class="tier-2-btn active" data-aspect="simple">Simple</button>
      <button class="tier-2-btn" data-aspect="continuous">Continuous</button>
      <button class="tier-2-btn" data-aspect="perfect">Perfect</button>
    </div>

    <!-- TIER 3: CONTEXT -->
    <div class="tier-3">
      <button class="tier-3-btn active" data-context="daily-habits">Daily Habits</button>
      <button class="tier-3-btn" data-context="frequency">Frequency</button>
      <button class="tier-3-btn" data-context="facts">Facts</button>
      <button class="tier-3-btn" data-context="schedules">Schedules</button>
      <button class="tier-3-btn" data-context="more">+1 more</button>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="main-container">
      
      <!-- CONTROLS HEADER -->
      <div class="controls-header">
        
        <!-- Context Label -->
        <div class="context-label">
          <span class="context-icon" id="contextIcon">üìñ</span>
          <span class="context-title" id="contextTitle">Present Simple ‚Ä¢ Daily Habits</span>
        </div>

        <!-- Toggle Bars -->
        <div class="toggle-bars">
          
          <!-- Watch/Read/Drill Mode Selector -->
          <div class="mode-selector">
            <button class="mode-btn active" id="watchBtn" data-mode="watch">
              <span class="mode-icon">üëÅÔ∏è</span>
              <span class="mode-label">Watch</span>
            </button>
            <button class="mode-btn" id="readBtn" data-mode="read">
              <span class="mode-icon">üìñ</span>
              <span class="mode-label">Read</span>
            </button>
            <button class="mode-btn" id="drillBtn" data-mode="drill">
              <span class="mode-icon">‚úèÔ∏è</span>
              <span class="mode-label">Drill</span>
            </button>
          </div>

          <!-- Text/Slides Format -->
          <div class="format-selector">
            <button class="format-btn" id="textBtn">üìù Text</button>
            <button class="format-btn active" id="slidesBtn">üìä Slides</button>
          </div>

        </div>

        <!-- Playback Controls -->
        <div class="playback-controls">
          <div class="slide-nav" id="slideNavigation" style="display: flex;">
            <button class="slide-nav-btn" id="prevSlide">‚Üê</button>
            <span id="slideCounter">1/8</span>
            <button class="slide-nav-btn" id="nextSlide">‚Üí</button>
          </div>
          
          <button class="control-btn play" id="playBtn">‚ñ∂</button>
          <button class="control-btn" id="pauseBtn" style="display: none;">‚è∏</button>
          <button class="control-btn" id="replayBtn">üîÅ</button>
          <button class="control-btn" id="soundBtn">üîä</button>
        </div>

      </div>

      <!-- CONTENT AREA -->
      <div class="content-area" id="contentArea">
        <!-- Content loaded dynamically -->
      </div>

    </div>

  </div>

  <script>
    // Load JSON data
    let GRAMMAR_DATA = null;
    
    // Cache for loaded data
    const dataCache = {};
    
    // Preload all JSON files in the background
    async function preloadAllData() {
      const tenses = [
        ['present', 'simple'],
        ['present', 'continuous'],
        ['present', 'perfect'],
        ['past', 'simple'],
        ['past', 'continuous'],
        ['past', 'perfect'],
        ['future', 'simple'],
        ['future', 'continuous'],
        ['future', 'perfect']
      ];
      
      console.log('üîÑ Preloading all grammar data...');
      
      for (const [time, aspect] of tenses) {
        const cacheKey = `${time}-${aspect}`;
        if (dataCache[cacheKey]) continue; // Skip if already cached
        
        try {
          const filename = `grammar-${time}-${aspect}.json`;
          
          // Try local first
          let response = await fetch(filename);
          
          // Fallback to GitHub if local fails
          if (!response.ok) {
            const githubUrl = `https://raw.githubusercontent.com/mhnashtai-prog/Tenses-B1-slides/main/${filename}`;
            response = await fetch(githubUrl);
          }
          
          if (response.ok) {
            const data = await response.json();
            dataCache[cacheKey] = data;
            console.log(`‚úì Preloaded: ${time} ${aspect}`);
          }
        } catch (error) {
          console.warn(`‚ö†Ô∏è Could not preload ${time}-${aspect}:`, error.message);
        }
      }
      
      console.log('‚úÖ Preloading complete! All data cached.');
    }

    async function loadData() {
      try {
        const cacheKey = `${currentTime}-${currentAspect}`;
        
        // Check cache first
        if (dataCache[cacheKey]) {
          console.log(`‚úì Loaded from cache: ${cacheKey}`);
          GRAMMAR_DATA = dataCache[cacheKey];
          
          // Update page title
          if (GRAMMAR_DATA.metadata?.title) {
            document.title = `INTUITY - Grammar: ${GRAMMAR_DATA.metadata.title}`;
          }
          
          updateTier3Buttons();
          renderContent();
          return;
        }
        
        // If not cached, fetch now
        const filename = `grammar-${currentTime}-${currentAspect}.json`;
        console.log(`üîÑ Loading: ${filename}`);
        
        // Try loading from local directory first
        let response = await fetch(filename);
        
        // If local fails, try GitHub raw URL as fallback
        if (!response.ok) {
          const githubUrl = `https://raw.githubusercontent.com/mhnashtai-prog/Tenses-B1-slides/main/${filename}`;
          console.log(`‚ö†Ô∏è Local failed, trying GitHub: ${githubUrl}`);
          response = await fetch(githubUrl);
        }
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        GRAMMAR_DATA = await response.json();
        dataCache[cacheKey] = GRAMMAR_DATA; // Cache it
        console.log('‚úì Data loaded successfully:', GRAMMAR_DATA.metadata?.title);
        
        // Update page title
        if (GRAMMAR_DATA.metadata?.title) {
          document.title = `INTUITY - Grammar: ${GRAMMAR_DATA.metadata.title}`;
        }
        
        updateTier3Buttons();
        renderContent();
      } catch (error) {
        console.error('‚ùå Error loading data:', error);
        const errorMsg = `
          <div style="padding: 40px; text-align: center;">
            <h2 style="color: #ef4444; margin-bottom: 20px;">‚ö†Ô∏è Error Loading Content</h2>
            <p style="color: #a3a3a3; margin-bottom: 10px;">Could not load: <strong>grammar-${currentTime}-${currentAspect}.json</strong></p>
            <p style="color: #71717a; font-size: 0.875rem;">Error: ${error.message}</p>
            <p style="color: #71717a; font-size: 0.875rem; margin-top: 20px;">
              Make sure files are in the same directory or check your GitHub repository.
            </p>
          </div>
        `;
        document.getElementById('contentArea').innerHTML = errorMsg;
      }
    }

    // STATE
    let currentTime = 'present';
    let currentAspect = 'simple';
    let currentContext = 'daily-habits';
    let currentMode = 'watch'; // 'watch', 'read', or 'drill'
    let currentFormat = 'slides'; // 'text' or 'slides'
    let currentSlide = 0;
    let totalSlides = 0;
    let isPlaying = false;
    let currentUtterance = null;
    let isSpeaking = false;

    // ELEMENTS
    const textBtn = document.getElementById('textBtn');
    const slidesBtn = document.getElementById('slidesBtn');
    const contentArea = document.getElementById('contentArea');
    const slideNavigation = document.getElementById('slideNavigation');
    const slideCounter = document.getElementById('slideCounter');
    const prevSlide = document.getElementById('prevSlide');
    const nextSlide = document.getElementById('nextSlide');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    // TIER NAVIGATION
    document.querySelectorAll('.tier-1-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        currentTime = this.dataset.time;
        document.querySelectorAll('.tier-1-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentSlide = 0;
        currentContext = 'daily-habits'; // Reset to first context
        stopAudio();
        loadData(); // Reload data for new time
      });
    });

    document.querySelectorAll('.tier-2-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        currentAspect = this.dataset.aspect;
        document.querySelectorAll('.tier-2-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentSlide = 0;
        currentContext = getDefaultContext(currentTime, currentAspect); // Get appropriate first context
        stopAudio();
        loadData(); // Reload data for new aspect
      });
    });

    document.querySelectorAll('.tier-3-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        if (this.dataset.context === 'more') {
          alert('More contexts coming soon!');
          return;
        }
        currentContext = this.dataset.context;
        document.querySelectorAll('.tier-3-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentSlide = 0;
        stopAudio();
        renderContent();
      });
    });

    // Helper function to get the default context for each tense
    function getDefaultContext(time, aspect) {
      if (time === 'present' && aspect === 'simple') {
        return 'daily-habits';
      } else if (time === 'present' && aspect === 'continuous') {
        return 'right-now';
      } else if (time === 'present' && aspect === 'perfect') {
        return 'life-experiences';
      } else if (time === 'past' && aspect === 'simple') {
        return 'finished-actions';
      } else if (time === 'past' && aspect === 'continuous') {
        return 'background-action';
      } else if (time === 'past' && aspect === 'perfect') {
        return 'earlier-past';
      } else if (time === 'future' && aspect === 'simple') {
        return 'predictions';
      } else if (time === 'future' && aspect === 'continuous') {
        return 'future-in-progress';
      } else if (time === 'future' && aspect === 'perfect') {
        return 'completed-by';
      }
      return 'daily-habits'; // fallback
    }

    // Update tier 3 buttons based on current tense
    function updateTier3Buttons() {
      const tier3Container = document.querySelector('.tier-3');
      
      let contexts = [];
      if (currentTime === 'present' && currentAspect === 'simple') {
        contexts = [
          {id: 'daily-habits', label: 'Daily Habits'},
          {id: 'frequency', label: 'Frequency'},
          {id: 'facts', label: 'Facts'},
          {id: 'schedules', label: 'Schedules'}
        ];
      } else if (currentTime === 'present' && currentAspect === 'continuous') {
        contexts = [
          {id: 'right-now', label: 'Right Now'},
          {id: 'temporary', label: 'Temporary'},
          {id: 'future-plans', label: 'Future Plans'},
          {id: 'trends', label: 'Trends'},
          {id: 'complaints', label: 'Complaints'},
          {id: 'background', label: 'Background'}
        ];
      } else if (currentTime === 'present' && currentAspect === 'perfect') {
        contexts = [
          {id: 'life-experiences', label: 'Life Experiences'},
          {id: 'recent-past', label: 'Recent Past'},
          {id: 'unfinished-time', label: 'Duration'},
          {id: 'change-over-time', label: 'Change'},
          {id: 'results', label: 'Results'},
          {id: 'multiple-times', label: 'Repetition'},
          {id: 'news', label: 'News'}
        ];
      } else if (currentTime === 'past' && currentAspect === 'simple') {
        contexts = [
          {id: 'finished-actions', label: 'Finished Actions'},
          {id: 'stories', label: 'Stories'},
          {id: 'biography', label: 'Biography'},
          {id: 'historical-events', label: 'History'},
          {id: 'sequences', label: 'Sequences'},
          {id: 'used-to', label: 'Used To'}
        ];
      } else if (currentTime === 'past' && currentAspect === 'continuous') {
        contexts = [
          {id: 'background-action', label: 'Background'},
          {id: 'interrupted-action', label: 'Interrupted'},
          {id: 'parallel-actions', label: 'Parallel Actions'},
          {id: 'descriptions', label: 'Descriptions'},
          {id: 'polite-questions', label: 'Polite Requests'}
        ];
      } else if (currentTime === 'past' && aspect === 'perfect') {
        contexts = [
          {id: 'earlier-past', label: 'Earlier Past'},
          {id: 'reported-speech', label: 'Reported Speech'},
          {id: 'regrets', label: 'Regrets'},
          {id: 'completed-before', label: 'Before/By'},
          {id: 'reasons', label: 'Reasons'},
          {id: 'third-conditional', label: '3rd Conditional'}
        ];
      } else if (currentTime === 'future' && currentAspect === 'simple') {
        contexts = [
          {id: 'predictions', label: 'Predictions'},
          {id: 'spontaneous-decisions', label: 'Decisions'},
          {id: 'promises', label: 'Promises'},
          {id: 'offers', label: 'Offers'},
          {id: 'threats-warnings', label: 'Warnings'}
        ];
      } else if (currentTime === 'future' && currentAspect === 'continuous') {
        contexts = [
          {id: 'future-in-progress', label: 'In Progress'},
          {id: 'polite-questions', label: 'Polite Questions'},
          {id: 'duration', label: 'Duration'}
        ];
      } else if (currentTime === 'future' && currentAspect === 'perfect') {
        contexts = [
          {id: 'completed-by', label: 'Completed By'},
          {id: 'predictions-completion', label: 'Predictions'},
          {id: 'achievements', label: 'Achievements'}
        ];
      }
      
      tier3Container.innerHTML = contexts.map((ctx, idx) => 
        `<button class="tier-3-btn ${idx === 0 ? 'active' : ''}" data-context="${ctx.id}">${ctx.label}</button>`
      ).join('');
      
      // Re-attach event listeners
      document.querySelectorAll('.tier-3-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          if (this.dataset.context === 'more') {
            alert('More contexts coming soon!');
            return;
          }
          currentContext = this.dataset.context;
          document.querySelectorAll('.tier-3-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentSlide = 0;
          stopAudio();
          renderContent();
        });
      });
    }

    // MODE SELECTOR (Watch/Read/Drill)
    const watchBtn = document.getElementById('watchBtn');
    const readBtn = document.getElementById('readBtn');
    const drillBtn = document.getElementById('drillBtn');
    
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        currentMode = this.dataset.mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentSlide = 0;
        stopAudio();
        renderContent();
      });
    });

    // TOGGLE FORMAT (Text/Slides)
    textBtn.addEventListener('click', function() {
      currentFormat = 'text';
      updateFormatUI();
      renderContent();
    });

    slidesBtn.addEventListener('click', function() {
      currentFormat = 'slides';
      updateFormatUI();
      currentSlide = 0;
      renderContent();
    });

    function updateFormatUI() {
      const isSlides = currentFormat === 'slides';
      textBtn.classList.toggle('active', !isSlides);
      slidesBtn.classList.toggle('active', isSlides);
      slideNavigation.style.display = isSlides ? 'flex' : 'none';
    }

    // SLIDE NAVIGATION
    prevSlide.addEventListener('click', () => {
      if (currentSlide > 0) {
        currentSlide--;
        renderContent();
      }
    });

    nextSlide.addEventListener('click', () => {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        renderContent();
      }
    });

    // KEYBOARD NAVIGATION
    document.addEventListener('keydown', (e) => {
      if (currentFormat === 'slides') {
        if (e.key === 'ArrowLeft') prevSlide.click();
        if (e.key === 'ArrowRight') nextSlide.click();
        if (e.key === ' ') {
          e.preventDefault();
          playBtn.click();
        }
      }
    });

    // RENDER CONTENT
    function renderContent() {
      if (!GRAMMAR_DATA) return;

      // Update context title
      const contextTitles = {
        'daily-habits': 'Daily Habits',
        'frequency': 'Frequency',
        'facts': 'Facts & General Truths',
        'schedules': 'Schedules & Timetables'
      };
      
      const tenseName = currentTime.charAt(0).toUpperCase() + currentTime.slice(1);
      const aspectName = currentAspect.charAt(0).toUpperCase() + currentAspect.slice(1);
      const contextName = contextTitles[currentContext] || 'Daily Habits';
      
      document.getElementById('contextTitle').textContent = `${tenseName} ${aspectName} ‚Ä¢ ${contextName}`;

      // Handle drill mode differently
      if (currentMode === 'drill') {
        renderDrillView();
        return;
      }

      const content = GRAMMAR_DATA[currentMode];
      
      if (currentFormat === 'text') {
        renderTextView(content);
      } else {
        renderSlidesView(content);
      }
    }

    // RENDER TEXT VIEW
    function renderTextView(content) {
      if (currentMode === 'watch') {
        // Watch Text Mode - get context-specific data
        const contextData = content[currentContext];
        if (!contextData || !contextData.text) {
          contentArea.innerHTML = '<p style="color: #ef4444;">No content available for this context yet.</p>';
          return;
        }
        
        const textData = contextData.text;
        let html = '<div class="text-content">';
        html += '<div class="text-paragraph">';
        
        // Highlight words in the text
        let text = textData.content;
        if (textData.highlights) {
          textData.highlights.forEach(h => {
            const word = h.word || h;
            text = text.replace(new RegExp(`\\b${word}\\b`, 'g'), `<span class="highlight">${word}</span>`);
          });
        }
        
        html += text;
        html += '</div></div>';
        contentArea.innerHTML = html;
        
      } else {
        // Read Text Mode - get context-specific data
        const contextData = content[currentContext];
        if (!contextData || !contextData.text) {
          contentArea.innerHTML = '<p style="color: #ef4444;">No content available for this context yet.</p>';
          return;
        }
        renderReadTextView(contextData.text);
      }
    }

    // RENDER READ TEXT VIEW
    function renderReadTextView(data) {
      let html = '<div class="read-text-container">';
      
      // Overview
      html += '<div class="read-section">';
      html += '<div class="read-section-title"><span class="read-section-icon">üéØ</span>Overview</div>';
      html += `<div class="read-content">`;
      html += `<h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">${data.overview.title}</h3>`;
      html += `<p style="font-size: 1.125rem; color: #8e8e93; margin-bottom: 1rem;">${data.overview.subtitle}</p>`;
      html += `<p>${data.overview.description}</p>`;
      html += `</div></div>`;
      
      // Form
      html += '<div class="read-section">';
      html += '<div class="read-section-title"><span class="read-section-icon">‚öôÔ∏è</span>Form</div>';
      html += `<div class="read-content">`;
      html += `<p style="margin-bottom: 1rem;"><strong>${data.form.pattern}</strong></p>`;
      html += '<div class="read-grid">';
      data.form.affirmative.forEach(item => {
        html += `<div class="read-item">${item.subject} ${item.verb}</div>`;
      });
      html += '</div></div></div>';
      
      // Uses
      html += '<div class="read-section">';
      html += '<div class="read-section-title"><span class="read-section-icon">üéØ</span>When to Use</div>';
      data.uses.forEach(use => {
        html += '<div class="read-use-item">';
        html += `<span class="read-use-icon">${use.icon}</span>`;
        html += '<div class="read-use-text">';
        html += `<div class="read-use-label">${use.label}</div>`;
        html += `<div class="read-use-example">${use.example}</div>`;
        html += '</div></div>';
      });
      html += '</div>';
      
      // Time Signals
      html += '<div class="read-section">';
      html += '<div class="read-section-title"><span class="read-section-icon">üïê</span>Time Signals</div>';
      html += '<div class="read-content">';
      html += '<p style="margin-bottom: 1rem;"><strong>Frequency words:</strong></p>';
      html += '<div class="read-grid">';
      data.timeSignals.frequency.forEach(item => {
        html += `<div class="read-item">${item.word} (${item.percentage})</div>`;
      });
      html += '</div>';
      html += '<p style="margin: 1.5rem 0 1rem;"><strong>Regular time expressions:</strong></p>';
      html += '<div class="read-grid">';
      data.timeSignals.regular.forEach(word => {
        html += `<div class="read-item">${word}</div>`;
      });
      html += '</div></div></div>';
      
      // Common Errors
      html += '<div class="read-section">';
      html += '<div class="read-section-title"><span class="read-section-icon">‚ö†Ô∏è</span>Common Mistakes</div>';
      data.commonErrors.forEach(error => {
        html += '<div class="read-use-item">';
        html += '<div class="read-use-text">';
        html += `<div style="color: #ef4444; margin-bottom: 0.5rem;">‚ùå ${error.wrong}</div>`;
        html += `<div style="color: #10b981; margin-bottom: 0.5rem;">‚úÖ ${error.correct}</div>`;
        html += `<div class="read-use-example">${error.explanation}</div>`;
        html += '</div></div>';
      });
      html += '</div>';
      
      html += '</div>';
      contentArea.innerHTML = html;
    }

    // RENDER SLIDES VIEW
    function renderSlidesView(content) {
      // Get context-specific data
      const contextData = content[currentContext];
      if (!contextData || !contextData.slides) {
        contentArea.innerHTML = '<p style="color: #ef4444;">No slides available for this context yet.</p>';
        return;
      }
      
      const slides = contextData.slides;
      totalSlides = slides.length;
      
      // Update navigation
      slideCounter.textContent = `${currentSlide + 1}/${totalSlides}`;
      prevSlide.disabled = currentSlide === 0;
      nextSlide.disabled = currentSlide === totalSlides - 1;
      
      // Render current slide
      const slide = slides[currentSlide];
      let html = '<div class="slide-container">';
      
      if (currentMode === 'watch') {
        // Watch slides - story sentences
        html += `<div class="slide-icon" style="font-size: ${slide.iconSize}">${slide.icon}</div>`;
        html += `<div class="slide-text">`;
        
        // Highlight words if specified
        let text = slide.text;
        if (slide.highlights) {
          slide.highlights.forEach(word => {
            text = text.replace(new RegExp(`\\b${word}\\b`, 'g'), `<span class="highlight">${word}</span>`);
          });
        }
        html += text;
        html += `</div>`;
        
      } else {
        // Read slides - grammar explanations
        renderReadSlide(slide, html);
        html = renderReadSlide(slide);
      }
      
      // Progress dots
      html += '<div class="slide-progress">';
      for (let i = 0; i < totalSlides; i++) {
        html += `<div class="progress-dot ${i === currentSlide ? 'active' : ''}" data-slide="${i}"></div>`;
      }
      html += '</div>';
      
      html += '</div>';
      contentArea.innerHTML = html;
      
      // Add click handlers to progress dots
      document.querySelectorAll('.progress-dot').forEach(dot => {
        dot.addEventListener('click', function() {
          currentSlide = parseInt(this.dataset.slide);
          renderContent();
        });
      });
    }

    // RENDER READ SLIDE
    function renderReadSlide(slide) {
      let html = '<div class="slide-container"';
      if (slide.backgroundColor) {
        html += ` style="background: ${slide.backgroundColor}; border-radius: 1.5rem; padding: 3rem 2rem;"`;
      }
      html += '>';
      
      html += `<div class="slide-icon" style="font-size: ${slide.iconSize}">${slide.icon}</div>`;
      
      switch(slide.type) {
        case 'overview':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += `<div class="slide-subtitle">${slide.subtitle}</div>`;
          html += `<div class="slide-subtitle" style="font-size: 1.25rem; font-weight: 500;">${slide.description}</div>`;
          break;
          
        case 'form':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += `<div class="formula-box">${slide.formula}</div>`;
          html += '<div class="examples-grid">';
          slide.examples.forEach(ex => {
            if (ex.left) html += `<div class="example-item">${ex.left}</div>`;
            if (ex.right) html += `<div class="example-item">${ex.right}</div>`;
          });
          html += '</div>';
          break;
          
        case 'uses':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += '<div class="uses-list">';
          slide.items.forEach(item => {
            html += `<div class="use-item">`;
            html += `<span class="use-icon">${item.icon}</span>`;
            html += `<span>${item.text}</span>`;
            html += `</div>`;
          });
          html += '</div>';
          break;
          
        case 'time-signals':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += '<div class="frequency-bars">';
          slide.frequency.forEach(item => {
            html += '<div class="frequency-item">';
            html += `<div class="frequency-word">${item.word}</div>`;
            html += '<div class="frequency-bar">';
            html += `<div class="frequency-fill" style="width: ${item.bar}"></div>`;
            html += `<div class="frequency-percentage">${item.bar}</div>`;
            html += '</div></div>';
          });
          html += '</div>';
          
          if (slide.regular) {
            html += '<div class="time-words">';
            slide.regular.forEach(word => {
              html += `<div class="time-word-chip">${word}</div>`;
            });
            html += '</div>';
          }
          break;
          
        case 'examples':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += '<div class="sentences-list">';
          slide.sentences.forEach(sentence => {
            html += `<div class="sentence-item">${sentence}</div>`;
          });
          html += '</div>';
          break;
          
        case 'common-mistake':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += '<div class="mistake-comparison">';
          html += `<div class="mistake-wrong">${slide.wrong} ‚ùå</div>`;
          html += '<div class="mistake-arrow">‚Üì</div>';
          html += `<div class="mistake-correct">${slide.correct} ‚úÖ</div>`;
          html += `<div class="mistake-tip">${slide.tip}</div>`;
          html += '</div>';
          break;
          
        case 'practice-prompt':
          html += `<div class="slide-title">${slide.title}</div>`;
          html += '<div class="practice-question">';
          html += `<div class="practice-prompt">${slide.prompt}</div>`;
          html += `<div class="practice-sentence">${slide.question}</div>`;
          html += `<div class="practice-hint">${slide.hint}</div>`;
          html += '</div>';
          break;
      }
      
      html += '</div>';
      return html;
    }

    // AUDIO PLAYBACK (Text-to-Speech)
    playBtn.addEventListener('click', () => {
      if (currentFormat === 'slides' && currentMode === 'watch') {
        playSlideshow();
      } else if (currentFormat === 'text' && currentMode === 'watch') {
        speakText();
      }
    });

    pauseBtn.addEventListener('click', () => {
      stopAudio();
    });

    // HIGHLIGHT VERBS IN DRILL SENTENCES
    function highlightDrillVerbs(sentence) {
      // Common verb patterns to highlight in blue
      const verbPatterns = [
        // Main verbs (base forms and conjugations)
        /\b(am|is|are|was|were|be|being|been)\b/gi,
        /\b(have|has|had|having)\b/gi,
        /\b(do|does|did|doing|done)\b/gi,
        /\b(will|would|shall|should|can|could|may|might|must)\b/gi,
        
        // Regular verbs (various forms)
        /\b(\w+s)\s/g, // 3rd person singular (works, plays, etc.)
        /\b(\w+ed)\b/gi, // Past tense (worked, played, visited)
        /\b(\w+ing)\b/gi, // -ing forms (working, playing)
        
        // Common irregular verbs
        /\b(go|goes|went|gone|going)\b/gi,
        /\b(get|gets|got|gotten|getting)\b/gi,
        /\b(make|makes|made|making)\b/gi,
        /\b(take|takes|took|taken|taking)\b/gi,
        /\b(come|comes|came|coming)\b/gi,
        /\b(see|sees|saw|seen|seeing)\b/gi,
        /\b(know|knows|knew|known|knowing)\b/gi,
        /\b(think|thinks|thought|thinking)\b/gi,
        /\b(give|gives|gave|given|giving)\b/gi,
        /\b(find|finds|found|finding)\b/gi,
        /\b(tell|tells|told|telling)\b/gi,
        /\b(become|becomes|became|becoming)\b/gi,
        /\b(leave|leaves|left|leaving)\b/gi,
        /\b(feel|feels|felt|feeling)\b/gi,
        /\b(bring|brings|brought|bringing)\b/gi,
        /\b(begin|begins|began|begun|beginning)\b/gi,
        /\b(keep|keeps|kept|keeping)\b/gi,
        /\b(hold|holds|held|holding)\b/gi,
        /\b(write|writes|wrote|written|writing)\b/gi,
        /\b(stand|stands|stood|standing)\b/gi,
        /\b(hear|hears|heard|hearing)\b/gi,
        /\b(let|lets|letting)\b/gi,
        /\b(mean|means|meant|meaning)\b/gi,
        /\b(set|sets|setting)\b/gi,
        /\b(meet|meets|met|meeting)\b/gi,
        /\b(run|runs|ran|running)\b/gi,
        /\b(pay|pays|paid|paying)\b/gi,
        /\b(sit|sits|sat|sitting)\b/gi,
        /\b(speak|speaks|spoke|spoken|speaking)\b/gi,
        /\b(lie|lies|lay|lain|lying)\b/gi,
        /\b(lead|leads|led|leading)\b/gi,
        /\b(read|reads|reading)\b/gi,
        /\b(grow|grows|grew|grown|growing)\b/gi,
        /\b(lose|loses|lost|losing)\b/gi,
        /\b(fall|falls|fell|fallen|falling)\b/gi,
        /\b(send|sends|sent|sending)\b/gi,
        /\b(build|builds|built|building)\b/gi,
        /\b(understand|understands|understood|understanding)\b/gi,
        /\b(draw|draws|drew|drawn|drawing)\b/gi,
        /\b(break|breaks|broke|broken|breaking)\b/gi,
        /\b(spend|spends|spent|spending)\b/gi,
        /\b(cut|cuts|cutting)\b/gi,
        /\b(rise|rises|rose|risen|rising)\b/gi,
        /\b(drive|drives|drove|driven|driving)\b/gi,
        /\b(buy|buys|bought|buying)\b/gi,
        /\b(wear|wears|wore|worn|wearing)\b/gi,
        /\b(choose|chooses|chose|chosen|choosing)\b/gi,
        /\b(seek|seeks|sought|seeking)\b/gi,
        /\b(throw|throws|threw|thrown|throwing)\b/gi,
        /\b(catch|catches|caught|catching)\b/gi,
        /\b(deal|deals|dealt|dealing)\b/gi,
        /\b(win|wins|won|winning)\b/gi,
        /\b(forget|forgets|forgot|forgotten|forgetting)\b/gi,
        /\b(show|shows|showed|shown|showing)\b/gi,
        /\b(drink|drinks|drank|drunk|drinking)\b/gi,
        /\b(eat|eats|ate|eaten|eating)\b/gi,
        /\b(teach|teaches|taught|teaching)\b/gi,
        /\b(learn|learns|learned|learnt|learning)\b/gi,
        /\b(study|studies|studied|studying)\b/gi,
        /\b(watch|watches|watched|watching)\b/gi,
        /\b(listen|listens|listened|listening)\b/gi,
        /\b(cook|cooks|cooked|cooking)\b/gi,
        /\b(work|works|worked|working)\b/gi,
        /\b(play|plays|played|playing)\b/gi,
        /\b(live|lives|lived|living)\b/gi,
        /\b(walk|walks|walked|walking)\b/gi,
        /\b(talk|talks|talked|talking)\b/gi,
        /\b(call|calls|called|calling)\b/gi,
        /\b(try|tries|tried|trying)\b/gi,
        /\b(ask|asks|asked|asking)\b/gi,
        /\b(need|needs|needed|needing)\b/gi,
        /\b(seem|seems|seemed|seeming)\b/gi,
        /\b(help|helps|helped|helping)\b/gi,
        /\b(love|loves|loved|loving)\b/gi,
        /\b(start|starts|started|starting)\b/gi,
        /\b(stop|stops|stopped|stopping)\b/gi,
        /\b(open|opens|opened|opening)\b/gi,
        /\b(close|closes|closed|closing)\b/gi,
        /\b(arrive|arrives|arrived|arriving)\b/gi,
        /\b(depart|departs|departed|departing)\b/gi,
        /\b(finish|finishes|finished|finishing)\b/gi,
        /\b(end|ends|ended|ending)\b/gi,
        /\b(visit|visits|visited|visiting)\b/gi,
        /\b(travel|travels|traveled|travelled|traveling|travelling)\b/gi,
        /\b(wake|wakes|woke|woken|waking)\b/gi,
        /\b(sleep|sleeps|slept|sleeping)\b/gi,
        /\b(brush|brushes|brushed|brushing)\b/gi,
        
        // Phrasal verbs
        /\b(wake up|wakes up|woke up|waking up)\b/gi,
        /\b(get up|gets up|got up|getting up)\b/gi,
        /\b(go out|goes out|went out|going out)\b/gi,
        /\b(come back|comes back|came back|coming back)\b/gi,
        /\b(look at|looks at|looked at|looking at)\b/gi,
        /\b(turn on|turns on|turned on|turning on)\b/gi,
        /\b(turn off|turns off|turned off|turning off)\b/gi,
        /\b(pick up|picks up|picked up|picking up)\b/gi,
        /\b(put on|puts on|putting on)\b/gi,
        /\b(take off|takes off|took off|taking off)\b/gi
      ];
      
      let highlighted = sentence;
      
      // Apply highlighting to each verb pattern
      verbPatterns.forEach(pattern => {
        highlighted = highlighted.replace(pattern, (match) => {
          return `<span style="color: #60a5fa; font-weight: 700;">${match}</span>`;
        });
      });
      
      return highlighted;
    }

    // RENDER DRILL VIEW
    function renderDrillView() {
      if (!GRAMMAR_DATA || !GRAMMAR_DATA.drill) {
        contentArea.innerHTML = '<div class="drill-container"><p style="color: #ef4444;">Drill mode not available for this tense yet.</p></div>';
        slideNavigation.style.display = 'none';
        return;
      }

      const drillData = GRAMMAR_DATA.drill[currentContext];
      if (!drillData || !drillData.sentences) {
        contentArea.innerHTML = '<div class="drill-container"><p style="color: #ef4444;">No drill sentences available for this context.</p></div>';
        slideNavigation.style.display = 'none';
        return;
      }

      const sentences = drillData.sentences;
      totalSlides = sentences.length;
      
      // Show slide navigation for drill
      slideNavigation.style.display = 'flex';
      slideCounter.textContent = `${currentSlide + 1}/${totalSlides}`;

      // Build drill HTML
      let html = '<div class="drill-container">';
      
      // Counter
      html += `<div class="drill-counter">Sentence ${currentSlide + 1} of ${totalSlides}</div>`;
      
      // Current sentence with verb highlighting
      const highlightedSentence = highlightDrillVerbs(sentences[currentSlide]);
      html += `
        <div class="drill-sentence">
          <div class="drill-sentence-text">${highlightedSentence}</div>
        </div>
      `;
      
      // Controls
      html += `
        <div class="drill-controls">
          <button class="drill-btn" id="drillPlayBtn">
            <span class="drill-btn-icon">üîä</span>
            <span>Play</span>
          </button>
          <button class="drill-btn" id="drillNextBtn">
            <span>Next</span>
            <span class="drill-btn-icon">‚Üí</span>
          </button>
        </div>
      `;
      
      // Progress dots
      html += '<div class="drill-progress">';
      for (let i = 0; i < Math.min(totalSlides, 50); i++) {
        const dotClass = i === currentSlide ? 'active' : (i < currentSlide ? 'completed' : '');
        html += `<div class="drill-dot ${dotClass}"></div>`;
      }
      html += '</div>';
      
      // Show transformations if available (every 10th sentence)
      if (drillData.transformations && currentSlide % 10 === 0 && currentSlide > 0) {
        const transIndex = Math.floor(currentSlide / 10) - 1;
        if (drillData.transformations[transIndex]) {
          const trans = drillData.transformations[transIndex];
          html += `
            <div class="drill-transformation">
              <div class="drill-transformation-title">Practice Transformations:</div>
              <div class="drill-transformation-item">
                <span class="drill-transformation-label">‚úì Affirmative:</span>
                <span class="drill-transformation-text">${highlightDrillVerbs(trans.affirmative)}</span>
              </div>
              <div class="drill-transformation-item">
                <span class="drill-transformation-label">‚úó Negative:</span>
                <span class="drill-transformation-text">${highlightDrillVerbs(trans.negative)}</span>
              </div>
              <div class="drill-transformation-item">
                <span class="drill-transformation-label">‚ùì Question:</span>
                <span class="drill-transformation-text">${highlightDrillVerbs(trans.question)}</span>
              </div>
            </div>
          `;
        }
      }
      
      html += '</div>';
      
      contentArea.innerHTML = html;
      
      // Attach drill button listeners
      const drillPlayBtn = document.getElementById('drillPlayBtn');
      const drillNextBtn = document.getElementById('drillNextBtn');
      
      if (drillPlayBtn) {
        drillPlayBtn.addEventListener('click', () => {
          speakDrillSentence(sentences[currentSlide]);
        });
      }
      
      if (drillNextBtn) {
        drillNextBtn.addEventListener('click', () => {
          if (currentSlide < totalSlides - 1) {
            currentSlide++;
            renderDrillView();
          } else {
            currentSlide = 0;
            renderDrillView();
          }
        });
      }
    }

    function speakDrillSentence(text) {
      stopAudio();
      
      const drillPlayBtn = document.getElementById('drillPlayBtn');
      if (drillPlayBtn) {
        drillPlayBtn.classList.add('playing'); // Add red line
      }
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.85;
      utterance.pitch = 1.0;
      utterance.lang = 'en-GB';
      
      // Select British English voice
      const voices = speechSynthesis.getVoices();
      const gbVoice = voices.find(v => v.lang.startsWith('en-GB') || v.lang.startsWith('en-'));
      if (gbVoice) utterance.voice = gbVoice;
      
      // Remove red line when done
      utterance.onend = () => {
        if (drillPlayBtn) {
          drillPlayBtn.classList.remove('playing');
        }
      };
      
      utterance.onerror = () => {
        if (drillPlayBtn) {
          drillPlayBtn.classList.remove('playing');
        }
      };
      
      speechSynthesis.speak(utterance);
    }

    document.getElementById('replayBtn').addEventListener('click', () => {
      currentSlide = 0;
      renderContent();
      if (currentFormat === 'slides') {
        playSlideshow();
      } else {
        speakText();
      }
    });

    function stopAudio() {
      isPlaying = false;
      isSpeaking = false;
      speechSynthesis.cancel();
      playBtn.style.display = 'flex';
      pauseBtn.style.display = 'none';
      playBtn.classList.remove('playing'); // Remove red line
      pauseBtn.classList.remove('playing'); // Remove red line
    }

    function speakText() {
      if (!GRAMMAR_DATA) return;
      
      stopAudio();
      
      const contextData = GRAMMAR_DATA.watch[currentContext];
      if (!contextData || !contextData.text) return;
      
      const textData = contextData.text;
      isSpeaking = true;
      playBtn.style.display = 'none';
      pauseBtn.style.display = 'flex';
      pauseBtn.classList.add('playing'); // Add red line
      
      currentUtterance = new SpeechSynthesisUtterance(textData.content);
      currentUtterance.lang = 'en-GB';
      currentUtterance.rate = 0.85;
      currentUtterance.pitch = 1.0;
      
      const voices = speechSynthesis.getVoices();
      const selectedVoice = voices.find(v => v.lang.includes('en-GB')) || voices.find(v => v.lang.includes('en-'));
      if (selectedVoice) {
        currentUtterance.voice = selectedVoice;
      }
      
      currentUtterance.onend = () => {
        stopAudio();
      };
      
      currentUtterance.onerror = () => {
        stopAudio();
      };
      
      speechSynthesis.speak(currentUtterance);
    }

    async function playSlideshow() {
      if (!GRAMMAR_DATA) return;
      
      stopAudio();
      isPlaying = true;
      playBtn.style.display = 'none';
      pauseBtn.style.display = 'flex';
      pauseBtn.classList.add('playing'); // Add red line
      
      const contextData = GRAMMAR_DATA.watch[currentContext];
      if (!contextData || !contextData.slides) {
        stopAudio();
        return;
      }
      
      const slides = contextData.slides;
      
      for (let i = currentSlide; i < slides.length && isPlaying; i++) {
        currentSlide = i;
        renderContent();
        
        const slide = slides[i];
        
        // Speak the slide text
        await speakSlide(slide.text);
        
        // Small pause between slides
        if (isPlaying) {
          await new Promise(resolve => setTimeout(resolve, 800));
        }
      }
      
      stopAudio();
    }

    function speakSlide(text) {
      return new Promise((resolve) => {
        if (!isPlaying) {
          resolve();
          return;
        }
        
        currentUtterance = new SpeechSynthesisUtterance(text);
        currentUtterance.lang = 'en-GB';
        currentUtterance.rate = 0.85;
        currentUtterance.pitch = 1.0;
        
        const voices = speechSynthesis.getVoices();
        const selectedVoice = voices.find(v => v.lang.includes('en-GB')) || voices.find(v => v.lang.includes('en-'));
        if (selectedVoice) {
          currentUtterance.voice = selectedVoice;
        }
        
        currentUtterance.onend = () => resolve();
        currentUtterance.onerror = () => resolve();
        
        speechSynthesis.speak(currentUtterance);
      });
    }

    // Load voices
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = () => {
        console.log('üîä Voices loaded:', speechSynthesis.getVoices().length);
      };
    }

    // INITIALIZE
    loadData(); // Load current tense immediately
    preloadAllData(); // Preload all other tenses in background
  </script>
</body>
</html>
