<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY - Speaking Part 2</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
      background: #0d0d0d;
      background-image: radial-gradient(circle at 20% 50%, rgba(201, 169, 97, 0.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(201, 169, 97, 0.03) 0%, transparent 50%);
      color: #e5e5e5;
      min-height: 100vh;
      padding: 1rem;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* HEADER */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem 0;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .back-link {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      color: #8e8e93;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .back-link:hover { color: #C9A961; }

    .header-content {
      text-align: center;
    }

    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.04em;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 0.8125rem;
      color: #8e8e93;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .subtitle-mode {
      color: #C9A961;
      font-weight: 600;
    }

    /* MODE TOGGLE - Minimalist */
    .mode-toggle-container {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .mode-toggle-label {
      font-size: 0.75rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-weight: 600;
    }

    .mode-toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      background: rgba(48, 48, 51, 0.8);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(84, 84, 88, 0.3);
    }

    .mode-toggle-switch:hover {
      border-color: rgba(201, 169, 97, 0.4);
    }

    .mode-toggle-switch.compare {
      background: rgba(201, 169, 97, 0.2);
      border-color: rgba(201, 169, 97, 0.5);
    }

    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 22px;
      height: 22px;
      background: #8e8e93;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.625rem;
    }

    .mode-toggle-switch.compare .toggle-slider {
      left: 26px;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
    }

    .mode-hint {
      font-size: 0.6875rem;
      color: #8e8e93;
      font-style: italic;
    }

    /* COMPARISON QUESTION - Compact & Always Visible */
    .comparison-question {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-left: 3px solid #60a5fa;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      display: none;
    }

    .comparison-question.active { display: block; }

    .question-label {
      font-size: 0.6875rem;
      color: #60a5fa;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .question-text {
      font-size: 0.9375rem;
      color: #e5e5e7;
      font-weight: 600;
      line-height: 1.4;
    }

    /* PICTURE SELECTOR */
    .picture-selector {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .picture-selector label {
      display: block;
      font-size: 0.875rem;
      color: #8e8e93;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-weight: 600;
    }

    .picture-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
    }

    .picture-card {
      position: relative;
      aspect-ratio: 4/3;
      border-radius: 0.75rem;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid rgba(84, 84, 88, 0.3);
      transition: all 0.3s ease;
    }

    .picture-card:hover {
      border-color: rgba(201, 169, 97, 0.6);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(201, 169, 97, 0.3);
    }

    .picture-card.active {
      border-color: #C9A961;
      box-shadow: 0 8px 24px rgba(201, 169, 97, 0.4);
    }

    .picture-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .picture-label {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      padding: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-align: center;
      color: #fff;
    }

    /* MAIN STAGE */
    .main-stage {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    /* PHOTO DISPLAY */
    .photo-container {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1.5rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .photo-display {
      display: grid;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .photo-display.single-mode { grid-template-columns: 1fr; }
    .photo-display.compare-mode { grid-template-columns: 1fr 1fr; }

    .photo-wrapper {
      position: relative;
      width: 100%;
      border-radius: 1rem;
      overflow: hidden;
      background: #000;
    }

    .photo-wrapper img {
      width: 100%;
      height: auto;
      display: block;
    }

    .photo-number {
      position: absolute;
      top: 0.75rem;
      left: 0.75rem;
      background: rgba(201, 169, 97, 0.9);
      color: #0d0d0d;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
      display: none;
    }

    .compare-mode .photo-number { display: flex; }

    /* HIGHLIGHT OVERLAY */
    .highlight-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .highlight-area {
      position: absolute;
      border: 3px solid #C9A961;
      background: rgba(201, 169, 97, 0.2);
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
      box-shadow: 0 0 20px rgba(201, 169, 97, 0.6);
    }

    .highlight-area.active {
      opacity: 1;
      animation: pulse-highlight 2s ease-in-out infinite;
    }

    @keyframes pulse-highlight {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* KAREN STATUS */
    .karen-status {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: rgba(48, 48, 51, 0.5);
      border-radius: 0.75rem;
      border: 1px solid rgba(84, 84, 88, 0.2);
    }

    .karen-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.6) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      border: 2px solid rgba(201, 169, 97, 0.3);
      flex-shrink: 0;
    }

    .karen-avatar.speaking {
      border-color: #C9A961;
      box-shadow: 0 0 20px rgba(201, 169, 97, 0.6);
      animation: pulse-avatar 1.5s ease-in-out infinite;
    }

    @keyframes pulse-avatar {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .karen-text {
      flex: 1;
      min-width: 0;
    }

    .karen-label {
      font-size: 0.75rem;
      color: #8e8e93;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 0.25rem;
    }

    .karen-speech {
      font-size: 0.9375rem;
      color: #e5e5e7;
      line-height: 1.5;
      font-style: italic;
    }

    /* STRUCTURE TRACKER */
    .structure-tracker {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      padding: 1.5rem;
    }

    .structure-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .structure-step {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      background: rgba(48, 48, 51, 0.3);
      border-radius: 0.5rem;
      border-left: 3px solid rgba(99, 99, 102, 0.3);
      transition: all 0.3s ease;
    }

    .structure-step.completed {
      border-left-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }

    .structure-step.active {
      border-left-color: #C9A961;
      background: rgba(201, 169, 97, 0.15);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.2);
    }

    .step-icon {
      font-size: 1.25rem;
      opacity: 0.3;
    }

    .structure-step.completed .step-icon,
    .structure-step.active .step-icon { opacity: 1; }

    .step-content { flex: 1; }

    .step-label {
      font-size: 0.8125rem;
      font-weight: 600;
      color: #e5e5e7;
      margin-bottom: 0.125rem;
    }

    .step-hint {
      font-size: 0.6875rem;
      color: #8e8e93;
      font-style: italic;
    }

    /* VOCABULARY */
    .vocabulary-box {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1rem;
      border: 1px solid rgba(96, 165, 250, 0.25);
      padding: 1.5rem;
    }

    .vocab-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #60a5fa;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .vocab-item {
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(84, 84, 88, 0.15);
      opacity: 0.4;
      transition: opacity 0.3s ease;
    }

    .vocab-item:last-child { border-bottom: none; }

    .vocab-item.highlighted {
      opacity: 1;
      animation: flash-vocab 0.5s ease;
    }

    @keyframes flash-vocab {
      0%, 100% { background: transparent; }
      50% { background: rgba(96, 165, 250, 0.2); }
    }

    .vocab-phrase {
      font-size: 0.875rem;
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 0.125rem;
    }

    .vocab-usage {
      font-size: 0.75rem;
      color: #8e8e93;
      font-style: italic;
    }

    /* CONTROLS */
    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 2rem;
      flex-wrap: wrap;
    }

    .control-btn {
      padding: 0.875rem 1.5rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #8e8e93;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .control-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
      transform: translateY(-2px);
    }

    .control-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .control-btn.primary {
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      border-color: #C9A961;
      color: #0d0d0d;
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    .control-btn.primary:hover {
      background: linear-gradient(135deg, #d4b46e 0%, #C9A961 100%);
      box-shadow: 0 6px 16px rgba(201, 169, 97, 0.4);
    }

    /* TIMER */
    .timer {
      text-align: center;
      margin-top: 1rem;
    }

    .timer-display {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 0.25rem;
    }

    .timer-label {
      font-size: 0.75rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    /* YOUR TURN */
    .your-turn-section {
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.05) 100%);
      border: 2px solid #C9A961;
      border-radius: 1.5rem;
      padding: 2.5rem 2rem;
      text-align: center;
      margin-top: 2rem;
      animation: fadeInScale 0.5s ease;
      display: none;
    }

    .your-turn-section.active { display: block; }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .prompt-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .prompt-text {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1rem;
    }

    .prompt-hint {
      font-size: 1rem;
      color: #e5e5e7;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }

    .prompt-tips {
      background: rgba(28, 28, 30, 0.5);
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .prompt-tips-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .prompt-tips ul {
      list-style: none;
      padding: 0;
    }

    .prompt-tips li {
      font-size: 0.8125rem;
      color: #e5e5e7;
      padding: 0.25rem 0 0.25rem 1.5rem;
      position: relative;
    }

    .prompt-tips li::before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #4ade80;
      font-weight: 700;
    }

    /* MOBILE */
    @media (max-width: 1024px) {
      .main-stage { grid-template-columns: 1fr; }
      .sidebar { order: 2; }
      .photo-container { order: 1; }
      .photo-display.compare-mode { grid-template-columns: 1fr; }
    }

    @media (max-width: 768px) {
      .picture-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      .controls { flex-direction: column; gap: 0.75rem; }
      .control-btn { width: 100%; justify-content: center; }
      
      .header {
        flex-direction: column;
        gap: 1rem;
      }
      
      .back-link {
        position: static;
        transform: none;
        align-self: flex-start;
      }
      
      .mode-toggle-container {
        position: static;
        transform: none;
        align-self: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <div class="header">
      <a href="../../../index.html?openModal=speaking" class="back-link">‚Üê Back</a>
      
      <div class="header-content">
        <h1>INTUITY</h1>
        <p class="subtitle">
          Speaking Part 2 ¬∑ Long Turn
          <span class="subtitle-mode" id="subtitleMode">Single Photo</span>
        </p>
      </div>
      
      <!-- MODE TOGGLE -->
      <div class="mode-toggle-container">
        <div class="mode-toggle-label">MODE</div>
        <div class="mode-toggle-switch" id="modeToggle" onclick="toggleMode()">
          <div class="toggle-slider">1Ô∏è‚É£</div>
        </div>
        <div class="mode-hint" id="modeHint">Single Photo</div>
      </div>
    </div>

    <div class="comparison-question" id="comparisonQuestion">
      <div class="question-label">Your Task</div>
      <div class="question-text" id="questionText"></div>
    </div>

    <div class="picture-selector">
      <label id="selectorLabel">Choose a Photo to Describe</label>
      <div class="picture-grid" id="pictureGrid"></div>
    </div>

    <div class="main-stage">
      
      <div class="photo-container">
        <div class="photo-display single-mode" id="photoDisplay">
          <div class="photo-wrapper">
            <img id="mainPhoto1" src="" alt="Photo 1" style="display: none;">
            <div class="photo-number">1</div>
            <div class="highlight-overlay" id="highlightOverlay1"></div>
          </div>
          <div class="photo-wrapper" id="photo2Wrapper" style="display: none;">
            <img id="mainPhoto2" src="" alt="Photo 2" style="display: none;">
            <div class="photo-number">2</div>
            <div class="highlight-overlay" id="highlightOverlay2"></div>
          </div>
        </div>
        
        <div class="karen-status">
          <div class="karen-avatar" id="karenAvatar">üë©</div>
          <div class="karen-text">
            <div class="karen-label">Karen is speaking</div>
            <div class="karen-speech" id="karenSpeech">Select photos to begin...</div>
          </div>
        </div>

        <div class="timer">
          <div class="timer-display" id="timerDisplay">1:00</div>
          <div class="timer-label">Speaking Time</div>
        </div>
      </div>

      <div class="sidebar">
        
        <div class="structure-tracker">
          <div class="structure-title" id="structureTitle">üìã Description Structure</div>
          
          <div class="structure-step" id="step-1">
            <div class="step-icon" id="step-icon-1">üëÅÔ∏è</div>
            <div class="step-content">
              <div class="step-label" id="step-label-1">Overview</div>
              <div class="step-hint" id="step-hint-1">What & where</div>
            </div>
          </div>
          
          <div class="structure-step" id="step-2">
            <div class="step-icon" id="step-icon-2">üîç</div>
            <div class="step-content">
              <div class="step-label" id="step-label-2">Details</div>
              <div class="step-hint" id="step-hint-2">Who & what doing</div>
            </div>
          </div>
          
          <div class="structure-step" id="step-3">
            <div class="step-icon" id="step-icon-3">üí≠</div>
            <div class="step-content">
              <div class="step-label" id="step-label-3">Speculation</div>
              <div class="step-hint" id="step-hint-3">Why & feelings</div>
            </div>
          </div>
        </div>

        <div class="vocabulary-box">
          <div class="vocab-title">üí° Key Vocabulary</div>
          <div id="vocabList"></div>
        </div>

      </div>

    </div>

    <div class="controls">
      <button class="control-btn" id="playBtn" onclick="startDescription()">
        ‚ñ∂Ô∏è Play Karen
      </button>
      <button class="control-btn" id="pauseBtn" onclick="pauseDescription()" disabled>
        ‚è∏Ô∏è Pause
      </button>
      <button class="control-btn" id="replayBtn" onclick="replayDescription()">
        üîÅ Replay
      </button>
      <button class="control-btn" id="slowerBtn" onclick="toggleSpeed()">
        üêå Slower
      </button>
      <button class="control-btn primary" id="yourTurnBtn" onclick="showYourTurn()" style="display: none;">
        üéôÔ∏è Your Turn
      </button>
    </div>

    <div class="your-turn-section" id="yourTurnSection">
      <div class="prompt-icon">üéôÔ∏è</div>
      <div class="prompt-text">Now It's Your Turn!</div>
      <div class="prompt-hint" id="promptHint"></div>
      
      <div class="prompt-tips">
        <div class="prompt-tips-title">Remember to include:</div>
        <ul id="promptTipsList"></ul>
      </div>
      
      <button class="control-btn primary" onclick="startRecording()">
        üî¥ Start Recording (60 seconds)
      </button>
    </div>

  </div>

  <!-- JavaScript will be added next -->
</body>
</html>

  <script>
// EMBEDDED DATA - In production, load from JSON files
const SINGLE_PHOTOS = [
  {
    id: "family-home",
    title: "Family at Home",
    image: "https://images.unsplash.com/photo-1476703993599-0035a21b17a9?w=800",
    description: [
      {
        step: "overview",
        text: "In this warm and cozy photograph, I can see a mother sitting indoors with two young children. The setting appears to be a comfortable living room, probably during the daytime given the natural lighting.",
        vocabulary: [
          { phrase: "I can see", usage: "Introducing visible elements" },
          { phrase: "appears to be", usage: "Making observations" }
        ]
      },
      {
        step: "details",
        text: "In the center, there's a woman with red hair wearing dark clothing, seated on a grey sofa with two children - a toddler and a baby. The toddler appears focused on a tablet device.",
        vocabulary: [
          { phrase: "In the center", usage: "Describing position" },
          { phrase: "appears focused on", usage: "Observing behavior" }
        ]
      },
      {
        step: "speculation",
        text: "I imagine this is a typical quiet afternoon at home. The mother seems to be entertaining her children with screen time, which is common for young families. The relaxed atmosphere suggests they're comfortable and content.",
        vocabulary: [
          { phrase: "I imagine", usage: "Speculation" },
          { phrase: "seems to be", usage: "Drawing conclusions" }
        ]
      }
    ]
  }
];

const COMPARISON_PAIRS = [
  {
    id: "work-situations",
    question: "Compare the two photographs and say what might be difficult for the people in these situations.",
    photo1: {
      image: "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800",
      title: "Office Meeting"
    },
    photo2: {
      image: "https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=800",
      title: "Working in Caf√©"
    },
    model_comparison: [
      {
        step: "similarities",
        text: "Both photographs show people in working environments. In the first photo, we can see a formal office meeting, while in the second, there's someone working in a caf√©. In both situations, people seem focused on their tasks.",
        vocabulary: [
          { phrase: "Both photographs show", usage: "Starting comparison" },
          { phrase: "while in the second", usage: "Contrasting images" }
        ]
      },
      {
        step: "differences",
        text: "However, there are significant differences. The office meeting looks formal and structured, whereas the caf√© setting appears casual. The first involves collaboration, while the second shows independent work.",
        vocabulary: [
          { phrase: "However, there are", usage: "Introducing contrast" },
          { phrase: "whereas", usage: "Showing difference" }
        ]
      },
      {
        step: "answer_question",
        text: "Regarding what might be difficult, I'd say that in the office meeting, the challenge could be managing different opinions and reaching consensus as a group. There might also be pressure to perform in front of colleagues. In the caf√© situation, the main difficulty would probably be the distractions - background noise, people moving around, and the general lack of privacy. It might also be hard to stay motivated without the structure of an office environment. One other possibility is that working alone for long periods could feel isolating.",
        vocabulary: [
          { phrase: "Regarding what might be", usage: "Addressing question" },
          { phrase: "I'd say that", usage: "Giving opinion" },
          { phrase: "could be", usage: "Speculation" },
          { phrase: "There might also be", usage: "Additional speculation" },
          { phrase: "would probably be", usage: "Strong likelihood" },
          { phrase: "It might also be", usage: "Another possibility" },
          { phrase: "One other possibility is that", usage: "Adding speculation" }
        ]
      }
    ]
  },
  {
    id: "outdoor-activities",
    question: "Compare the two photographs and say why the people might have decided to spend their time in these ways.",
    photo1: {
      image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800",
      title: "Beach Sunset"
    },
    photo2: {
      image: "https://images.unsplash.com/photo-1551632811-561732d1e306?w=800",
      title: "Mountain Hiking"
    },
    model_comparison: [
      {
        step: "similarities",
        text: "Both photographs show people enjoying outdoor activities in natural settings. The first captures a stunning tropical beach, while the second shows mountain hiking. In both cases, people have chosen beautiful, peaceful environments.",
        vocabulary: [
          { phrase: "Both photographs show", usage: "Opening comparison" },
          { phrase: "In both cases", usage: "Common feature" }
        ]
      },
      {
        step: "differences",
        text: "The main difference is the type of experience. The beach offers relaxation and tranquility, whereas the mountain requires physical effort and stamina. The beach seems accessible, while the mountain requires preparation.",
        vocabulary: [
          { phrase: "The main difference is", usage: "Key contrast" },
          { phrase: "whereas", usage: "Direct comparison" }
        ]
      },
      {
        step: "answer_question",
        text: "As for why people chose these activities, I imagine the beach-goers wanted to escape stress and simply relax in a warm, beautiful location. They probably needed a break from their busy lives and wanted somewhere peaceful. The mountain hiker, however, likely chose this activity for the challenge and sense of achievement. Some people prefer active holidays where they can push themselves physically and mentally. It is likely that the incredible views from high altitude were also a major motivation - it's the kind of experience that makes you feel really alive. One possibility is that this person regularly seeks out physical challenges to maintain their fitness and mental wellbeing.",
        vocabulary: [
          { phrase: "As for why", usage: "Answering the question" },
          { phrase: "I imagine", usage: "Speculation" },
          { phrase: "They probably needed", usage: "Likelihood" },
          { phrase: "however, likely chose", usage: "Contrasting motivation" },
          { phrase: "It is likely that", usage: "Strong probability" },
          { phrase: "One possibility is that", usage: "Suggesting reason" }
        ]
      }
    ]
  }
];

// STATE
let currentMode = 'single';
let currentData = null;
let isPlaying = false;
let isPaused = false;
let currentSegment = 0;
let speechRate = 0.85;
let timerInterval = null;
let timeRemaining = 60;

// INIT
window.addEventListener('load', () => {
  renderPictureGrid();
  updateStructureLabels();
});

// MODE SWITCHING - Minimalist Toggle
function toggleMode() {
  currentMode = currentMode === 'single' ? 'compare' : 'single';
  
  const toggle = document.getElementById('modeToggle');
  const slider = toggle.querySelector('.toggle-slider');
  const modeHint = document.getElementById('modeHint');
  const subtitleMode = document.getElementById('subtitleMode');
  
  if (currentMode === 'compare') {
    toggle.classList.add('compare');
    slider.textContent = '2Ô∏è‚É£';
    modeHint.textContent = 'Compare Photos';
    subtitleMode.textContent = 'B2 Comparison';
  } else {
    toggle.classList.remove('compare');
    slider.textContent = '1Ô∏è‚É£';
    modeHint.textContent = 'Single Photo';
    subtitleMode.textContent = 'Single Photo';
  }
  
  // Update UI elements
  const photoDisplay = document.getElementById('photoDisplay');
  const comparisonQuestion = document.getElementById('comparisonQuestion');
  const selectorLabel = document.getElementById('selectorLabel');
  
  if (currentMode === 'single') {
    photoDisplay.classList.remove('compare-mode');
    photoDisplay.classList.add('single-mode');
    comparisonQuestion.classList.remove('active');
    selectorLabel.textContent = 'Choose a Photo to Describe';
  } else {
    photoDisplay.classList.remove('single-mode');
    photoDisplay.classList.add('compare-mode');
    comparisonQuestion.classList.add('active');
    selectorLabel.textContent = 'Choose a Photo Pair to Compare';
  }
  
  // Reset and reload
  resetAll();
  renderPictureGrid();
  updateStructureLabels();
}

// RENDER PICTURE GRID
function renderPictureGrid() {
  const grid = document.getElementById('pictureGrid');
  grid.innerHTML = '';
  
  const data = currentMode === 'single' ? SINGLE_PHOTOS : COMPARISON_PAIRS;
  
  data.forEach((item, index) => {
    const card = document.createElement('div');
    card.className = 'picture-card';
    card.onclick = () => selectPicture(index);
    
    if (currentMode === 'single') {
      card.innerHTML = `
        <img src="${item.image}" alt="${item.title}">
        <div class="picture-label">${item.title}</div>
      `;
    } else {
      card.innerHTML = `
        <img src="${item.photo1.image}" alt="Pair ${index + 1}">
        <div class="picture-label">Pair ${index + 1}</div>
      `;
    }
    
    grid.appendChild(card);
  });
}

// SELECT PICTURE
function selectPicture(index) {
  const data = currentMode === 'single' ? SINGLE_PHOTOS : COMPARISON_PAIRS;
  currentData = data[index];
  currentSegment = 0;
  
  // Update active card
  document.querySelectorAll('.picture-card').forEach((card, i) => {
    card.classList.toggle('active', i === index);
  });
  
  // Update photos
  const photo1 = document.getElementById('mainPhoto1');
  const photo2Wrapper = document.getElementById('photo2Wrapper');
  const photo2 = document.getElementById('mainPhoto2');
  
  if (currentMode === 'single') {
    photo1.src = currentData.image;
    photo1.style.display = 'block';
    photo2Wrapper.style.display = 'none';
    document.getElementById('comparisonQuestionInline').classList.remove('active');
  } else {
    photo1.src = currentData.photo1.image;
    photo2.src = currentData.photo2.image;
    photo1.style.display = 'block';
    photo2.style.display = 'block';
    photo2Wrapper.style.display = 'block';
    
    // Update question - stays visible above photos
    document.getElementById('questionTextInline').textContent = currentData.question;
    document.getElementById('comparisonQuestionInline').classList.add('active');
  }
  
  // Reset UI
  document.getElementById('karenSpeech').textContent = 'Press Play to hear Karen...';
  document.getElementById('playBtn').disabled = false;
  document.getElementById('pauseBtn').disabled = true;
  document.getElementById('yourTurnBtn').style.display = 'none';
  document.getElementById('yourTurnSection').classList.remove('active');
  
  resetStructureSteps();
  renderVocabulary();
  clearHighlights();
  timeRemaining = 60;
  updateTimer();
}

// UPDATE STRUCTURE LABELS
function updateStructureLabels() {
  if (currentMode === 'single') {
    document.getElementById('structureTitle').textContent = 'üìã Description Structure';
    document.getElementById('vocabTitle').textContent = 'üí° Key Vocabulary';
    document.getElementById('step-label-1').textContent = 'Overview';
    document.getElementById('step-hint-1').textContent = 'What & where';
    document.getElementById('step-label-2').textContent = 'Details';
    document.getElementById('step-hint-2').textContent = 'Who & what doing';
    document.getElementById('step-label-3').textContent = 'Speculation';
    document.getElementById('step-hint-3').textContent = 'Why & feelings';
  } else {
    document.getElementById('structureTitle').textContent = 'üìã Comparison Structure';
    document.getElementById('vocabTitle').textContent = 'üí° Speculation Phrases';
    document.getElementById('step-label-1').textContent = 'Similarities';
    document.getElementById('step-hint-1').textContent = 'What's common';
    document.getElementById('step-label-2').textContent = 'Differences';
    document.getElementById('step-hint-2').textContent = 'How they differ';
    document.getElementById('step-label-3').textContent = 'Answer Question';
    document.getElementById('step-hint-3').textContent = 'Justify & speculate';
  }
}

// START DESCRIPTION
async function startDescription() {
  if (!currentData) {
    alert('Please select a photo first!');
    return;
  }
  
  isPlaying = true;
  isPaused = false;
  
  document.getElementById('playBtn').disabled = true;
  document.getElementById('pauseBtn').disabled = false;
  document.getElementById('karenAvatar').classList.add('speaking');
  
  startTimer();
  await describeContent();
}

// DESCRIBE CONTENT
async function describeContent() {
  const segments = currentMode === 'single' 
    ? currentData.description 
    : currentData.model_comparison;
  
  while (currentSegment < segments.length && isPlaying && !isPaused) {
    const segment = segments[currentSegment];
    
    // Update structure step
    updateStructureStep(currentSegment + 1);
    
    // Display text
    document.getElementById('karenSpeech').textContent = segment.text;
    
    // Highlight vocabulary
    highlightVocabulary(segment.vocabulary);
    
    // Speak
    await speak(segment.text);
    
    // Wait between segments
    if (isPlaying && !isPaused) {
      await wait(800);
    }
    
    currentSegment++;
  }
  
  // Finished
  if (currentSegment >= segments.length && isPlaying) {
    stopDescription();
    showYourTurnButton();
  }
}

// PAUSE
function pauseDescription() {
  isPaused = true;
  isPlaying = false;
  speechSynthesis.cancel();
  stopTimer();
  
  document.getElementById('playBtn').disabled = false;
  document.getElementById('pauseBtn').disabled = true;
  document.getElementById('karenAvatar').classList.remove('speaking');
}

// REPLAY
function replayDescription() {
  speechSynthesis.cancel();
  stopTimer();
  isPlaying = false;
  isPaused = false;
  currentSegment = 0;
  timeRemaining = 60;
  
  document.getElementById('yourTurnSection').classList.remove('active');
  document.getElementById('yourTurnBtn').style.display = 'none';
  
  resetStructureSteps();
  clearHighlights();
  updateTimer();
  
  startDescription();
}

// TOGGLE SPEED
function toggleSpeed() {
  if (speechRate === 0.85) {
    speechRate = 0.7;
    document.getElementById('slowerBtn').innerHTML = 'üöÄ Normal';
  } else {
    speechRate = 0.85;
    document.getElementById('slowerBtn').innerHTML = 'üêå Slower';
  }
}

// STOP
function stopDescription() {
  isPlaying = false;
  stopTimer();
  document.getElementById('playBtn').disabled = true;
  document.getElementById('pauseBtn').disabled = true;
  document.getElementById('karenAvatar').classList.remove('speaking');
}

// UPDATE STRUCTURE STEP
function updateStructureStep(stepNumber) {
  [1, 2, 3].forEach(num => {
    const el = document.getElementById(`step-${num}`);
    el.classList.remove('active', 'completed');
    
    if (num === stepNumber) {
      el.classList.add('active');
    } else if (num < stepNumber) {
      el.classList.add('completed');
    }
  });
}

// RESET STRUCTURE
function resetStructureSteps() {
  [1, 2, 3].forEach(num => {
    document.getElementById(`step-${num}`).classList.remove('active', 'completed');
  });
}

// RENDER VOCABULARY
function renderVocabulary() {
  if (!currentData) return;
  
  const vocabList = document.getElementById('vocabList');
  vocabList.innerHTML = '';
  
  const segments = currentMode === 'single' 
    ? currentData.description 
    : currentData.model_comparison;
  
  const allVocab = segments
    .flatMap(seg => seg.vocabulary)
    .filter((v, i, arr) => arr.findIndex(x => x.phrase === v.phrase) === i);
  
  allVocab.forEach(vocab => {
    const item = document.createElement('div');
    item.className = 'vocab-item';
    item.dataset.phrase = vocab.phrase;
    
    item.innerHTML = `
      <div class="vocab-phrase">${vocab.phrase}</div>
      <div class="vocab-usage">${vocab.usage}</div>
    `;
    
    vocabList.appendChild(item);
  });
}

// HIGHLIGHT VOCABULARY
function highlightVocabulary(vocabArray) {
  document.querySelectorAll('.vocab-item').forEach(item => {
    item.classList.remove('highlighted');
  });
  
  vocabArray.forEach(vocab => {
    const item = document.querySelector(`.vocab-item[data-phrase="${vocab.phrase}"]`);
    if (item) {
      item.classList.add('highlighted');
    }
  });
}

// CLEAR HIGHLIGHTS
function clearHighlights() {
  document.getElementById('highlightOverlay1').innerHTML = '';
  document.getElementById('highlightOverlay2').innerHTML = '';
}

// SPEAK
async function speak(text) {
  return new Promise((resolve) => {
    if (!isPlaying || isPaused) {
      resolve();
      return;
    }
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-GB';
    utterance.rate = speechRate;
    utterance.pitch = 1.0;
    
    const voices = speechSynthesis.getVoices();
    const ukVoice = voices.find(v => v.lang === 'en-GB' && v.name.includes('Female'));
    if (ukVoice) utterance.voice = ukVoice;
    
    utterance.onend = () => resolve();
    utterance.onerror = () => resolve();
    
    speechSynthesis.speak(utterance);
  });
}

// TIMER
function startTimer() {
  updateTimer();
  timerInterval = setInterval(() => {
    timeRemaining--;
    updateTimer();
    
    if (timeRemaining <= 0) {
      stopTimer();
    }
  }, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function updateTimer() {
  const minutes = Math.floor(timeRemaining / 60);
  const seconds = timeRemaining % 60;
  document.getElementById('timerDisplay').textContent = 
    `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// YOUR TURN
function showYourTurnButton() {
  document.getElementById('yourTurnBtn').style.display = 'block';
}

function showYourTurn() {
  const section = document.getElementById('yourTurnSection');
  section.classList.add('active');
  
  const hint = document.getElementById('promptHint');
  const tipsList = document.getElementById('promptTipsList');
  
  if (currentMode === 'single') {
    hint.textContent = 'Describe the same photo in your own words. Try to speak for about 1 minute.';
    tipsList.innerHTML = `
      <li>Overview (what/where)</li>
      <li>Details (who/what doing)</li>
      <li>Speculation (why/feelings)</li>
      <li>Use descriptive vocabulary</li>
    `;
  } else {
    hint.textContent = 'Compare the two photos and answer the question. Speak for 1 minute.';
    tipsList.innerHTML = `
      <li>Similarities between photos</li>
      <li>Key differences</li>
      <li>Answer the specific question</li>
      <li>Use comparison vocabulary</li>
    `;
  }
  
  section.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function startRecording() {
  alert('Recording interface coming soon!\n\nFor now, practice speaking aloud for 1 minute.');
}

// RESET ALL
function resetAll() {
  speechSynthesis.cancel();
  stopTimer();
  isPlaying = false;
  isPaused = false;
  currentSegment = 0;
  currentData = null;
  timeRemaining = 60;
  
  document.getElementById('mainPhoto1').style.display = 'none';
  document.getElementById('photo2Wrapper').style.display = 'none';
  document.getElementById('yourTurnSection').classList.remove('active');
  document.getElementById('yourTurnBtn').style.display = 'none';
  document.getElementById('karenSpeech').textContent = 'Select photos to begin...';
  
  resetStructureSteps();
  clearHighlights();
  updateTimer();
}

// UTILITY
function wait(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// Load voices
window.speechSynthesis.onvoiceschanged = () => {
  console.log('Voices loaded');
};

    // INITIALIZE
    window.addEventListener('load', loadPictures);
  </script>
</body>
</html>
