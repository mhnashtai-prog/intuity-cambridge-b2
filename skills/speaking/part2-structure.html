<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY - Speaking Practice</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
      background: #0d0d0d;
      background-image: radial-gradient(circle at 20% 50%, rgba(201, 169, 97, 0.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(201, 169, 97, 0.03) 0%, transparent 50%);
      color: #e5e5e5;
      min-height: 100vh;
      padding: 1rem;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
    }

    /* HEADER */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem 0;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .back-link {
      position: absolute;
      left: 0;
      color: #8e8e93;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .back-link:hover {
      color: #C9A961;
    }

    .header-center {
      text-align: center;
    }

    .brand {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.04em;
      margin-bottom: 0.25rem;
    }

    .subtitle {
      font-size: 0.75rem;
      color: #8e8e93;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    /* PART SELECTOR */
    .part-selector {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      padding: 0 0.5rem;
    }

    .part-btn {
      padding: 0.625rem 1.25rem;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #636366;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    .part-btn:hover {
      color: #C9A961;
      border-bottom-color: rgba(201, 169, 97, 0.3);
    }

    .part-btn.active {
      color: #C9A961;
      border-bottom-color: #C9A961;
      font-weight: 600;
    }

    .part-label {
      font-size: 0.625rem;
      color: #636366;
      font-weight: 400;
    }

    .part-btn.active .part-label {
      color: #8e8e93;
    }

    /* CATEGORY SELECTOR */
    .category-selector {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .category-btn {
      padding: 0;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #636366;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding-bottom: 0.375rem;
    }

    .category-btn:hover {
      color: #C9A961;
      border-bottom-color: rgba(201, 169, 97, 0.3);
    }

    .category-btn.active {
      color: #C9A961;
      border-bottom-color: #C9A961;
      font-weight: 600;
    }

    /* STYLE SELECTOR */
    .style-selector {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .style-btn {
      padding: 0;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #636366;
      font-size: 0.6875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: all 0.3s ease;
      padding-bottom: 0.25rem;
    }

    .style-btn:hover {
      color: #C9A961;
      border-bottom-color: rgba(201, 169, 97, 0.3);
    }

    .style-btn.active {
      color: #C9A961;
      border-bottom-color: #C9A961;
      font-weight: 600;
    }

    /* VIEW MODE TOGGLE */
    .view-mode-container {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .toggle-label {
      font-size: 0.75rem;
      color: #636366;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: color 0.3s;
    }

    .toggle-label.active {
      color: #C9A961;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      background: rgba(28, 28, 30, 0.8);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .toggle-switch:hover {
      border-color: rgba(201, 169, 97, 0.4);
    }

    .toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: #C9A961;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(201, 169, 97, 0.4);
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(24px);
    }

    /* TASK PROMPT */
    .task-prompt {
      background: rgba(28, 28, 30, 0.4);
      backdrop-filter: blur(40px);
      border-left: 3px solid #60a5fa;
      border-radius: 0.75rem;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      text-align: center;
    }

    .task-label {
      font-size: 0.625rem;
      color: #60a5fa;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .task-text {
      font-size: 1rem;
      color: #e5e5e7;
      font-weight: 600;
      line-height: 1.5;
    }

    /* MAIN CONTAINER */
    .main-container {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1.5rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      overflow: hidden;
      margin-bottom: 2rem;
    }

    /* IMAGE SECTION */
    .image-section {
      padding: 2rem;
      background: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid rgba(84, 84, 88, 0.2);
    }

    .image-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .image-wrapper {
      position: relative;
      border-radius: 1rem;
      overflow: hidden;
      background: #000;
      aspect-ratio: 4/3;
    }

    .image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-number {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: rgba(201, 169, 97, 0.9);
      color: #0d0d0d;
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.125rem;
    }

    /* RESPONSE SECTION */
    .response-section {
      padding: 2rem;
      background: rgba(0, 0, 0, 0.15);
    }

    /* CONTROLS BAR */
    .controls-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(84, 84, 88, 0.3);
      color: #8e8e93;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
    }

    .icon-btn.active {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.5);
      color: #C9A961;
    }

    .icon-btn.speaking {
      border-color: #C9A961;
      box-shadow: 0 0 20px rgba(201, 169, 97, 0.4);
      animation: pulse-ring 1.5s ease-in-out infinite;
    }

    @keyframes pulse-ring {
      0%, 100% { box-shadow: 0 0 20px rgba(201, 169, 97, 0.4); }
      50% { box-shadow: 0 0 30px rgba(201, 169, 97, 0.6); }
    }

    .play-btn {
      width: 56px;
      height: 56px;
      font-size: 1.25rem;
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
    }

    .play-btn:hover {
      background: rgba(201, 169, 97, 0.25);
      border-color: rgba(201, 169, 97, 0.6);
    }

    /* KAREN HEADER */
    .karen-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.6) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border: 2px solid rgba(201, 169, 97, 0.3);
      flex-shrink: 0;
    }

    .karen-info {
      flex: 1;
    }

    .karen-label {
      font-size: 0.6875rem;
      color: #8e8e93;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 0.125rem;
    }

    .karen-note {
      font-size: 0.75rem;
      color: #636366;
      font-style: italic;
    }

    /* RESPONSE CONTENT */
    .response-content {
      background: rgba(48, 48, 51, 0.3);
      border-radius: 0.75rem;
      padding: 2rem;
    }

    .response-block {
      margin-bottom: 2rem;
    }

    .response-block:last-child {
      margin-bottom: 0;
    }

    .block-label {
      font-size: 0.6875rem;
      color: #C9A961;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .block-text {
      font-size: 1.125rem;
      line-height: 1.8;
      color: #e5e5e7;
    }

    /* PHRASE HIGHLIGHTING */
    .phrase {
      position: relative;
      display: inline;
    }

    .phrase.discourse {
      color: #7dd3fc;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      padding-bottom: 2px;
      transition: all 0.3s ease;
    }

    .phrase.vocab {
      color: #10b981;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      padding-bottom: 2px;
      transition: all 0.3s ease;
    }

    /* X-RAY ACTIVE */
    .response-content.xray-active .phrase.discourse {
      border-bottom-color: rgba(125, 211, 252, 0.5);
    }

    .response-content.xray-active .phrase.vocab {
      border-bottom-color: rgba(16, 185, 129, 0.5);
    }

    /* STRUCTURE PANEL */
    .structure-panel {
      padding: 2rem;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(84, 84, 88, 0.2);
      display: none;
    }

    .structure-panel.active {
      display: block;
    }

    .structure-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-align: center;
    }

    .structure-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .structure-category {
      background: rgba(48, 48, 51, 0.3);
      border-radius: 0.75rem;
      padding: 1.25rem;
      border-left: 3px solid rgba(125, 211, 252, 0.4);
    }

    .structure-category.vocab-cat {
      border-left-color: rgba(16, 185, 129, 0.4);
    }

    .structure-category-title {
      font-size: 0.6875rem;
      color: #7dd3fc;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .structure-category.vocab-cat .structure-category-title {
      color: #10b981;
    }

    .structure-list {
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
    }

    .structure-item {
      font-size: 0.875rem;
      color: #e5e5e7;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 0.375rem;
      line-height: 1.5;
    }

    /* FOOTER NAV */
    .footer-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem;
      flex-wrap: wrap;
    }

    .nav-btn {
      padding: 0.875rem 1.5rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #8e8e93;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      min-height: 44px;
    }

    .nav-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
      transform: translateY(-2px);
    }

    .nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .nav-btn.primary {
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      border-color: #C9A961;
      color: #0d0d0d;
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    .nav-btn.primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #d4b46e 0%, #C9A961 100%);
      box-shadow: 0 6px 16px rgba(201, 169, 97, 0.4);
      transform: translateY(-2px);
    }

    /* PRACTICE PROMPT */
    .practice-prompt {
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.05) 100%);
      border: 2px solid #C9A961;
      border-radius: 1.5rem;
      padding: 2.5rem 2rem;
      text-align: center;
      margin-top: 2rem;
      display: none;
    }

    .practice-prompt.active {
      display: block;
      animation: fadeInScale 0.5s ease;
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .prompt-icon {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .prompt-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1rem;
    }

    .prompt-text {
      font-size: 1rem;
      color: #e5e5e7;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }

    /* MOBILE */
    @media (max-width: 768px) {
      body { padding: 0.75rem; }
      .brand { font-size: 1.375rem; }
      .subtitle { font-size: 0.6875rem; }
      .category-selector { gap: 1.25rem; }
      .category-btn { font-size: 0.6875rem; }
      .style-selector { gap: 1rem; }
      .style-btn { font-size: 0.625rem; }
      .task-text { font-size: 0.9375rem; }
      .image-grid { grid-template-columns: 1fr; gap: 1rem; }
      .controls-bar { justify-content: center; }
      .block-text { font-size: 1rem; }
      .structure-grid { grid-template-columns: 1fr; }
      .footer-nav { gap: 0.75rem; }
      .nav-btn { font-size: 0.8125rem; padding: 0.75rem 1.25rem; }
    }

    @media (max-width: 480px) {
      .brand { font-size: 1.125rem; }
      .category-btn { font-size: 0.625rem; gap: 0.25rem; }
      .icon-btn { width: 36px; height: 36px; font-size: 0.9375rem; }
      .play-btn { width: 48px; height: 48px; font-size: 1.125rem; }
      .block-text { font-size: 0.9375rem; }
      .prompt-icon { font-size: 3rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- HEADER -->
      <div class="header">
      <a href="../../index.html?openModal=speaking" class="back-link">‚Üê Back</a>
      <div class="header-center">
        <div class="brand">INTUITY</div>
        <div class="subtitle">Speaking Practice ¬∑ B2 First</div>
      </div>
    </div>

    <!-- PART SELECTOR -->
    <div class="part-selector">
      <button class="part-btn" onclick="window.location.href='part1-structure.html'">
        <span>Part 1</span>
        <span class="part-label">Interview</span>
      </button>
      <button class="part-btn active">
        <span>Part 2</span>
        <span class="part-label">Compare</span>
      </button>
      <button class="part-btn" onclick="window.location.href='part3-structure.html'">
        <span>Part 3</span>
        <span class="part-label">Collaborate</span>
      </button>
      <button class="part-btn" onclick="window.location.href='part4-structure.html'">
        <span>Part 4</span>
        <span class="part-label">Discuss</span>
      </button>
    </div>

    <!-- CATEGORY SELECTOR -->
    <div class="category-selector">
      <button class="category-btn active" data-category="comparing">
        üîó Comparing
      </button>
      <button class="category-btn" data-category="justifying">
        üí° Justifying
      </button>
      <button class="category-btn" data-category="speculating">
        üí≠ Speculating
      </button>
    </div>

    <!-- STYLE SELECTOR -->
    <div class="style-selector">
      <button class="style-btn active" data-style="default">Default</button>
      <button class="style-btn" data-style="alternative1">Alternative 1</button>
      <button class="style-btn" data-style="alternative2">Alternative 2</button>
    </div>

    <!-- VIEW MODE TOGGLE -->
    <div class="view-mode-container">
      <div class="toggle-container">
        <span class="toggle-label active" id="watchLabel">Watch</span>
        <div class="toggle-switch" id="viewModeToggle">
          <div class="toggle-slider"></div>
        </div>
        <span class="toggle-label" id="structureLabel">Structure</span>
      </div>
    </div>

    <!-- TASK PROMPT -->
    <div class="task-prompt">
      <div class="task-label">Your Task</div>
      <div class="task-text" id="taskText">Compare and contrast these pictures.</div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="main-container">
      
      <!-- IMAGE SECTION -->
      <div class="image-section">
        <div class="image-grid">
          <div class="image-wrapper">
            <img id="image1" src="https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=600" alt="Picture 1">
            <div class="image-number">1</div>
          </div>
          <div class="image-wrapper">
            <img id="image2" src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600" alt="Picture 2">
            <div class="image-number">2</div>
          </div>
        </div>
      </div>

      <!-- RESPONSE SECTION (WATCH MODE) -->
      <div class="response-section" id="responseSection">
        
        <!-- CONTROLS BAR -->
        <div class="controls-bar">
          <div class="control-group">
            <button class="icon-btn play-btn" id="playBtn" title="Play audio">
              ‚ñ∂
            </button>
            <button class="icon-btn" id="pauseBtn" style="display: none;" title="Pause">
              ‚è∏
            </button>
            <button class="icon-btn" id="replayBtn" title="Replay">
              üîÅ
            </button>
          </div>
          
          <div class="control-group">
            <button class="icon-btn" id="xrayBtn" title="X-Ray phrases">
              üî¨
            </button>
          </div>
        </div>

        <!-- KAREN HEADER -->
        <div class="karen-header">
          <div class="avatar">üë©</div>
          <div class="karen-info">
            <div class="karen-label">Karen's Model Response</div>
            <div class="karen-note">Listen and mirror the phrases</div>
          </div>
        </div>

        <!-- RESPONSE CONTENT -->
        <div class="response-content" id="responseContent">
          <!-- Response blocks inserted here -->
        </div>
      </div>

      <!-- STRUCTURE PANEL -->
      <div class="structure-panel" id="structurePanel">
        <div class="structure-title">üìö Complete Phrase Bank</div>
        <div class="structure-grid" id="structureGrid">
          <!-- Structure content inserted here -->
        </div>
      </div>

      <!-- FOOTER NAV -->
      <div class="footer-nav">
        <button class="nav-btn primary" id="practiceBtn">
          üéôÔ∏è Now You Try
        </button>
      </div>
    </div>

    <!-- PRACTICE PROMPT -->
    <div class="practice-prompt" id="practicePrompt">
      <div class="prompt-icon">üéôÔ∏è</div>
      <div class="prompt-title">Your Turn to Speak!</div>
      <div class="prompt-text">Use the phrases you've learned. Try to mirror Karen's response structure.</div>
      <button class="nav-btn primary">
        üî¥ Start Recording
      </button>
    </div>

  </div>

  <script>
// ==========================================
// DATA (from part2-structure.js)
// ==========================================

const SPEAKING_DATA = {
  "comparing": {
    "task": "Compare and contrast these pictures.",
    "phraseBank": {
      "discourse": [
        "I feel that",
        "In many ways",
        "As far as I can judge",
        "To some extent",
        "It seems to me",
        "In many aspects",
        "While",
        "Whereas",
        "By contrast",
        "On the other hand",
        "However",
        "In comparison"
      ],
      "vocabulary": [
        "similar",
        "identical",
        "very much alike",
        "have in common",
        "resemble each other",
        "share similarities",
        "differ",
        "contrast",
        "distinguish",
        "commuting",
        "travelling",
        "cycling",
        "public transport",
        "eco-friendly"
      ]
    },
    "pairs": [
      {
        "image1": "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=600",
        "image2": "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600",
        "responses": {
          "default": {
            "sections": [
              {
                "icon": "üîó",
                "label": "Similarities",
                "text": "I feel that in many ways the two pictures are similar. They both show people travelling.",
                "phrases": {
                  "discourse": ["I feel that", "in many ways"],
                  "vocabulary": ["similar", "travelling"]
                }
              },
              {
                "icon": "‚ö°",
                "label": "Difference",
                "text": "While the first picture shows a woman commuting to work by train, the second shows a woman cycling to work.",
                "phrases": {
                  "discourse": ["While"],
                  "vocabulary": ["commuting", "cycling"]
                }
              }
            ]
          },
          "alternative1": {
            "sections": [
              {
                "icon": "üîó",
                "label": "Similarities",
                "text": "As far as I can judge, to some extent the two pictures are identical. They both show people travelling.",
                "phrases": {
                  "discourse": ["As far as I can judge", "to some extent"],
                  "vocabulary": ["identical", "travelling"]
                }
              },
              {
                "icon": "‚ö°",
                "label": "Difference",
                "text": "Whereas the first picture shows a woman commuting to work by train, the second shows a woman cycling to work.",
                "phrases": {
                  "discourse": ["Whereas"],
                  "vocabulary": ["commuting", "cycling"]
                }
              }
            ]
          },
          "alternative2": {
            "sections": [
              {
                "icon": "üîó",
                "label": "Similarities",
                "text": "It seems to me that in many aspects the two pictures are very much alike. They both show people travelling.",
                "phrases": {
                  "discourse": ["It seems to me", "in many aspects"],
                  "vocabulary": ["very much alike", "travelling"]
                }
              },
              {
                "icon": "‚ö°",
                "label": "Difference",
                "text": "The first picture shows a woman commuting to work by train. By contrast, the second shows a woman cycling to work.",
                "phrases": {
                  "discourse": ["By contrast"],
                  "vocabulary": ["commuting", "cycling"]
                }
              }
            ]
          }
        }
      }
    ]
  },

  "justifying": {
    "task": "Which method of transport do you think is better for commuting? Why?",
    "phraseBank": {
      "discourse": [
        "In my opinion",
        "I believe that",
        "From my perspective",
        "It seems to me that",
        "I would argue that",
        "The main reason is that",
        "This is because",
        "What's more",
        "Furthermore",
        "Additionally",
        "For instance",
        "For example",
        "That's why"
      ],
      "vocabulary": [
        "eco-friendly",
        "sustainable",
        "environmentally conscious",
        "carbon footprint",
        "health benefits",
        "physical exercise",
        "cost-effective",
        "convenient",
        "reliable",
        "efficient",
        "flexible",
        "stress-free"
      ]
    },
    "pairs": [
      {
        "image1": "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=600",
        "image2": "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600",
        "responses": {
          "default": {
            "sections": [
              {
                "icon": "üí°",
                "label": "Opinion",
                "text": "In my opinion, cycling is better for commuting if you live close to work.",
                "phrases": {
                  "discourse": ["In my opinion"],
                  "vocabulary": ["cycling", "commuting"]
                }
              },
              {
                "icon": "‚úì",
                "label": "Justification",
                "text": "The main reason is that it's more eco-friendly and provides excellent health benefits. What's more, it's cost-effective compared to public transport.",
                "phrases": {
                  "discourse": ["The main reason is that", "What's more"],
                  "vocabulary": ["eco-friendly", "health benefits", "cost-effective"]
                }
              },
              {
                "icon": "üìå",
                "label": "Example",
                "text": "For instance, cycling to work helps you stay fit while reducing your carbon footprint. That's why I think it's the better option for short distances.",
                "phrases": {
                  "discourse": ["For instance", "That's why"],
                  "vocabulary": ["stay fit", "carbon footprint"]
                }
              }
            ]
          },
          "alternative1": {
            "sections": [
              {
                "icon": "üí°",
                "label": "Opinion",
                "text": "I believe that cycling is superior for commuting when the distance is manageable.",
                "phrases": {
                  "discourse": ["I believe that"],
                  "vocabulary": ["cycling", "superior", "commuting"]
                }
              },
              {
                "icon": "‚úì",
                "label": "Justification",
                "text": "This is because it combines physical exercise with environmentally conscious transport. Furthermore, it's more flexible than relying on public transport schedules.",
                "phrases": {
                  "discourse": ["This is because", "Furthermore"],
                  "vocabulary": ["physical exercise", "environmentally conscious", "flexible"]
                }
              },
              {
                "icon": "üìå",
                "label": "Example",
                "text": "For example, you can avoid rush hour delays while getting your daily workout. That's why I'd recommend it for anyone living within cycling distance.",
                "phrases": {
                  "discourse": ["For example", "That's why"],
                  "vocabulary": ["rush hour", "daily workout"]
                }
              }
            ]
          },
          "alternative2": {
            "sections": [
              {
                "icon": "üí°",
                "label": "Opinion",
                "text": "From my perspective, cycling represents the better choice for local commuting.",
                "phrases": {
                  "discourse": ["From my perspective"],
                  "vocabulary": ["cycling", "local commuting"]
                }
              },
              {
                "icon": "‚úì",
                "label": "Justification",
                "text": "I would argue that its sustainability and health advantages outweigh other options. Additionally, it offers a stress-free start to the working day.",
                "phrases": {
                  "discourse": ["I would argue that", "Additionally"],
                  "vocabulary": ["sustainability", "health advantages", "stress-free"]
                }
              },
              {
                "icon": "üìå",
                "label": "Example",
                "text": "It seems to me that the combination of saving money and staying healthy makes cycling ideal. That's why more people are choosing bikes over cars.",
                "phrases": {
                  "discourse": ["It seems to me that", "That's why"],
                  "vocabulary": ["saving money", "staying healthy"]
                }
              }
            ]
          }
        }
      }
    ]
  },

  "speculating": {
    "task": "What might these people be thinking about during their journey?",
    "phraseBank": {
      "discourse": [
        "I imagine that",
        "I would guess that",
        "It's possible that",
        "Perhaps",
        "Maybe",
        "They might be",
        "They could be",
        "It's likely that",
        "Probably",
        "I suspect that",
        "I'd say that",
        "It seems probable that"
      ],
      "vocabulary": [
        "reflecting on",
        "contemplating",
        "thinking about",
        "planning ahead",
        "worrying about",
        "looking forward to",
        "daydreaming",
        "mentally preparing",
        "reviewing",
        "anticipating",
        "considering",
        "pondering"
      ]
    },
    "pairs": [
      {
        "image1": "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=600",
        "image2": "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600",
        "responses": {
          "default": {
            "sections": [
              {
                "icon": "üí≠",
                "label": "First Speculation",
                "text": "I imagine that the woman on the train might be thinking about her upcoming meetings or planning ahead for the day.",
                "phrases": {
                  "discourse": ["I imagine that", "might be"],
                  "vocabulary": ["thinking about", "planning ahead"]
                }
              },
              {
                "icon": "üí≠",
                "label": "Second Speculation",
                "text": "Perhaps the cyclist is enjoying the fresh air and mentally preparing for work. It's possible that she's also feeling good about making an eco-friendly choice.",
                "phrases": {
                  "discourse": ["Perhaps", "It's possible that"],
                  "vocabulary": ["mentally preparing", "eco-friendly choice"]
                }
              }
            ]
          },
          "alternative1": {
            "sections": [
              {
                "icon": "üí≠",
                "label": "First Speculation",
                "text": "I would guess that the commuter on the train could be reviewing her schedule or worrying about being late.",
                "phrases": {
                  "discourse": ["I would guess that", "could be"],
                  "vocabulary": ["reviewing", "worrying about"]
                }
              },
              {
                "icon": "üí≠",
                "label": "Second Speculation",
                "text": "It's likely that the cyclist is contemplating her day while enjoying the physical activity. I suspect that she's looking forward to arriving at work feeling energized.",
                "phrases": {
                  "discourse": ["It's likely that", "I suspect that"],
                  "vocabulary": ["contemplating", "looking forward to", "energized"]
                }
              }
            ]
          },
          "alternative2": {
            "sections": [
              {
                "icon": "üí≠",
                "label": "First Speculation",
                "text": "I'd say that the train passenger is probably pondering work challenges or anticipating the day ahead.",
                "phrases": {
                  "discourse": ["I'd say that", "probably"],
                  "vocabulary": ["pondering", "anticipating"]
                }
              },
              {
                "icon": "üí≠",
                "label": "Second Speculation",
                "text": "It seems probable that the cyclist is reflecting on the health benefits of her journey. Maybe she's also daydreaming while enjoying the scenery.",
                "phrases": {
                  "discourse": ["It seems probable that", "Maybe"],
                  "vocabulary": ["reflecting on", "health benefits", "daydreaming"]
                }
              }
            ]
          }
        }
      }
    ]
  }
};

console.log('‚úì SPEAKING_DATA loaded successfully');
console.log('Available categories:', Object.keys(SPEAKING_DATA));

// ==========================================
// LOGIC (from part2-logic.js)
// ==========================================

let currentCategory = 'comparing';
let currentStyle = 'default';
let currentPairIndex = 0;
let isXrayActive = false;
let isStructureMode = false;
let currentUtterance = null;

const elements = {
  categoryBtns: null,
  styleBtns: null,
  taskText: null,
  image1: null,
  image2: null,
  responseContent: null,
  structurePanel: null,
  structureGrid: null,
  playBtn: null,
  pauseBtn: null,
  replayBtn: null,
  xrayBtn: null,
  viewModeToggle: null,
  watchLabel: null,
  structureLabel: null,
  responseSection: null,
  practiceBtn: null,
  practicePrompt: null
};

document.addEventListener('DOMContentLoaded', function() {
  console.log('üì± DOM ready - initializing Part 2');
  
  elements.categoryBtns = document.querySelectorAll('.category-btn');
  elements.styleBtns = document.querySelectorAll('.style-btn');
  elements.taskText = document.getElementById('taskText');
  elements.image1 = document.getElementById('image1');
  elements.image2 = document.getElementById('image2');
  elements.responseContent = document.getElementById('responseContent');
  elements.structurePanel = document.getElementById('structurePanel');
  elements.structureGrid = document.getElementById('structureGrid');
  elements.playBtn = document.getElementById('playBtn');
  elements.pauseBtn = document.getElementById('pauseBtn');
  elements.replayBtn = document.getElementById('replayBtn');
  elements.xrayBtn = document.getElementById('xrayBtn');
  elements.viewModeToggle = document.getElementById('viewModeToggle');
  elements.watchLabel = document.getElementById('watchLabel');
  elements.structureLabel = document.getElementById('structureLabel');
  elements.responseSection = document.getElementById('responseSection');
  elements.practiceBtn = document.getElementById('practiceBtn');
  elements.practicePrompt = document.getElementById('practicePrompt');
  
  setupEventListeners();
  renderContent();
  
  console.log('=== ‚úì INTUITY Initialized ===');
});

function setupEventListeners() {
  elements.categoryBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      switchCategory(this.getAttribute('data-category'));
    });
  });
  
  elements.styleBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      switchStyle(this.getAttribute('data-style'));
    });
  });
  
  elements.playBtn.addEventListener('click', playAudio);
  elements.replayBtn.addEventListener('click', function() {
    stopAudio();
    playAudio();
  });
  elements.xrayBtn.addEventListener('click', toggleXray);
  elements.viewModeToggle.addEventListener('click', toggleViewMode);
  
  if (elements.practiceBtn) {
    elements.practiceBtn.addEventListener('click', showPracticePrompt);
  }
}

function switchCategory(category) {
  if (!SPEAKING_DATA[category]) return;
  
  currentCategory = category;
  currentPairIndex = 0;
  currentStyle = 'default';
  
  elements.categoryBtns.forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-category') === category);
  });
  
  elements.styleBtns.forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-style') === 'default');
  });
  
  stopAudio();
  renderContent();
}

function switchStyle(style) {
  currentStyle = style;
  
  elements.styleBtns.forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-style') === style);
  });
  
  stopAudio();
  renderResponse();
  if (isStructureMode) renderStructure();
}

function renderContent() {
  const categoryData = SPEAKING_DATA[currentCategory];
  const pairData = categoryData.pairs[currentPairIndex];
  
  elements.taskText.textContent = categoryData.task;
  elements.image1.src = pairData.image1;
  elements.image2.src = pairData.image2;
  
  renderResponse();
  renderStructure();
}

function renderResponse() {
  const categoryData = SPEAKING_DATA[currentCategory];
  const pairData = categoryData.pairs[currentPairIndex];
  const responseData = pairData.responses[currentStyle];
  
  if (!responseData) return;
  
  let html = '';
  responseData.sections.forEach(section => {
    html += `
      <div class="response-block">
        <div class="block-label">${section.icon} ${section.label}</div>
        <div class="block-text">${highlightPhrases(section.text, section.phrases)}</div>
      </div>
    `;
  });
  
  elements.responseContent.innerHTML = html;
}

function highlightPhrases(text, phrases) {
  let result = text;
  
  if (phrases.discourse) {
    phrases.discourse.forEach(phrase => {
      const regex = new RegExp(`(${escapeRegex(phrase)})`, 'gi');
      result = result.replace(regex, '<span class="phrase discourse">$1</span>');
    });
  }
  
  if (phrases.vocabulary) {
    phrases.vocabulary.forEach(phrase => {
      const regex = new RegExp(`(${escapeRegex(phrase)})`, 'gi');
      result = result.replace(regex, '<span class="phrase vocab">$1</span>');
    });
  }
  
  return result;
}

function escapeRegex(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function renderStructure() {
  const categoryData = SPEAKING_DATA[currentCategory];
  const phraseBank = categoryData.phraseBank;
  
  let html = `
    <div class="structure-category">
      <div class="structure-category-title">üîó Discourse Markers</div>
      <div class="structure-list">
        ${phraseBank.discourse.map(p => `<div class="structure-item">${p}</div>`).join('')}
      </div>
    </div>
    <div class="structure-category vocab-cat">
      <div class="structure-category-title">üìö Key Vocabulary</div>
      <div class="structure-list">
        ${phraseBank.vocabulary.map(p => `<div class="structure-item">${p}</div>`).join('')}
      </div>
    </div>
  `;
  
  elements.structureGrid.innerHTML = html;
}

function playAudio() {
  stopAudio();
  
  const categoryData = SPEAKING_DATA[currentCategory];
  const pairData = categoryData.pairs[currentPairIndex];
  const responseData = pairData.responses[currentStyle];
  
  const fullText = responseData.sections.map(s => s.text).join(' ');
  currentUtterance = new SpeechSynthesisUtterance(fullText);
  
  const voices = speechSynthesis.getVoices();
  const preferredVoices = ['Kate', 'Serena', 'Karen', 'Victoria'];
  
  let selectedVoice = null;
  for (let name of preferredVoices) {
    selectedVoice = voices.find(v => v.name.includes(name));
    if (selectedVoice) break;
  }
  
  if (!selectedVoice) {
    selectedVoice = voices.find(v => v.lang.includes('en-GB')) || voices[0];
  }
  
  currentUtterance.voice = selectedVoice;
  currentUtterance.rate = 0.9;
  currentUtterance.pitch = 1.0;
  
  currentUtterance.onstart = () => elements.playBtn.classList.add('speaking');
  currentUtterance.onend = () => elements.playBtn.classList.remove('speaking');
  currentUtterance.onerror = () => elements.playBtn.classList.remove('speaking');
  
  speechSynthesis.speak(currentUtterance);
}

function stopAudio() {
  if (currentUtterance) {
    speechSynthesis.cancel();
    elements.playBtn.classList.remove('speaking');
    currentUtterance = null;
  }
}

function toggleXray() {
  isXrayActive = !isXrayActive;
  elements.xrayBtn.classList.toggle('active', isXrayActive);
  elements.responseContent.classList.toggle('xray-active', isXrayActive);
}

function toggleViewMode() {
  stopAudio(); // Stop Karen speaking when switching modes
  isStructureMode = !isStructureMode;
  
  if (isStructureMode) {
    elements.viewModeToggle.classList.add('active');
    elements.watchLabel.classList.remove('active');
    elements.structureLabel.classList.add('active');
    elements.responseSection.style.display = 'none';
    elements.structurePanel.classList.add('active');
  } else {
    elements.viewModeToggle.classList.remove('active');
    elements.watchLabel.classList.add('active');
    elements.structureLabel.classList.remove('active');
    elements.responseSection.style.display = 'block';
    elements.structurePanel.classList.remove('active');
  }
}

function showPracticePrompt() {
  if (elements.practicePrompt) {
    elements.practicePrompt.classList.add('active');
    elements.practicePrompt.scrollIntoView({ behavior: 'smooth' });
  }
}

if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = () => {
    console.log('üîä Voices loaded:', speechSynthesis.getVoices().length);
  };
}

console.log('‚úì All JavaScript loaded');
  </script>
</body>
</html>
