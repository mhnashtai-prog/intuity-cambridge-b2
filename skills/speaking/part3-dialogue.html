<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY - Speaking Part 3 Discussion</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', 'Inter', -apple-system, sans-serif;
      background: #0d0d0d;
      background-image: radial-gradient(circle at 20% 50%, rgba(201, 169, 97, 0.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(201, 169, 97, 0.03) 0%, transparent 50%);
      color: #e5e5e5;
      min-height: 100vh;
      padding: 1rem;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* HEADER */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem 0;
      position: relative;
    }

    .back-link {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      color: #8e8e93;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .back-link:hover { color: #C9A961; }

    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #C9A961 0%, rgba(201, 169, 97, 0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.04em;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 0.8125rem;
      color: #8e8e93;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    /* STYLE SELECTOR */
    .style-selector {
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .style-btn {
      padding: 0.75rem 1.5rem;
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #8e8e93;
      font-size: 0.8125rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-height: 44px;
    }

    .style-btn:hover {
      background: rgba(28, 28, 30, 0.8);
      border-color: rgba(201, 169, 97, 0.3);
      color: #C9A961;
    }

    .style-btn.active {
      background: rgba(28, 28, 30, 0.9);
      border-color: rgba(201, 169, 97, 0.5);
      color: #C9A961;
      box-shadow: 0 0 0 1px rgba(201, 169, 97, 0.2) inset;
    }

    /* TOPIC SELECTOR */
    .topic-selector {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .topic-selector label {
      display: block;
      font-size: 0.875rem;
      color: #8e8e93;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-weight: 600;
    }

    .topic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }

    .topic-card {
      position: relative;
      cursor: pointer;
      border-radius: 1rem;
      overflow: hidden;
      border: 2px solid rgba(84, 84, 88, 0.3);
      transition: all 0.3s ease;
      background: rgba(0, 0, 0, 0.4);
      min-height: 180px;
    }

    .topic-card:hover {
      border-color: rgba(201, 169, 97, 0.6);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(201, 169, 97, 0.3);
    }

    .topic-card.active {
      border-color: #C9A961;
      box-shadow: 0 8px 24px rgba(201, 169, 97, 0.5);
    }

    .topic-card-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }

    .topic-card-content {
      padding: 1rem;
      background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.7));
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
    }

    .topic-card-title {
      font-size: 0.9375rem;
      font-weight: 700;
      color: #e5e5e7;
      margin-bottom: 0.25rem;
    }

    .topic-card-subtitle {
      font-size: 0.75rem;
      color: #8e8e93;
    }

    /* MAIN LAYOUT */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    /* LEFT: DIALOGUE STAGE */
    .dialogue-stage {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1.5rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    /* Progress */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(99, 99, 102, 0.3);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #C9A961 0%, #d4b46e 100%);
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(201, 169, 97, 0.5);
    }

    .progress-text {
      text-align: center;
      font-size: 0.75rem;
      color: #8e8e93;
      margin-bottom: 1.5rem;
    }

    /* Speakers */
    .speakers {
      display: flex;
      justify-content: space-around;
      padding: 1.5rem 0;
      gap: 3rem;
      margin-bottom: 2rem;
    }

    .speaker {
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0.4;
      transform: scale(0.95);
    }

    .speaker.active {
      opacity: 1;
      transform: scale(1.05);
    }

    .avatar {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.3) 0%, rgba(201, 169, 97, 0.1) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
      border: 3px solid rgba(201, 169, 97, 0.2);
      transition: all 0.3s ease;
      margin-bottom: 0.75rem;
    }

    .speaker.active .avatar {
      border-color: #C9A961;
      box-shadow: 0 0 30px rgba(201, 169, 97, 0.6);
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.4) 0%, rgba(201, 169, 97, 0.2) 100%);
    }

    .speaker-name {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: #8e8e93;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
    }

    .speaker.active .speaker-name {
      color: #C9A961;
    }

    .speaking-indicator {
      width: 50px;
      height: 4px;
      background: rgba(99, 99, 102, 0.3);
      border-radius: 2px;
      position: relative;
      overflow: hidden;
    }

    .speaking-indicator.pulsing::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, #C9A961, transparent);
      animation: speaking 1.5s ease-in-out infinite;
    }

    @keyframes speaking {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    /* Dialogue Bubble */
    .dialogue-bubble {
      background: rgba(48, 48, 51, 0.5);
      border-radius: 1.25rem;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(84, 84, 88, 0.2);
      min-height: 140px;
      position: relative;
    }

    .speaker-label {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      margin-bottom: 0.875rem;
      letter-spacing: 0.05em;
    }

    .text-content {
      font-size: 1.125rem;
      color: #e5e5e7;
      line-height: 1.7;
    }

    /* Discourse Highlighting */
    .agreement-phrase,
    .disagreement-phrase,
    .inviting-phrase,
    .speculation-phrase {
      color: inherit;
      transition: all 0.3s;
    }

    .text-content.discourse-active .agreement-phrase {
      color: #4ade80 !important;
      font-weight: 600 !important;
      border-bottom: 2px solid rgba(74, 222, 128, 0.4) !important;
      padding-bottom: 2px;
    }

    .text-content.discourse-active .disagreement-phrase {
      color: #fb923c !important;
      font-weight: 600 !important;
      border-bottom: 2px solid rgba(251, 146, 60, 0.4) !important;
      padding-bottom: 2px;
    }

    .text-content.discourse-active .inviting-phrase {
      color: #60a5fa !important;
      font-weight: 600 !important;
      border-bottom: 2px solid rgba(96, 165, 250, 0.4) !important;
      padding-bottom: 2px;
    }

    .text-content.discourse-active .speculation-phrase {
      color: #a78bfa !important;
      font-weight: 600 !important;
      border-bottom: 2px solid rgba(167, 139, 250, 0.4) !important;
      padding-bottom: 2px;
    }

    /* Phrase hint buttons */
    .phrase-hint-btn {
      display: none;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      margin-left: 3px;
      background: rgba(96, 165, 250, 0.15);
      border: 1px solid rgba(96, 165, 250, 0.3);
      border-radius: 50%;
      font-size: 11px;
      cursor: pointer;
      opacity: 0.75;
      transition: all 0.3s;
      vertical-align: middle;
      position: relative;
      top: -2px;
      padding: 0;
    }

    .text-content.phrase-explorer-active .phrase-hint-btn {
      display: inline-flex;
    }

    .phrase-hint-btn:hover {
      opacity: 1;
      background: rgba(96, 165, 250, 0.25);
      transform: scale(1.2);
      box-shadow: 0 0 12px rgba(96, 165, 250, 0.5);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      justify-content: center;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s;
      min-height: 44px;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .discourse-btn {
      color: #7dd3fc;
    }

    .discourse-btn:hover {
      background: rgba(125, 211, 252, 0.15);
      border-color: rgba(125, 211, 252, 0.3);
      transform: translateY(-1px);
    }

    .discourse-btn.active {
      background: rgba(125, 211, 252, 0.2);
      border-color: rgba(125, 211, 252, 0.4);
      box-shadow: 0 0 12px rgba(125, 211, 252, 0.3);
    }

    .phrase-btn {
      color: #10b981;
    }

    .phrase-btn:hover {
      background: rgba(16, 185, 129, 0.15);
      border-color: rgba(16, 185, 129, 0.3);
      transform: translateY(-1px);
    }

    .phrase-btn.active {
      background: rgba(16, 185, 129, 0.2);
      border-color: rgba(16, 185, 129, 0.4);
      box-shadow: 0 0 12px rgba(16, 185, 129, 0.3);
    }

    /* Controls */
    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .control-btn {
      padding: 0.875rem 1.5rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #8e8e93;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .control-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      color: #C9A961;
      transform: translateY(-2px);
    }

    .control-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .control-btn.primary {
      background: rgba(28, 28, 30, 0.9);
      border-color: rgba(201, 169, 97, 0.5);
      color: #C9A961;
      box-shadow: 0 0 0 1px rgba(201, 169, 97, 0.2) inset;
    }

    .control-btn.primary:hover:not(:disabled) {
      border-color: rgba(201, 169, 97, 0.6);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    /* RIGHT: DISCOURSE TRACKER */
    .tracker-stage {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1.5rem;
      border: 1px solid rgba(201, 169, 97, 0.25);
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
    }

    .tracker-header {
      margin-bottom: 1.5rem;
    }

    .tracker-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.125rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .tracker-subtitle {
      font-size: 0.8125rem;
      color: #8e8e93;
      font-style: italic;
    }

    .tracker-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .tracker-category {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.75rem;
      padding: 1rem;
      border-left: 3px solid;
    }

    .tracker-category.agreement { border-left-color: #4ade80; }
    .tracker-category.disagreement { border-left-color: #fb923c; }
    .tracker-category.inviting { border-left-color: #60a5fa; }
    .tracker-category.speculation { border-left-color: #a78bfa; }

    .tracker-category-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .tracker-category.agreement .tracker-category-title { color: #4ade80; }
    .tracker-category.disagreement .tracker-category-title { color: #fb923c; }
    .tracker-category.inviting .tracker-category-title { color: #60a5fa; }
    .tracker-category.speculation .tracker-category-title { color: #a78bfa; }

    .tracker-count {
      font-size: 1.5rem;
      font-weight: 700;
      color: #e5e5e7;
      margin-bottom: 0.5rem;
    }

    .tracker-examples {
      font-size: 0.8125rem;
      color: #8e8e93;
      line-height: 1.5;
    }

    .tracker-example {
      display: inline;
      color: #C9A961;
      font-weight: 500;
    }

    /* YOUR TURN SECTION */
    .your-turn-section {
      background: linear-gradient(135deg, rgba(201, 169, 97, 0.15) 0%, rgba(201, 169, 97, 0.05) 100%);
      border: 2px solid #C9A961;
      border-radius: 1.5rem;
      padding: 2.5rem 2rem;
      text-align: center;
      animation: fadeInScale 0.5s ease;
      margin-bottom: 2rem;
      display: none;
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .prompt-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .prompt-text {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: #C9A961;
      margin-bottom: 1rem;
    }

    .prompt-hint {
      font-size: 1rem;
      color: #e5e5e7;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }

    .prompt-topic {
      font-style: italic;
      color: #60a5fa;
    }

    /* ALTERNATIVES MODAL */
    .alternatives-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(6px);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      animation: fadeIn 0.2s ease;
    }

    .alternatives-modal-overlay.active {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .alternatives-modal {
      position: relative;
      background: rgba(20, 20, 22, 0.98);
      backdrop-filter: blur(30px);
      border-radius: 1.25rem;
      border: 1px solid rgba(16, 185, 129, 0.3);
      max-width: 520px;
      width: 100%;
      max-height: 80vh;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(16, 185, 129, 0.1);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      padding: 1.5rem 2rem;
      background: linear-gradient(145deg, rgba(16, 185, 129, 0.1), rgba(0, 0, 0, 0.3));
      border-bottom: 1px solid rgba(16, 185, 129, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8e8e93;
      font-size: 1.25rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #e5e5e7;
    }

    .modal-body {
      padding: 2rem;
      max-height: calc(80vh - 100px);
      overflow-y: auto;
    }

    .current-phrase-section {
      background: rgba(16, 185, 129, 0.08);
      border-left: 3px solid #10b981;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
    }

    .current-phrase-label {
      font-size: 0.65rem;
      color: #10b981;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .current-phrase-text {
      font-size: 1.1rem;
      color: #e5e7eb;
      font-weight: 600;
    }

    .alternatives-section {
      margin-bottom: 1rem;
    }

    .alternatives-header {
      font-size: 0.7rem;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(201, 169, 97, 0.2);
    }

    .alternative-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.875rem 1rem;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 0.625rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .alternative-item:hover {
      background: rgba(16, 185, 129, 0.08);
      border-left-color: #10b981;
      transform: translateX(4px);
    }

    .alternative-text {
      flex: 1;
      color: #e5e7eb;
      font-size: 0.95rem;
      font-weight: 500;
      line-height: 1.4;
    }

    .copy-btn {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 0.5rem;
      padding: 0.375rem 0.75rem;
      color: #10b981;
      font-size: 0.7rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      opacity: 0;
      flex-shrink: 0;
    }

    .alternative-item:hover .copy-btn {
      opacity: 1;
    }

    .copy-btn:hover {
      background: rgba(16, 185, 129, 0.25);
      transform: scale(1.05);
    }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(16, 185, 129, 0.95);
      color: #000;
      padding: 0.875rem 1.5rem;
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      z-index: 3000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* MOBILE */
    @media (max-width: 1024px) {
      .main-layout {
        grid-template-columns: 1fr;
      }

      .tracker-stage {
        order: -1;
      }
    }

    @media (max-width: 768px) {
      .speakers {
        gap: 2rem;
      }

      .avatar {
        width: 70px;
        height: 70px;
        font-size: 2.5rem;
      }

      .dialogue-bubble {
        padding: 1.5rem;
      }

      .text-content {
        font-size: 1rem;
      }

      .controls {
        flex-wrap: wrap;
      }

      .control-btn {
        padding: 0.75rem 1.25rem;
        font-size: 0.8125rem;
      }

      .prompt-text {
        font-size: 1.25rem;
      }

      .topic-grid {
        grid-template-columns: 1fr;
      }

      .style-selector {
        gap: 0.5rem;
      }

      .style-btn {
        padding: 0.625rem 1rem;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
<div class="container">
  
  <!-- HEADER -->
  <div class="header">
    <a href="../../../index.html?openModal=speaking" class="back-link">‚Üê Back</a>
    <h1>INTUITY</h1>
    <p class="subtitle">Speaking Part 3 ¬∑ Collaborative Discussion</p>
  </div>

  <!-- STYLE SELECTOR -->
  <div class="style-selector">
    <button class="style-btn active" data-style="default" id="styleDefault">
      üìù DEFAULT
    </button>
    <button class="style-btn" data-style="alternative1" id="styleAlt1">
      üéì ALTERNATIVE 1
    </button>
    <button class="style-btn" data-style="alternative2" id="styleAlt2">
      üî¨ ALTERNATIVE 2
    </button>
  </div>

  <!-- TOPIC SELECTOR -->
  <div class="topic-selector">
    <label>Choose a Discussion Topic</label>
    <div class="topic-grid" id="topicGrid"></div>
  </div>

  <!-- MAIN LAYOUT: DIALOGUE + TRACKER -->
  <div class="main-layout">
    
    <!-- LEFT: DIALOGUE STAGE -->
    <div class="dialogue-stage">
      
      <!-- Progress -->
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">Select a topic to begin...</div>

      <!-- Speakers -->
      <div class="speakers">
        <div class="speaker" id="speaker-emma">
          <div class="avatar">üë©</div>
          <div class="speaker-name">Emma</div>
          <div class="speaking-indicator" id="indicator-emma"></div>
        </div>
        
        <div class="speaker" id="speaker-lucas">
          <div class="avatar">üë®</div>
          <div class="speaker-name">Lucas</div>
          <div class="speaking-indicator" id="indicator-lucas"></div>
        </div>
      </div>

      <!-- Dialogue Bubble -->
      <div class="dialogue-bubble" id="dialogueBubble">
        <div class="speaker-label" id="speakerLabel"></div>
        <div class="text-content" id="textContent">Select a topic to begin...</div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="action-btn discourse-btn" id="discourseBtn">
          <span>üî¨</span>
          <span>Discourse</span>
        </button>
        <button class="action-btn phrase-btn" id="phraseBtn">
          <span>üí°</span>
          <span>Phrases</span>
        </button>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="control-btn" id="playBtn" disabled>
          ‚ñ∂Ô∏è Play
        </button>
        <button class="control-btn" id="pauseBtn" disabled>
          ‚è∏Ô∏è Pause
        </button>
        <button class="control-btn" id="replayBtn">
          üîÅ Replay
        </button>
        <button class="control-btn primary" id="yourTurnBtn" style="display: none;">
          üéôÔ∏è Your Turn
        </button>
      </div>

    </div>

    <!-- RIGHT: DISCOURSE TRACKER -->
    <div class="tracker-stage">
      
      <div class="tracker-header">
        <div class="tracker-title">üìä Discourse Tracker</div>
        <div class="tracker-subtitle">Watch Part 3 patterns emerge naturally</div>
      </div>

      <div class="tracker-content" id="trackerContent">
        
        <div class="tracker-category agreement">
          <div class="tracker-category-title">Agreement</div>
          <div class="tracker-count" id="countAgreement">0</div>
          <div class="tracker-examples" id="examplesAgreement">
            Phrases will appear here...
          </div>
        </div>

        <div class="tracker-category disagreement">
          <div class="tracker-category-title">Disagreement</div>
          <div class="tracker-count" id="countDisagreement">0</div>
          <div class="tracker-examples" id="examplesDisagreement">
            Phrases will appear here...
          </div>
        </div>

        <div class="tracker-category inviting">
          <div class="tracker-category-title">Inviting Partner</div>
          <div class="tracker-count" id="countInviting">0</div>
          <div class="tracker-examples" id="examplesInviting">
            Phrases will appear here...
          </div>
        </div>

        <div class="tracker-category speculation">
          <div class="tracker-category-title">Speculation</div>
          <div class="tracker-count" id="countSpeculation">0</div>
          <div class="tracker-examples" id="examplesSpeculation">
            Phrases will appear here...
          </div>
        </div>

      </div>

    </div>

  </div>

  <!-- YOUR TURN SECTION -->
  <div class="your-turn-section" id="yourTurnSection">
    <div class="prompt-icon">üéôÔ∏è</div>
    <div class="prompt-text">Now It's Your Turn!</div>
    <div class="prompt-hint">
      Discuss with your partner: <span class="prompt-topic" id="promptTopic"></span>
    </div>
    <button class="control-btn primary" onclick="startRecording()" style="margin: 0 auto;">
      üî¥ Start Practicing
    </button>
  </div>

</div>

<!-- ALTERNATIVES MODAL -->
<div class="alternatives-modal-overlay" id="alternativesModal">
  <div class="alternatives-modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">
        <span>üí°</span>
        <span>Alternative Expressions</span>
      </div>
      <button class="modal-close" onclick="closeAlternativesModal()">√ó</button>
    </div>
    <div class="modal-body" id="alternativesModalBody"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>
  
<script>
// ==================== STATE ====================
let dialogues = [];
let currentDialogue = null;
let currentStyle = 'default';
let currentTurn = 0;
let isPlaying = false;
let isPaused = false;
let showDiscourse = false;
let phraseExplorerActive = false;

// Discourse tracking
let discourseCounts = {
  agreement: 0,
  disagreement: 0,
  inviting: 0,
  speculation: 0
};
let discourseExamples = {
  agreement: [],
  disagreement: [],
  inviting: [],
  speculation: []
};

// ==================== PHRASE ALTERNATIVES ====================
const PHRASE_ALTERNATIVES = {
  // Agreement phrases
  "I think": [
    { phrase: "In my opinion", tier: "Alternative 1" },
    { phrase: "From my perspective", tier: "Alternative 2" },
    { phrase: "I would argue", tier: "Alternative 2" }
  ],
  "Yeah, I see what you mean": [
    { phrase: "I understand your perspective", tier: "Alternative 1" },
    { phrase: "I acknowledge the merit in that", tier: "Alternative 2" }
  ],
  "That's a good point": [
    { phrase: "That's a valid observation", tier: "Alternative 1" },
    { phrase: "That constitutes a legitimate consideration", tier: "Alternative 2" }
  ],
  "Exactly": [
    { phrase: "Precisely", tier: "Alternative 1" },
    { phrase: "Indeed", tier: "Alternative 2" }
  ],
  "Fair enough": [
    { phrase: "I take your point", tier: "Alternative 1" },
    { phrase: "I grant you that point", tier: "Alternative 2" }
  ],
  
  // Disagreement phrases
  "Yeah, but": [
    { phrase: "I partly agree, but", tier: "Alternative 1" },
    { phrase: "I concede that point, however", tier: "Alternative 2" }
  ],
  "I'm not sure about that": [
    { phrase: "That may be true, but", tier: "Alternative 1" },
    { phrase: "While that holds some validity", tier: "Alternative 2" }
  ],
  "Don't you think": [
    { phrase: "Wouldn't you agree that", tier: "Alternative 1" },
    { phrase: "Might one consider", tier: "Alternative 2" }
  ],
  "But what about": [
    { phrase: "Have you considered", tier: "Alternative 1" },
    { phrase: "Have you taken into account", tier: "Alternative 2" }
  ],
  
  // Inviting phrases
  "What do you think?": [
    { phrase: "What's your perspective on this?", tier: "Alternative 1" },
    { phrase: "What's your assessment?", tier: "Alternative 2" }
  ],
  "Don't you think?": [
    { phrase: "Would you agree?", tier: "Alternative 1" },
    { phrase: "Would you concur?", tier: "Alternative 2" }
  ],
  
  // Speculation phrases
  "I reckon": [
    { phrase: "I would suggest", tier: "Alternative 1" },
    { phrase: "I would maintain", tier: "Alternative 2" }
  ],
  "Maybe": [
    { phrase: "Perhaps", tier: "Alternative 1" },
    { phrase: "Conceivably", tier: "Alternative 2" }
  ],
  "Probably": [
    { phrase: "It's likely that", tier: "Alternative 1" },
    { phrase: "In all likelihood", tier: "Alternative 2" }
  ],
  "I guess": [
    { phrase: "I suppose", tier: "Alternative 1" },
    { phrase: "Presumably", tier: "Alternative 2" }
  ]
};

// ==================== DISCOURSE MARKERS ====================
const DISCOURSE_MARKERS = {
  agreement: [
    "Yeah, I see what you mean", "That's a good point", "I get what you're saying",
    "Fair enough", "That makes sense", "True", "Exactly", "Yeah, definitely",
    "I totally agree", "That's so true", "For sure", "Absolutely", "You're right",
    "I think so too", "I completely agree", "I see your point", "I take your point",
    "I understand your perspective", "I acknowledge the merit", "I concur", "Indeed",
    "Precisely", "I grant you that"
  ],
  disagreement: [
    "Yeah, but", "I'm not sure about that", "I don't know", "Maybe, but",
    "But what about", "Don't you think", "Wouldn't you say", "Have you thought about",
    "What if", "I partly agree, but", "That may be true, but", "However",
    "On the other hand", "By contrast", "Conversely", "Nevertheless",
    "Notwithstanding", "While that holds some validity"
  ],
  inviting: [
    "What do you think?", "Do you agree?", "Don't you think?", "What about you?",
    "How about you?", "What's your view?", "You know what I mean?",
    "Does that make sense?", "Right?", "What's your perspective?",
    "How do you see it?", "What would you say?", "What's your assessment?",
    "Would you concur?"
  ],
  speculation: [
    "I think", "I reckon", "I feel like", "In my opinion", "The way I see it",
    "I'd say", "Maybe", "Probably", "I guess", "Perhaps", "Possibly",
    "It could be that", "It might be", "From my perspective", "I would argue",
    "I would contend", "Conceivably", "Presumably", "In all likelihood"
  ]
};

// ==================== LOAD DIALOGUES ====================
async function loadDialogues() {
  try {
    const response = await fetch('data/part3-dialogues-complete.json');
    dialogues = await response.json();
    renderTopicCards();
  } catch (error) {
    console.error('Error loading dialogues:', error);
    document.getElementById('textContent').textContent = 'Error loading dialogue data.';
  }
}

// ==================== RENDER TOPIC CARDS ====================
function renderTopicCards() {
  const container = document.getElementById('topicGrid');
  container.innerHTML = '';
  
  dialogues.forEach((dialogue, index) => {
    const card = document.createElement('div');
    card.className = 'topic-card';
    card.onclick = () => selectTopic(index);
    
    const photoUrl = dialogue.photos && dialogue.photos[0] 
      ? dialogue.photos[0].url 
      : 'https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=500';
    
    card.innerHTML = `
      <img src="${photoUrl}" alt="${dialogue.topic}" class="topic-card-image">
      <div class="topic-card-content">
        <div class="topic-card-title">${dialogue.topic}</div>
        <div class="topic-card-subtitle">Emma & Lucas discuss</div>
      </div>
    `;
    
    container.appendChild(card);
  });
}

// ==================== SELECT TOPIC ====================
function selectTopic(index) {
  currentDialogue = dialogues[index];
  currentTurn = 0;
  isPaused = false;
  
  // Reset discourse tracking
  resetDiscourseTracker();
  
  // Update UI
  document.querySelectorAll('.topic-card').forEach((card, i) => {
    card.classList.toggle('active', i === index);
  });
  
  document.getElementById('textContent').textContent = 'Press Play to start the discussion';
  document.getElementById('speakerLabel').textContent = '';
  document.getElementById('yourTurnSection').style.display = 'none';
  document.getElementById('yourTurnBtn').style.display = 'none';
  document.getElementById('playBtn').disabled = false;
  document.getElementById('pauseBtn').disabled = true;
  
  updateProgress();
}

// ==================== RESET DISCOURSE TRACKER ====================
function resetDiscourseTracker() {
  discourseCounts = {
    agreement: 0,
    disagreement: 0,
    inviting: 0,
    speculation: 0
  };
  discourseExamples = {
    agreement: [],
    disagreement: [],
    inviting: [],
    speculation: []
  };
  updateDiscourseTracker();
}

// ==================== UPDATE DISCOURSE TRACKER ====================
function updateDiscourseTracker() {
  for (const category in discourseCounts) {
    document.getElementById(`count${category.charAt(0).toUpperCase() + category.slice(1)}`).textContent = 
      discourseCounts[category];
    
    const examplesEl = document.getElementById(`examples${category.charAt(0).toUpperCase() + category.slice(1)}`);
    if (discourseExamples[category].length > 0) {
      const uniqueExamples = [...new Set(discourseExamples[category])].slice(0, 3);
      examplesEl.innerHTML = uniqueExamples.map(ex => 
        `<span class="tracker-example">"${ex}"</span>`
      ).join(', ');
    } else {
      examplesEl.textContent = 'Phrases will appear here...';
    }
  }
}

// ==================== IDENTIFY DISCOURSE IN TEXT ====================
function identifyDiscourseInText(text) {
  const found = [];
  
  for (const [category, phrases] of Object.entries(DISCOURSE_MARKERS)) {
    phrases.forEach(phrase => {
      const regex = new RegExp(`\\b${escapeRegex(phrase)}\\b`, 'gi');
      if (regex.test(text)) {
        found.push({ phrase, category });
        
        // Update tracker
        discourseCounts[category]++;
        if (!discourseExamples[category].includes(phrase)) {
          discourseExamples[category].push(phrase);
        }
      }
    });
  }
  
  return found;
}

function escapeRegex(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// ==================== PLAY DIALOGUE ====================
async function playDialogue() {
  if (!currentDialogue) {
    alert('Please select a topic first!');
    return;
  }
  
  isPlaying = true;
  isPaused = false;
  
  document.getElementById('playBtn').disabled = true;
  document.getElementById('pauseBtn').disabled = false;
  
  if (currentTurn > 0) {
    await continueDialogue();
    return;
  }
  
  currentTurn = 0;
  resetDiscourseTracker();
  await continueDialogue();
}

// ==================== CONTINUE DIALOGUE ====================
async function continueDialogue() {
  const turns = currentDialogue.styles[currentStyle].turns;
  
  while (currentTurn < turns.length && isPlaying && !isPaused) {
    const turn = turns[currentTurn];
    
    highlightSpeaker(turn.speaker);
    displayText(turn);
    
    // Identify and track discourse
    const discourseFound = identifyDiscourseInText(turn.text);
    updateDiscourseTracker();
    
    await speak(turn);
    
    if (isPlaying && !isPaused) {
      await wait(1200);
    }
    
    currentTurn++;
    updateProgress();
  }
  
  if (currentTurn >= turns.length && isPlaying) {
    isPlaying = false;
    document.getElementById('playBtn').disabled = true;
    document.getElementById('pauseBtn').disabled = true;
    showYourTurn();
  }
}

// ==================== PAUSE DIALOGUE ====================
function pauseDialogue() {
  isPaused = true;
  isPlaying = false;
  speechSynthesis.cancel();
  
  document.getElementById('playBtn').disabled = false;
  document.getElementById('pauseBtn').disabled = true;
  
  document.querySelectorAll('.speaking-indicator').forEach(ind => {
    ind.classList.remove('pulsing');
  });
}

// ==================== REPLAY DIALOGUE ====================
function replayDialogue() {
  speechSynthesis.cancel();
  isPlaying = false;
  isPaused = false;
  currentTurn = 0;
  
  document.getElementById('yourTurnSection').style.display = 'none';
  document.getElementById('yourTurnBtn').style.display = 'none';
  
  document.querySelectorAll('.speaker').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.speaking-indicator').forEach(ind => ind.classList.remove('pulsing'));
  
  resetDiscourseTracker();
  updateProgress();
  playDialogue();
}

// ==================== HIGHLIGHT SPEAKER ====================
function highlightSpeaker(speaker) {
  document.querySelectorAll('.speaker').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.speaking-indicator').forEach(ind => ind.classList.remove('pulsing'));
  
  const speakerEl = document.getElementById(`speaker-${speaker.toLowerCase()}`);
  if (speakerEl) {
    speakerEl.classList.add('active');
    
    const indicator = document.getElementById(`indicator-${speaker.toLowerCase()}`);
    if (indicator) {
      indicator.classList.add('pulsing');
    }
  }
}

// ==================== DISPLAY TEXT ====================
function displayText(turn) {
  const speakerLabel = document.getElementById('speakerLabel');
  const textContent = document.getElementById('textContent');
  
  speakerLabel.textContent = turn.speaker;
  
  let html = turn.text;
  
  // Identify discourse markers in text
  const discourseFound = identifyDiscourseInText(turn.text);
  
  if (discourseFound.length > 0) {
    discourseFound.forEach(marker => {
      const phrase = marker.phrase;
      const category = marker.category;
      const escapedPhrase = escapeRegex(phrase);
      const regex = new RegExp(`\\b(${escapedPhrase})\\b`, 'gi');
      
      const categoryClass = `${category}-phrase`;
      
      if (phraseExplorerActive && PHRASE_ALTERNATIVES[phrase]) {
        const escapedForJs = phrase.replace(/'/g, "\\'").replace(/"/g, '\\"');
        const altsJson = JSON.stringify(PHRASE_ALTERNATIVES[phrase]).replace(/"/g, '&quot;');
        html = html.replace(regex, `<span class="${categoryClass}"><span class="phrase-enhanced">$1<button class="phrase-hint-btn" onclick="event.stopPropagation(); showAlternatives('${escapedForJs}', ${altsJson})">üí°</button></span></span>`);
      } else {
        html = html.replace(regex, `<span class="${categoryClass}">$1</span>`);
      }
    });
  }
  
  textContent.innerHTML = html;
  textContent.classList.toggle('discourse-active', showDiscourse);
  textContent.classList.toggle('phrase-explorer-active', phraseExplorerActive);
}

// ==================== SPEAK ====================
async function speak(turn) {
  return new Promise((resolve) => {
    if (!isPlaying || isPaused) {
      resolve();
      return;
    }
    
    const utterance = new SpeechSynthesisUtterance(turn.text);
    utterance.lang = 'en-GB';
    utterance.rate = 0.85;
    utterance.pitch = 1.0;
    
    const voices = speechSynthesis.getVoices();
    let voice;

    if (turn.speaker === 'Emma') {
      voice = voices.find(v => v.lang === 'en-GB' && v.name.includes('Female')) ||
              voices.find(v => v.lang === 'en-GB' && v.name.includes('female')) ||
              voices.find(v => v.lang.startsWith('en') && v.name.includes('Female')) ||
              voices.find(v => v.lang.startsWith('en') && v.name.includes('female')) ||
              voices.find(v => v.name.toLowerCase().includes('samantha')) ||
              voices.find(v => v.name.toLowerCase().includes('victoria')) ||
              voices.find(v => !v.name.toLowerCase().includes('male') && v.lang.startsWith('en'));
    } else {
      voice = voices.find(v => v.lang === 'en-GB' && v.name.includes('Male')) ||
              voices.find(v => v.lang === 'en-GB' && v.name.includes('male')) ||
              voices.find(v => v.lang.startsWith('en') && v.name.includes('Male')) ||
              voices.find(v => v.lang.startsWith('en') && v.name.includes('male')) ||
              voices.find(v => v.name.toLowerCase().includes('daniel')) ||
              voices.find(v => v.name.toLowerCase().includes('alex'));
    }

    if (voice) {
      utterance.voice = voice;
    }
    
    utterance.onend = () => {
      const indicator = document.getElementById(`indicator-${turn.speaker.toLowerCase()}`);
      if (indicator) indicator.classList.remove('pulsing');
      resolve();
    };
    
    utterance.onerror = () => {
      resolve();
    };
    
    speechSynthesis.speak(utterance);
  });
}

// ==================== UPDATE PROGRESS ====================
function updateProgress() {
  if (!currentDialogue) return;
  
  const turns = currentDialogue.styles[currentStyle].turns;
  const progress = (currentTurn / turns.length) * 100;
  document.getElementById('progressFill').style.width = progress + '%';
  document.getElementById('progressText').textContent = 
    `Turn ${currentTurn} of ${turns.length}`;
}

// ==================== DISCOURSE TOGGLE ====================
document.getElementById('discourseBtn').addEventListener('click', function() {
  showDiscourse = !showDiscourse;
  this.classList.toggle('active', showDiscourse);
  
  const textContent = document.getElementById('textContent');
  textContent.classList.toggle('discourse-active', showDiscourse);
  
  if (currentDialogue && currentTurn > 0) {
    const turns = currentDialogue.styles[currentStyle].turns;
    const turn = turns[currentTurn - 1];
    displayText(turn);
  }
});

// ==================== PHRASE EXPLORER TOGGLE ====================
document.getElementById('phraseBtn').addEventListener('click', function() {
  phraseExplorerActive = !phraseExplorerActive;
  this.classList.toggle('active', phraseExplorerActive);
  
  const textContent = document.getElementById('textContent');
  textContent.classList.toggle('phrase-explorer-active', phraseExplorerActive);
  
  if (currentDialogue && currentTurn > 0) {
    const turns = currentDialogue.styles[currentStyle].turns;
    const turn = turns[currentTurn - 1];
    displayText(turn);
  }
});

// ==================== STYLE SWITCHING ====================
function switchStyle(style) {
  if (isPlaying) {
    speechSynthesis.cancel();
    pauseDialogue();
  }
  
  currentStyle = style;
  currentTurn = 0;
  
  document.querySelectorAll('.style-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.style === style);
  });
  
  document.getElementById('playBtn').disabled = false;
  document.getElementById('pauseBtn').disabled = true;
  document.getElementById('yourTurnSection').style.display = 'none';
  document.getElementById('yourTurnBtn').style.display = 'none';
  
  if (currentDialogue) {
    document.getElementById('textContent').textContent = `Press Play to hear Emma & Lucas in ${getStyleName(style)} style...`;
  }
  
  resetDiscourseTracker();
  updateProgress();
}

function getStyleName(style) {
  const names = {
    'default': 'DEFAULT',
    'alternative1': 'ALTERNATIVE 1',
    'alternative2': 'ALTERNATIVE 2'
  };
  return names[style] || 'DEFAULT';
}

document.getElementById('styleDefault').addEventListener('click', () => switchStyle('default'));
document.getElementById('styleAlt1').addEventListener('click', () => switchStyle('alternative1'));
document.getElementById('styleAlt2').addEventListener('click', () => switchStyle('alternative2'));

// ==================== SHOW ALTERNATIVES MODAL ====================
function showAlternatives(phrase, alternatives) {
  const modalBody = document.getElementById('alternativesModalBody');
  
  let html = `
    <div class="current-phrase-section">
      <div class="current-phrase-label">Currently Used</div>
      <div class="current-phrase-text">${escapeHtml(phrase)}</div>
    </div>

    <div class="alternatives-section">
      <div class="alternatives-header">
        üéØ ${alternatives.length} Alternative${alternatives.length > 1 ? 's' : ''}
      </div>
  `;

  alternatives.forEach(alt => {
    html += `
      <div class="alternative-item" onclick="copyAlternative('${escapeHtml(alt.phrase)}')">
        <span class="alternative-text">${escapeHtml(alt.phrase)} <span style="color: #8e8e93; font-size: 0.75rem;">(${alt.tier})</span></span>
        <button class="copy-btn" onclick="event.stopPropagation(); copyAlternative('${escapeHtml(alt.phrase)}')">Copy</button>
      </div>
    `;
  });

  html += `</div>`;
  
  modalBody.innerHTML = html;
  document.getElementById('alternativesModal').classList.add('active');
}

function closeAlternativesModal() {
  document.getElementById('alternativesModal').classList.remove('active');
}

function copyAlternative(text) {
  navigator.clipboard.writeText(text).then(() => {
    showToast(`Copied: "${text}" ‚úì`);
  }).catch(err => {
    console.error('Failed to copy:', err);
    showToast('Failed to copy', false);
  });
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ==================== SHOW YOUR TURN ====================
function showYourTurn() {
  document.getElementById('yourTurnBtn').style.display = 'flex';
}

document.getElementById('yourTurnBtn').addEventListener('click', function() {
  document.getElementById('yourTurnSection').style.display = 'block';
  document.getElementById('promptTopic').textContent = currentDialogue.topic;
  document.getElementById('yourTurnSection').scrollIntoView({ behavior: 'smooth', block: 'center' });
});

function startRecording() {
  alert('Practice time!\n\nDiscuss with your partner:\n"' + currentDialogue.topic + '"\n\nUse the discourse patterns you just learned!');
}

// ==================== TOAST ====================
function showToast(message, success = true) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.style.background = success 
    ? 'rgba(16, 185, 129, 0.95)' 
    : 'rgba(239, 68, 68, 0.95)';
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 2500);
}

// ==================== UTILITY ====================
function wait(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// ==================== MODAL CLICK OUTSIDE ====================
document.getElementById('alternativesModal').addEventListener('click', function(e) {
  if (e.target.id === 'alternativesModal') closeAlternativesModal();
});

// ==================== INITIALIZE ====================
window.speechSynthesis.onvoiceschanged = () => {
  console.log('Voices loaded:', speechSynthesis.getVoices().length);
};

window.addEventListener('load', loadDialogues);
</script>
</body>
</html>
