<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>INTUITY — Essay Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
/* ═══════════════════════════
   TOKENS
═══════════════════════════ */
:root {
  --bg:     #0c0c0c;
  --gold:   #C9A961;
  --gold-d: #9B7D3A;
  --gold-l: #E8D4A0;
  --white:  #FAFAF8;
  --ink:    #0d0d0d;
}

/* ═══════════════════════════
   RESET
═══════════════════════════ */
*, *::before, *::after {
  margin: 0; padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}
html, body {
  width: 100%; height: 100%;
  overflow: hidden; position: fixed;
  background: var(--bg);
  font-family: 'Inter', sans-serif;
  color: #fff;
  -webkit-font-smoothing: antialiased;
}

/* ═══════════════════════════
   SHELL + CARD
═══════════════════════════ */
.shell {
  position: fixed; inset: 0;
  display: flex; align-items: center; justify-content: center;
  padding: 2vh 3vw;
}
.card {
  width: 100%; height: 100%;
  max-width: 900px; max-height: 95vh;
  background: var(--white);
  border-radius: 1.5rem;
  box-shadow:
    0 0 0 1px rgba(201,169,97,0.15),
    0 24px 80px rgba(0,0,0,0.65),
    0 4px 16px rgba(0,0,0,0.4);
  display: flex; flex-direction: column;
  overflow: hidden; position: relative;
}
.card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--gold-d), var(--gold-l), var(--gold-d));
  z-index: 5;
}

/* ═══════════════════════════
   CARD HEADER
═══════════════════════════ */
.card-brand {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: space-between;
  padding: 1rem 1.5rem 0.75rem;
  margin-top: 3px;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  position: relative;
  z-index: 10;
}
.home-link {
  text-decoration: none;
  font-size: 1rem; font-weight: 600; color: var(--gold);
  transition: all 0.2s;
  padding: 0.4rem 0.6rem; border-radius: 0.5rem;
  display: flex; align-items: center; gap: 0.3rem;
}
.home-link:hover  { background: rgba(201,169,97,0.1); color: var(--gold-d); }
.home-link:active { transform: scale(0.95); }
.brand-word {
  position: absolute; left: 50%; transform: translateX(-50%);
  font-size: 0.65rem; font-weight: 800;
  letter-spacing: 0.22em; text-transform: uppercase;
  color: rgba(0,0,0,0.18); pointer-events: none;
}

/* ═══════════════════════════
   TYPE TABS ROW
═══════════════════════════ */
.type-row {
  flex-shrink: 0;
  display: flex; align-items: center; gap: 0.25rem;
  padding: 0.5rem 1.5rem;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  overflow-x: auto; scrollbar-width: none;
}
.type-row::-webkit-scrollbar { display: none; }
.type-btn {
  background: transparent;
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 2rem;
  padding: 0.3rem 0.875rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.68rem; font-weight: 700;
  color: rgba(0,0,0,0.38);
  cursor: pointer;
  transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
  white-space: nowrap; min-height: 30px;
}
.type-btn:hover  { border-color: rgba(0,0,0,0.25); color: rgba(0,0,0,0.65); }
.type-btn.active { background: var(--ink); border-color: var(--ink); color: var(--gold); }
.type-btn:active { transform: scale(0.96); }

/* ═══════════════════════════
   VIEW TOGGLE ROW
═══════════════════════════ */
.view-row {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.4rem 1.5rem;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
.view-label {
  font-size: 0.6rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.1em;
  color: rgba(0,0,0,0.3);
}
.view-toggle {
  display: flex; gap: 0.15rem;
  background: rgba(0,0,0,0.05);
  border-radius: 2rem; padding: 0.2rem;
}
.view-btn {
  background: transparent; border: none;
  padding: 0.3rem 0.875rem; border-radius: 1.5rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.65rem; font-weight: 700;
  color: rgba(0,0,0,0.38);
  cursor: pointer;
  transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
  white-space: nowrap;
}
.view-btn.active { background: var(--ink); color: var(--gold); }
.view-btn:hover:not(.active) { color: rgba(0,0,0,0.6); }

/* ═══════════════════════════
   CONTENT AREA
═══════════════════════════ */
.content-area {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  min-height: 0;
  padding: 1.5rem 2rem;
}
.content-area::-webkit-scrollbar { width: 4px; }
.content-area::-webkit-scrollbar-track { background: transparent; }
.content-area::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 2px; }

/* ═══════════════════════════
   VARIATION NAV
═══════════════════════════ */
.var-nav {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  gap: 1rem; padding: 0.625rem 1.5rem;
  border-top: 1px solid rgba(0,0,0,0.06);
}
.var-arrow {
  background: transparent;
  border: 2px solid rgba(0,0,0,0.15);
  width: 40px; height: 40px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; color: rgba(0,0,0,0.55);
  cursor: pointer; transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
}
.var-arrow:hover:not(:disabled) { background: var(--gold); border-color: var(--gold); color: #fff; }
.var-arrow:active:not(:disabled) { transform: scale(0.95); }
.var-arrow:disabled { opacity: 0.22; cursor: not-allowed; }
.var-dots { display: flex; gap: 0.4rem; align-items: center; }
.var-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: rgba(0,0,0,0.15);
  cursor: pointer; transition: all 0.2s;
}
.var-dot.on {
  background: var(--gold);
  box-shadow: 0 0 0 3px rgba(201,169,97,0.2);
  transform: scale(1.2);
}

/* ═══════════════════════════
   FOOTER PILLS
═══════════════════════════ */
.card-nav {
  flex-shrink: 0;
  display: flex; justify-content: center;
  padding: 0.75rem 1.125rem calc(env(safe-area-inset-bottom,0px) + 0.875rem);
  border-top: 1px solid rgba(0,0,0,0.06);
}
.nav-pill {
  display: flex; gap: 0.15rem;
  background: rgba(10,10,10,0.06);
  border-radius: 2rem; padding: 0.35rem 0.4rem;
}
.nb {
  background: transparent; border: none;
  padding: 0.5rem 1rem; border-radius: 1.5rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.7rem; letter-spacing: 0.02em;
  color: rgba(0,0,0,0.28);
  cursor: pointer; transition: all 0.24s cubic-bezier(0.4,0,0.2,1);
  white-space: nowrap; min-height: 36px; font-weight: 500;
}
.nb.on { background: var(--ink); color: var(--gold); font-weight: 700; }
.nb:hover:not(.on) { color: rgba(0,0,0,0.5); }

/* ═══════════════════════════
   SKELETON CONTENT
═══════════════════════════ */
.skeleton-wrap {
  font-family: 'Inter', sans-serif;
  font-size: 0.85rem;
  color: rgba(0,0,0,0.85);
}
.para-block { margin-bottom: 1.25rem; }
.para-block:last-child { margin-bottom: 0; }
.para-title {
  font-size: 0.65rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.1em;
  margin-bottom: 0.35rem;
}
.para-title.intro    { color: #4CAF50; }
.para-title.body     { color: #ed8b34; }
.para-title.conclusion { color: #4A90E2; }
.para-line {
  font-size: 0.85rem; line-height: 1.65;
  color: rgba(0,0,0,0.82);
  margin-bottom: 0.1rem;
}
.para-divider {
  height: 1px; background: rgba(0,0,0,0.08);
  margin: 0.75rem 0;
}

/* ═══════════════════════════
   PHRASES CONTENT
═══════════════════════════ */
.phrases-wrap {}
.ph-category { margin-bottom: 1.75rem; }
.ph-category:last-child { margin-bottom: 0; }
.ph-cat-title {
  font-size: 0.68rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.1em;
  padding-bottom: 0.4rem;
  border-bottom: 2px solid rgba(0,0,0,0.12);
  margin-bottom: 0.875rem;
}
.ph-cat-title.intro      { color: #4CAF50; border-color: #4CAF50; }
.ph-cat-title.body       { color: #ed8b34; border-color: #ed8b34; }
.ph-cat-title.conclusion { color: #4A90E2; border-color: #4A90E2; }
.ph-sub { margin-bottom: 1rem; }
.ph-sub:last-child { margin-bottom: 0; }
.ph-sub-title {
  font-size: 0.62rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.06em;
  color: rgba(0,0,0,0.5); margin-bottom: 0.4rem;
}
.ph-list { list-style: none; }
.ph-item {
  font-size: 0.83rem; line-height: 1.65;
  color: rgba(0,0,0,0.78); font-weight: 400;
  padding-left: 1rem; position: relative;
  margin-bottom: 0.3rem;
}
.ph-item::before {
  content: '→'; position: absolute; left: 0;
  color: rgba(0,0,0,0.35); font-size: 0.72rem;
}

/* ═══════════════════════════
   STATE MESSAGES
═══════════════════════════ */
.state-msg {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  height: 100%; gap: 0.75rem;
  font-size: 0.9rem; color: rgba(0,0,0,0.3);
  text-align: center; line-height: 1.6;
}

/* ═══════════════════════════
   RESPONSIVE
═══════════════════════════ */
@media (max-width: 768px) {
  .shell { padding: 1vh 2vw; }
  .card  { border-radius: 1rem; }
  .card-brand { padding: 0.75rem 1rem 0.5rem; }
  .type-row { padding: 0.4rem 1rem; }
  .view-row { padding: 0.35rem 1rem; }
  .content-area { padding: 1.25rem; }
  .nb { padding: 0.4rem 0.75rem; font-size: 0.65rem; min-height: 32px; }
  .para-line { font-size: 0.8rem; }
  .ph-item { font-size: 0.78rem; }
}
@media (max-width: 400px) {
  .shell { padding: 0.5vh 1vw; }
  .card  { border-radius: 0.75rem; }
  .content-area { padding: 1rem; }
  .nb { padding: 0.35rem 0.65rem; font-size: 0.6rem; }
}
@media (min-width: 1400px) {
  .card { max-width: 1200px; }
  .content-area { padding: 2rem 3rem; }
  .para-line { font-size: 1rem; }
  .ph-item { font-size: 0.95rem; }
  .nb { font-size: 0.8rem; padding: 0.6rem 1.25rem; min-height: 42px; }
}
  </style>
</head>
<body>

<div class="shell">
<div class="card">

  <!-- HEADER -->
  <div class="card-brand">
    <a href="essay-question-selector.html" class="home-link">← Questions</a>
    <span class="brand-word">INTUITY</span>
    <div style="flex:1"></div>
  </div>

  <!-- TYPE TABS -->
  <div class="type-row" id="typeRow">
    <!-- injected by JS -->
  </div>

  <!-- VIEW TOGGLE -->
  <div class="view-row">
    <span class="view-label" id="viewLabel">Skeleton</span>
    <div class="view-toggle">
      <button class="view-btn active" onclick="setView('skeleton')">Skeleton</button>
      <button class="view-btn"        onclick="setView('phrases')">Phrases</button>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content-area" id="contentArea">
    <div class="state-msg">Loading essay data…</div>
  </div>

  <!-- VARIATION NAV (skeleton mode only) -->
  <div class="var-nav" id="varNav">
    <button class="var-arrow" id="varPrev" onclick="navigate(-1)">←</button>
    <div class="var-dots" id="varDots"></div>
    <button class="var-arrow" id="varNext" onclick="navigate(1)">→</button>
  </div>

  <!-- FOOTER PILLS -->
  <div class="card-nav">
    <div class="nav-pill">
      <button class="nb"    onclick="navTo('question')">question</button>
      <button class="nb"    onclick="navTo('plan')">plan</button>
      <button class="nb on" onclick="navTo('model')">model</button>
      <button class="nb"    onclick="navTo('build')">build</button>
      <button class="nb"    onclick="navTo('sample')">sample</button>
    </div>
  </div>

</div>
</div>

<script>
/* ════════════════════════════════
   STATE
════════════════════════════════ */
let question     = null;
let skeletonData = null;
let phraseData   = null;
let currentType  = null;
let currentVar   = 0;
let viewMode     = 'skeleton';

/* ════════════════════════════════
   FOOTER NAV
════════════════════════════════ */
function navTo(dest) {
  if (dest === 'model') return;
  if (question) sessionStorage.setItem('currentQuestion', JSON.stringify(question));
  const map = {
    question: 'essay-question-selector.html',
    plan:     'essay-plan.html',
    build:    'essay-builder-interactive.html',
    sample:   'essay-master.html'
  };
  if (map[dest]) window.location.href = map[dest];
}

/* ════════════════════════════════
   INIT
════════════════════════════════ */
async function init() {
  try {
    question = JSON.parse(sessionStorage.getItem('currentQuestion'));
  } catch(e) {}

  try {
    const [r1, r2] = await Promise.all([
      fetch('data/complete-essay-phrase-bank.json'),
      fetch('data/complete-essay-phrase-bank1.json')
    ]);
    if (!r1.ok || !r2.ok) throw new Error('Data files not found');
    skeletonData = await r1.json();
    phraseData   = await r2.json();

    // Default to first type
    const types = Object.keys(skeletonData).filter(k => k !== 'meta');
    currentType = types[0];

    renderTypeTabs();
    renderContent();
  } catch(err) {
    document.getElementById('contentArea').innerHTML =
      `<div class="state-msg">Could not load essay data.<br>
       <small style="opacity:0.4;margin-top:0.5rem;display:block;">
         Needs: data/complete-essay-phrase-bank.json<br>
         &amp; data/complete-essay-phrase-bank1.json
       </small></div>`;
    document.getElementById('varNav').style.display = 'none';
  }
}

/* ════════════════════════════════
   TYPE TABS
════════════════════════════════ */
function renderTypeTabs() {
  const types = Object.keys(skeletonData).filter(k => k !== 'meta');
  document.getElementById('typeRow').innerHTML = types.map(t =>
    `<button class="type-btn${t === currentType ? ' active' : ''}" onclick="switchType('${t}')">
       ${skeletonData[t].label}
     </button>`
  ).join('');
}

function switchType(type) {
  currentType = type;
  currentVar  = 0;
  renderTypeTabs();
  renderContent();
}

/* ════════════════════════════════
   VIEW MODE
════════════════════════════════ */
function setView(mode) {
  viewMode = mode;
  document.querySelectorAll('.view-btn').forEach((b,i) =>
    b.classList.toggle('active', (i === 0 && mode === 'skeleton') || (i === 1 && mode === 'phrases'))
  );
  document.getElementById('viewLabel').textContent =
    mode === 'skeleton' ? 'Skeleton' : 'Phrases';
  renderContent();
}

/* ════════════════════════════════
   RENDER
════════════════════════════════ */
function renderContent() {
  const area = document.getElementById('contentArea');
  const varNav = document.getElementById('varNav');

  if (viewMode === 'skeleton') {
    const typeData = skeletonData[currentType];
    const variation = typeData.skeletons[currentVar];
    varNav.style.display = 'flex';
    renderDots();
    updateVarNav();
    area.innerHTML = renderSkeleton(variation);
  } else {
    varNav.style.display = 'none';
    area.innerHTML = renderPhrases(currentType);
  }
}

function renderSkeleton(variation) {
  if (!variation) return `<div class="state-msg">No skeleton data.</div>`;
  let html = '<div class="skeleton-wrap">';
  variation.skeleton.forEach((para, i) => {
    const t = para.title.toLowerCase();
    const cls = t.includes('intro') || t.includes('opening') || t.includes('hook') ? 'intro'
              : t.includes('conclu') || t.includes('closing') || t.includes('final') ? 'conclusion'
              : 'body';
    html += `<div class="para-block">
      <div class="para-title ${cls}">${para.title}</div>
      ${para.lines.map(l => `<div class="para-line">${l || '&nbsp;'}</div>`).join('')}
    </div>`;
    if (i < variation.skeleton.length - 1)
      html += '<div class="para-divider"></div>';
  });
  html += '</div>';
  return html;
}

function renderPhrases(type) {
  if (!phraseData[type] || !phraseData[type].categories)
    return `<div class="state-msg">No phrase bank for this essay type.</div>`;
  let html = '<div class="phrases-wrap">';
  phraseData[type].categories.forEach(cat => {
    const t = cat.title.toLowerCase();
    const cls = t.includes('intro') || t.includes('opening') ? 'intro'
              : t.includes('conclu') || t.includes('closing') ? 'conclusion'
              : 'body';
    html += `<div class="ph-category">
      <div class="ph-cat-title ${cls}">${cat.title}</div>`;
    cat.subcategories.forEach(sub => {
      html += `<div class="ph-sub">
        <div class="ph-sub-title">${sub.subtitle}</div>
        <ul class="ph-list">
          ${sub.phrases.map(p => `<li class="ph-item">${p}</li>`).join('')}
        </ul>
      </div>`;
    });
    html += '</div>';
  });
  html += '</div>';
  return html;
}

/* ════════════════════════════════
   VARIATION NAV
════════════════════════════════ */
function renderDots() {
  const typeData = skeletonData[currentType];
  document.getElementById('varDots').innerHTML =
    typeData.skeletons.map((_,i) =>
      `<div class="var-dot${i === currentVar ? ' on' : ''}" onclick="switchVar(${i})"></div>`
    ).join('');
}

function updateVarNav() {
  const len = skeletonData[currentType].skeletons.length;
  document.getElementById('varPrev').disabled = currentVar === 0;
  document.getElementById('varNext').disabled = currentVar >= len - 1;
}

function switchVar(i) {
  currentVar = i;
  renderContent();
}

function navigate(dir) {
  if (viewMode === 'skeleton') {
    const len = skeletonData[currentType].skeletons.length;
    currentVar = Math.max(0, Math.min(currentVar + dir, len - 1));
  } else {
    const types = Object.keys(skeletonData).filter(k => k !== 'meta');
    const idx = types.indexOf(currentType) + dir;
    if (idx >= 0 && idx < types.length) { switchType(types[idx]); return; }
  }
  renderContent();
}

/* ════════════════════════════════
   KEYBOARD + SWIPE
════════════════════════════════ */
document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft')  navigate(-1);
  if (e.key === 'ArrowRight') navigate(1);
});
let _tx = 0;
if ('ontouchstart' in window) {
  document.addEventListener('touchstart', e => { _tx = e.changedTouches[0].screenX; });
  document.addEventListener('touchend',   e => {
    const dx = e.changedTouches[0].screenX - _tx;
    if (dx < -50) navigate(1);
    if (dx >  50) navigate(-1);
  });
}

init();
</script>
</body>
</html>
