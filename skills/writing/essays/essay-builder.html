<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Essay Builder — INTUITY</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#0c0c0c;--gold:#C9A961;--gold-d:#9B7D3A;--gold-l:#E8D4A0;
  --white:#FAFAF8;--ink:#0d0d0d;
  --health:#4CAF50;--health-bg:rgba(76,175,80,0.1);
  --entertain:#FF6B6B;--entertain-bg:rgba(255,107,107,0.1);
  --tech:#4A90E2;--tech-bg:rgba(74,144,226,0.1);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden;position:fixed;background:var(--bg);font-family:'Inter',sans-serif;color:#fff;-webkit-font-smoothing:antialiased;}
.shell{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:2vh 3vw;}
.card{width:100%;height:100%;max-width:900px;max-height:95vh;background:var(--white);border-radius:1.5rem;box-shadow:0 0 0 1px rgba(201,169,97,0.15),0 24px 80px rgba(0,0,0,0.65),0 4px 16px rgba(0,0,0,0.4);display:flex;flex-direction:column;overflow:hidden;position:relative;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--gold-d),var(--gold-l),var(--gold-d));z-index:5;}

/* HEADER */
.card-brand{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:0.875rem 1.25rem 0.625rem;margin-top:3px;position:relative;border-bottom:1px solid rgba(0,0,0,0.06);}
.home-link{text-decoration:none;font-family:'Inter',sans-serif;font-size:0.875rem;font-weight:600;color:var(--gold);transition:all 0.2s;padding:0.35rem 0.5rem;border-radius:0.5rem;display:flex;align-items:center;gap:0.3rem;}
.home-link:hover{background:rgba(201,169,97,0.1);color:var(--gold-d);}
.home-link:active{transform:scale(0.95);}
.menu-btn{background:#000;border:1px solid rgba(0,0,0,0.12);width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;}
.menu-btn:hover{background:rgba(0,0,0,0.85);}
.menu-btn:active{transform:scale(0.95);}
.menu-dots{display:flex;gap:3.5px;}
.menu-dots span{width:3.5px;height:3.5px;border-radius:50%;background:#fff;}
.menu-dropdown{position:absolute;top:calc(100% + 0.5rem);right:1rem;background:#fff;border-radius:0.75rem;box-shadow:0 0 0 1px rgba(0,0,0,0.08),0 8px 24px rgba(0,0,0,0.12);min-width:220px;padding:0.5rem;z-index:100;display:none;}
.menu-dropdown.open{display:block;animation:menuSlide 0.2s ease-out;}
@keyframes menuSlide{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
.menu-item{padding:0.65rem 0.85rem;border-radius:0.5rem;font-family:'Inter',sans-serif;font-size:0.8rem;font-weight:500;color:rgba(0,0,0,0.7);cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:space-between;}
.menu-item:hover{background:rgba(0,0,0,0.04);color:rgba(0,0,0,0.9);}
.menu-item.active{background:var(--gold);color:#fff;}
.brand-word{position:absolute;left:50%;transform:translateX(-50%);font-family:'Inter',sans-serif;font-size:0.58rem;font-weight:800;letter-spacing:0.22em;text-transform:uppercase;color:rgba(0,0,0,0.18);}

/* SECONDARY HEADER - TAB NAVIGATION */
.card-tabs{flex-shrink:0;display:flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.625rem 1.25rem;background:var(--white);border-bottom:1px solid rgba(0,0,0,0.06);overflow-x:auto;-webkit-overflow-scrolling:touch;}
.card-tabs::-webkit-scrollbar{height:4px;}
.card-tabs::-webkit-scrollbar-track{background:transparent;}
.card-tabs::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.1);border-radius:2px;}
.tab-btn{background:transparent;border:none;border-bottom:3px solid transparent;padding:0.45rem 0.875rem;font-family:'Inter',sans-serif;font-size:0.68rem;font-weight:700;color:rgba(0,0,0,0.4);cursor:pointer;transition:all 0.2s;text-transform:uppercase;letter-spacing:0.08em;white-space:nowrap;}
.tab-btn:hover{color:rgba(0,0,0,0.6);border-bottom-color:rgba(201,169,97,0.3);}
.tab-btn.active{color:var(--gold);border-bottom-color:var(--gold);}

/* CONTENT AREA */
.card-content{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative;}
.content-header{flex-shrink:0;display:flex;justify-content:space-between;align-items:center;padding:0.825rem 1.75rem 0.625rem;border-bottom:2px solid rgba(0,0,0,0.06);}
.content-title{font-family:'Inter',sans-serif;font-size:0.68rem;font-weight:600;color:rgba(0,0,0,0.4);text-transform:uppercase;letter-spacing:0.1em;}
.view-toggle{display:flex;background:rgba(0,0,0,0.04);border:1px solid rgba(0,0,0,0.08);border-radius:7px;padding:0.225rem;gap:0.225rem;}
.toggle-btn{padding:0.35rem 0.75rem;background:transparent;border:none;border-radius:5px;color:rgba(0,0,0,0.5);font-size:0.65rem;font-weight:800;cursor:pointer;transition:all 0.25s;text-transform:uppercase;letter-spacing:0.05em;font-family:'Inter',sans-serif;}
.toggle-btn:hover{color:rgba(0,0,0,0.7);}
.toggle-btn.active{background:#000;color:var(--gold);}

/* SCROLLABLE CONTENT */
.infographic{flex:1;padding:1rem 1.75rem;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:0;}
.infographic::-webkit-scrollbar{width:5px;}
.infographic::-webkit-scrollbar-track{background:transparent;}
.infographic::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.15);border-radius:2.5px;}

/* SKELETON DISPLAY */
.skeleton-display .paragraph-block{margin-bottom:0.875rem;}
.skeleton-display .paragraph-block:last-child{margin-bottom:0;}
.skeleton-display .paragraph-title{color:rgba(0,0,0,0.5);margin-bottom:0.35rem;font-weight:700;font-size:0.68rem;}
.skeleton-display .paragraph-title.intro{color:#90EE90;}
.skeleton-display .paragraph-title.body{color:#ed8b34;}
.skeleton-display .paragraph-title.conclusion{color:#4A90E2;}
.skeleton-display .listing-prefix{font-family:'DM Sans',sans-serif;font-size:0.65rem;color:var(--gold-d);font-weight:600;font-style:italic;margin-bottom:0.225rem;line-height:1.4;}
.skeleton-display .paragraph-text{color:rgba(0,0,0,0.8);line-height:1.45;margin-bottom:0.225rem;font-size:0.7rem;}
.skeleton-display .divider{height:1px;background:rgba(0,0,0,0.1);margin:0.65rem 0;}

/* PHRASES DISPLAY */
.phrases-display{font-family:'Inter',sans-serif;color:rgba(0,0,0,0.9);}
.phrase-category{margin-bottom:1.5rem;}
.phrase-category:last-child{margin-bottom:0;}
.category-title{font-size:0.75rem;font-weight:800;color:rgba(0,0,0,0.9);margin-bottom:0.75rem;text-transform:uppercase;letter-spacing:0.08em;padding-bottom:0.4rem;border-bottom:2px solid rgba(0,0,0,0.2);}
.category-title.intro{color:#90EE90;border-bottom-color:#90EE90;}
.category-title.body{color:#ed8b34;border-bottom-color:#ed8b34;}
.category-title.conclusion{color:#4A90E2;border-bottom-color:#4A90E2;}
.subcategory{margin-bottom:1.125rem;}
.subcategory:last-child{margin-bottom:0;}
.subcategory-title{font-size:0.7rem;font-weight:700;color:rgba(0,0,0,0.7);margin-bottom:0.6rem;text-transform:uppercase;letter-spacing:0.05em;}
.phrase-list{list-style:none;padding:0;}
.phrase-item{font-size:0.75rem;line-height:1.6;color:rgba(0,0,0,0.8);margin-bottom:0.5rem;padding-left:0.875rem;position:relative;}
.phrase-item:before{content:"→";position:absolute;left:0;color:var(--gold);font-weight:700;}

/* NAVIGATION ARROWS */
.slide-nav{flex-shrink:0;display:flex;align-items:center;justify-content:center;gap:1.75rem;padding:0.825rem 1.25rem;background:var(--white);border-top:1px solid rgba(0,0,0,0.06);}
.slide-arrow{background:transparent;border:2px solid rgba(0,0,0,0.15);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.25s cubic-bezier(0.4,0,0.2,1);font-size:1.3rem;color:rgba(0,0,0,0.6);font-weight:600;line-height:1;padding:0;}
.slide-arrow:hover:not(:disabled){background:var(--gold);border-color:var(--gold);color:#fff;transform:scale(1.05);}
.slide-arrow:active:not(:disabled){transform:scale(0.95);}
.slide-arrow:disabled{opacity:0.25;cursor:not-allowed;}
.page-counter{font-family:'Inter',sans-serif;font-size:0.875rem;font-weight:600;color:rgba(0,0,0,0.5);min-width:72px;text-align:center;user-select:none;}

/* FOOTER NAVIGATION */
.card-nav{flex-shrink:0;display:flex;justify-content:center;padding:0.65rem 1rem calc(env(safe-area-inset-bottom,0px) + 0.75rem);background:var(--white);border-top:1px solid rgba(0,0,0,0.06);}
.nav-pill{display:flex;gap:0.15rem;background:rgba(10,10,10,0.06);border-radius:2rem;padding:0.3rem 0.35rem;}
.nb{background:transparent;border:none;padding:0.45rem 0.875rem;border-radius:1.5rem;font-family:'Inter',sans-serif;font-size:0.65rem;letter-spacing:0.02em;color:rgba(0,0,0,0.28);cursor:pointer;transition:all 0.24s cubic-bezier(0.4,0,0.2,1);white-space:nowrap;min-height:33px;position:relative;font-weight:500;}
.nb.on{background:var(--ink);color:var(--gold);font-weight:700;}
.nb:hover:not(.on){color:rgba(0,0,0,0.5);}

@media(max-width:768px){.shell{padding:1vh 2vw;}.card{max-width:100%;border-radius:1rem;}.card-brand{padding:0.7rem 0.95rem 0.475rem;}.brand-word{font-size:0.52rem;}.home-link{font-size:0.8rem;padding:0.3rem 0.45rem;}.menu-btn{width:28px;height:28px;}.menu-dots{gap:3px;}.menu-dots span{width:3px;height:3px;}.card-tabs{padding:0.575rem 0.95rem;gap:0.375rem;}.tab-btn{padding:0.375rem 0.7rem;font-size:0.6rem;}.content-header{padding:0.75rem 1.3rem 0.55rem;}.content-title{font-size:0.6rem;}.toggle-btn{padding:0.3rem 0.625rem;font-size:0.575rem;}.infographic{padding:0.875rem 1.3rem;}.skeleton-display .paragraph-block{margin-bottom:0.7rem;}.skeleton-display .paragraph-title{font-size:0.6rem;margin-bottom:0.3rem;}.skeleton-display .listing-prefix{font-size:0.575rem;margin-bottom:0.2rem;}.skeleton-display .paragraph-text{font-size:0.625rem;margin-bottom:0.2rem;}.skeleton-display .divider{margin:0.55rem 0;}.phrase-category{margin-bottom:1.25rem;}.category-title{font-size:0.675rem;margin-bottom:0.625rem;}.subcategory{margin-bottom:0.95rem;}.subcategory-title{font-size:0.625rem;margin-bottom:0.5rem;}.phrase-item{font-size:0.675rem;margin-bottom:0.425rem;}.slide-nav{padding:0.725rem 1.125rem;gap:1.4rem;}.slide-arrow{width:37px;height:37px;font-size:1.2rem;}.page-counter{font-size:0.8rem;min-width:66px;}.card-nav{padding:0.575rem 0.95rem calc(env(safe-area-inset-bottom,0px) + 0.675rem);}.nb{padding:0.375rem 0.7rem;font-size:0.6rem;min-height:30px;}}
@media(max-width:400px){.shell{padding:0.5vh 1vw;}.card{border-radius:0.75rem;}.infographic{padding:0.75rem 1.125rem;}.home-link{font-size:0.75rem;}.skeleton-display .paragraph-text{font-size:0.6rem;}.slide-arrow{width:34px;height:34px;font-size:1.15rem;}.page-counter{font-size:0.75rem;min-width:62px;}.nb{padding:0.325rem 0.625rem;font-size:0.575rem;}}
@media(min-width:1024px){.card{max-width:1100px;max-height:90vh;}.card-brand{padding:0.8rem 1.4rem 0.575rem;}.infographic{padding:0.95rem 1.9rem;}.skeleton-display .paragraph-block{margin-bottom:0.8rem;}.skeleton-display .paragraph-title{font-size:0.66rem;}.skeleton-display .listing-prefix{font-size:0.63rem;}.skeleton-display .paragraph-text{font-size:0.68rem;}.phrase-category{margin-bottom:1.4rem;}.category-title{font-size:0.72rem;}.subcategory-title{font-size:0.68rem;}.phrase-item{font-size:0.73rem;}}
@media(min-width:1400px){.card{max-width:1200px;}.infographic{padding:1.125rem 2.25rem;}.skeleton-display .listing-prefix{font-size:0.65rem;}.skeleton-display .paragraph-text{font-size:0.7rem;}}
</style>
</head>
<body>

<div class="shell">
<div class="card">

  <!-- HEADER -->
  <div class="card-brand">
    <a href="../../../index.html?openModal=writing&submenu=essays" class="home-link">← Essays</a>
    <span class="brand-word">INTUITY</span>
    <div style="flex:1"></div>
    <div class="menu-btn" id="menuBtn" onclick="toggleMenu()">
      <div class="menu-dots"><span></span><span></span><span></span></div>
    </div>
    <div class="menu-dropdown" id="menuDropdown">
      <div class="menu-item active" onclick="filterByType('all')">
        <span>All Questions</span>
      </div>
      <div class="menu-item" onclick="filterByType('opinion')">
        <span>Opinion</span>
      </div>
      <div class="menu-item" onclick="filterByType('for-against')">
        <span>For &amp; Against</span>
      </div>
      <div class="menu-item" onclick="filterByType('problem-solution')">
        <span>Problem &amp; Solution</span>
      </div>
      <div class="menu-item" onclick="filterByType('cause-effect')">
        <span>Cause &amp; Effect</span>
      </div>
      <div class="menu-item" onclick="filterByType('speculation-trends')">
        <span>Speculation &amp; Trends</span>
      </div>
    </div>
  </div>

  <!-- TAB NAVIGATION -->
  <div class="card-tabs" id="tabsContainer">
    <!-- Tabs will be generated here -->
  </div>

  <!-- CONTENT AREA -->
  <div class="card-content">
    <div class="content-header">
      <div class="content-title" id="contentTitle">Loading...</div>
      <div class="view-toggle">
        <button class="toggle-btn active" data-mode="skeleton" onclick="setViewMode('skeleton')">Skeleton</button>
        <button class="toggle-btn" data-mode="phrases" onclick="setViewMode('phrases')">Phrases</button>
      </div>
    </div>
    <div class="infographic" id="contentArea">
      <!-- Content will be loaded here -->
    </div>
  </div>

  <!-- NAVIGATION ARROWS -->
  <div class="slide-nav">
    <button class="slide-arrow" id="btnPrev" onclick="navigate(-1)">←</button>
    <div class="page-counter" id="pageCounter">1 / 1</div>
    <button class="slide-arrow" id="btnNext" onclick="navigate(1)">→</button>
  </div>

  <!-- FOOTER NAVIGATION -->
  <div class="card-nav">
    <div class="nav-pill">
      <button class="nb" data-mode="question" onclick="switchMode('question')">question</button>
      <button class="nb" data-mode="plan" onclick="switchMode('plan')">plan</button>
      <button class="nb on" data-mode="model" onclick="switchMode('model')">model</button>
      <button class="nb" data-mode="build" onclick="switchMode('build')">build</button>
      <button class="nb" data-mode="sample" onclick="switchMode('sample')">sample</button>
    </div>
  </div>

</div>
</div>

<script>
/* ═══ STATE ═══ */
let skeletonData = null;
let phraseData = null;
let currentType = 'for-against';
let currentVariation = 0;
let viewMode = 'skeleton';

/* ═══ EMBEDDED PHRASE BANK ═══ */
const listingMarkers = {
  first: [
    "Firstly, it seems to me that",
    "First and foremost,",
    "To begin with,",
    "In the first place,",
    "First of all,",
    "Initially,"
  ],
  second: [
    "Secondly, it is often suggested that",
    "Furthermore, I would argue that",
    "Moreover, it is worth noting that",
    "In addition, from my perspective,",
    "Additionally, many believe that",
    "What is more,",
    "Besides this,"
  ],
  third: [
    "On the other hand, in my view",
    "However, critics may argue that",
    "Conversely,",
    "Nevertheless,",
    "By contrast,",
    "In contrast,"
  ],
  counter: [
    "Some people might argue that",
    "Admittedly,",
    "While it could be argued that",
    "Although there are concerns,",
    "It must be acknowledged that"
  ]
};

function getRandomItem(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function getListingPrefix(index, total) {
  if (index === 0) return null; // No prefix for intro
  if (index === 1) return getRandomItem(listingMarkers.first);
  if (index === 2) return getRandomItem(listingMarkers.second);
  if (index === 3 && total >= 4) return getRandomItem(listingMarkers.third);
  if (index === total - 1) return null; // No prefix for conclusion
  return getRandomItem(listingMarkers.second);
}

/* ═══ MENU ═══ */
function toggleMenu(){
  document.getElementById('menuDropdown').classList.toggle('open');
}
document.addEventListener('click', e => {
  const menu = document.getElementById('menuDropdown');
  const btn  = document.getElementById('menuBtn');
  if(menu && btn && !menu.contains(e.target) && !btn.contains(e.target))
    menu.classList.remove('open');
});

/* ═══ FILTER ═══ */
function filterByType(type){
  document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
  event.target.closest('.menu-item').classList.add('active');
  document.getElementById('menuDropdown').classList.remove('open');
}

/* ═══ INIT ═══ */
async function init() {
  try {
    const [skeletonResponse, phraseResponse] = await Promise.all([
      fetch('data/complete-essay-phrase-bank.json'),
      fetch('data/complete-essay-phrase-bank1.json')
    ]);
    
    if (!skeletonResponse.ok || !phraseResponse.ok) {
      throw new Error('Failed to load data files');
    }
    
    skeletonData = await skeletonResponse.json();
    phraseData = await phraseResponse.json();
    
    renderTabs();
    renderContent();
    updateNav();
    
  } catch (error) {
    console.error('Error loading data:', error);
    document.getElementById('contentArea').innerHTML = `
      <div style="text-align: center; padding: 2rem; color: rgba(0,0,0,0.4);">
        <div style="font-size: 2rem; margin-bottom: 1rem;">⚠️</div>
        <div style="font-size: 1.2rem; font-weight: 700;">Failed to load essay data</div>
        <div style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.6;">${error.message}</div>
      </div>
    `;
  }
}

/* ═══ RENDER TABS ═══ */
function renderTabs() {
  const container = document.getElementById('tabsContainer');
  const types = Object.keys(skeletonData).filter(key => key !== 'meta');
  
  container.innerHTML = types.map(typeKey => {
    const typeData = skeletonData[typeKey];
    return `
      <button class="tab-btn ${typeKey === currentType ? 'active' : ''}" 
              onclick="switchType('${typeKey}')">
        ${typeData.label}
      </button>
    `;
  }).join('');
}

/* ═══ SWITCH TYPE ═══ */
function switchType(type) {
  currentType = type;
  currentVariation = 0;
  renderTabs();
  renderContent();
  updateNav();
}

/* ═══ RENDER CONTENT ═══ */
function renderContent() {
  const container = document.getElementById('contentArea');
  const typeData = skeletonData[currentType];
  const variation = typeData.skeletons[currentVariation];
  
  // Update content title
  document.getElementById('contentTitle').textContent = 
    viewMode === 'skeleton' ? `${typeData.label} — ${variation.name}` : typeData.label;
  
  if (viewMode === 'skeleton') {
    container.innerHTML = renderSkeleton(variation);
  } else {
    container.innerHTML = renderPhrases(currentType);
  }
}

/* ═══ RENDER SKELETON ===*/
function renderSkeleton(variation) {
  let html = '<div class="skeleton-display">';
  
  variation.skeleton.forEach((para, index) => {
    html += '<div class="paragraph-block">';
    
    let colorClass = '';
    const titleLower = para.title.toLowerCase();
    if (titleLower.includes('intro') || titleLower.includes('opening') || titleLower.includes('hook')) {
      colorClass = 'intro';
    } else if (titleLower.includes('conclu') || titleLower.includes('closing') || titleLower.includes('final')) {
      colorClass = 'conclusion';
    } else {
      colorClass = 'body';
    }
    
    html += `<div class="paragraph-title ${colorClass}">${para.emoji || ''} ${para.title}</div>`;
    
    // Add listing prefix for body paragraphs
    const prefix = getListingPrefix(index, variation.skeleton.length);
    if (prefix) {
      html += `<div class="listing-prefix">${prefix}</div>`;
    }
    
    para.lines.forEach(line => {
      html += `<div class="paragraph-text">${line || '&nbsp;'}</div>`;
    });
    
    if (index < variation.skeleton.length - 1) {
      html += '</div><div class="divider"></div>';
    } else {
      html += '</div>';
    }
  });
  
  html += '</div>';
  return html;
}

/* ═══ RENDER PHRASES ═══ */
function renderPhrases(essayType) {
  if (!phraseData[essayType] || !phraseData[essayType].categories) {
    return '<div class="phrases-display" style="padding: 2rem; text-align: center; color: rgba(0,0,0,0.4);">No phrase bank available for this essay type.</div>';
  }
  
  const categories = phraseData[essayType].categories;
  let html = '<div class="phrases-display">';
  
  categories.forEach(category => {
    html += '<div class="phrase-category">';
    
    let colorClass = '';
    const titleLower = category.title.toLowerCase();
    if (titleLower.includes('intro') || titleLower.includes('opening') || titleLower.includes('hook')) {
      colorClass = 'intro';
    } else if (titleLower.includes('conclu') || titleLower.includes('closing') || titleLower.includes('final')) {
      colorClass = 'conclusion';
    } else {
      colorClass = 'body';
    }
    
    html += `<div class="category-title ${colorClass}">${category.title}</div>`;
    
    category.subcategories.forEach(sub => {
      html += '<div class="subcategory">';
      html += `<div class="subcategory-title">${sub.subtitle}</div>`;
      html += '<ul class="phrase-list">';
      
      sub.phrases.forEach(phrase => {
        html += `<li class="phrase-item">${phrase}</li>`;
      });
      
      html += '</ul></div>';
    });
    
    html += '</div>';
  });
  
  html += '</div>';
  return html;
}

/* ═══ SET VIEW MODE ═══ */
function setViewMode(mode) {
  viewMode = mode;
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === mode);
  });
  renderContent();
  updateNav();
}

/* ═══ NAVIGATION ═══ */
function navigate(direction) {
  if (viewMode === 'skeleton') {
    const typeData = skeletonData[currentType];
    currentVariation += direction;
    currentVariation = Math.max(0, Math.min(currentVariation, typeData.skeletons.length - 1));
  } else {
    const types = Object.keys(skeletonData).filter(key => key !== 'meta');
    const currentIndex = types.indexOf(currentType);
    const newIndex = currentIndex + direction;
    if (newIndex >= 0 && newIndex < types.length) {
      switchType(types[newIndex]);
      return;
    }
  }
  
  renderContent();
  updateNav();
}

function updateNav() {
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const pageCounter = document.getElementById('pageCounter');
  
  if (viewMode === 'skeleton') {
    const typeData = skeletonData[currentType];
    btnPrev.disabled = currentVariation === 0;
    btnNext.disabled = currentVariation === typeData.skeletons.length - 1;
    pageCounter.textContent = `${currentVariation + 1} / ${typeData.skeletons.length}`;
  } else {
    const types = Object.keys(skeletonData).filter(key => key !== 'meta');
    const currentIndex = types.indexOf(currentType);
    btnPrev.disabled = currentIndex === 0;
    btnNext.disabled = currentIndex === types.length - 1;
    pageCounter.textContent = `${currentIndex + 1} / ${types.length}`;
  }
}

/* ═══ MODE SWITCHING ═══ */
function switchMode(mode){
  document.querySelectorAll('.nb').forEach(btn => {
    btn.classList.toggle('on', btn.dataset.mode === mode);
  });
  
  switch(mode){
    case 'question':
      window.location.href = 'essay-question-selector.html';
      break;
    case 'plan':
      window.location.href = 'essay-plan.html';
      break;
    case 'model':
      // Current page
      break;
    case 'build':
      window.location.href = 'essay-builder-interactive.html';
      break;
    case 'sample':
      window.location.href = 'essay-master.html';
      break;
  }
}

/* ═══ KEYBOARD NAV ═══ */
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') navigate(-1);
  if (e.key === 'ArrowRight') navigate(1);
});

/* ═══ START ═══ */
init();
</script>
</body>
</html>
