<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Sample Essay â€” INTUITY</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
<style>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS â€” identical to hub
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:        #0c0c0c;
  --gold:      #C9A961;
  --gold-d:    #9B7D3A;
  --gold-l:    #E8D4A0;
  --white:     #FAFAF8;
  --cream:     #F4EFE6;
  --cream-d:   #EAE2D4;
  --ink:       #0d0d0d;
  --marker:    #2563EB;
  --marker-bg: rgba(37,99,235,0.10);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after {
  margin: 0; padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}
html, body {
  width: 100%; height: 100%;
  overflow: hidden; position: fixed;
  background: var(--bg);
  font-family: 'Inter', sans-serif;
  color: #fff;
  -webkit-font-smoothing: antialiased;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHELL + CARD â€” identical to hub
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.shell {
  position: fixed; inset: 0;
  display: flex; align-items: center; justify-content: center;
  padding: 2vh 3vw;
}
.card {
  width: 100%; height: 100%;
  max-width: 900px; max-height: 95vh;
  background: var(--white);
  border-radius: 1.5rem;
  box-shadow:
    0 0 0 1px rgba(201,169,97,0.15),
    0 24px 80px rgba(0,0,0,0.65),
    0 4px 16px rgba(0,0,0,0.4);
  display: flex; flex-direction: column;
  overflow: hidden; position: relative;
}
.card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--gold-d), var(--gold-l), var(--gold-d));
  z-index: 5;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER â€” identical to hub
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card-brand {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: space-between;
  padding: 1rem 1.5rem 0.75rem;
  margin-top: 3px;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  position: relative;
  z-index: 10;
}
.home-link {
  text-decoration: none;
  font-size: 1rem; font-weight: 600; color: var(--gold);
  transition: all 0.2s;
  padding: 0.4rem 0.6rem; border-radius: 0.5rem;
  display: flex; align-items: center; gap: 0.3rem;
}
.home-link:hover  { background: rgba(201,169,97,0.1); color: var(--gold-d); }
.home-link:active { transform: scale(0.95); }
.brand-word {
  position: absolute; left: 50%; transform: translateX(-50%);
  font-size: 0.65rem; font-weight: 800;
  letter-spacing: 0.22em; text-transform: uppercase;
  color: rgba(0,0,0,0.18); pointer-events: none;
}
.menu-btn {
  background: #000; border: 1px solid rgba(0,0,0,0.12);
  width: 32px; height: 32px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all 0.2s; flex-shrink: 0;
}
.menu-btn:hover  { background: rgba(0,0,0,0.85); }
.menu-btn:active { transform: scale(0.95); }
.menu-dots { display: flex; gap: 4px; }
.menu-dots span { width: 4px; height: 4px; border-radius: 50%; background: #fff; }

.menu-dropdown {
  position: absolute; top: calc(100% + 0.5rem); right: 1rem;
  background: #fff; border-radius: 0.75rem;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.12);
  min-width: 200px; padding: 0.5rem;
  z-index: 200; display: none;
}
.menu-dropdown.open { display: block; animation: menuSlide 0.2s ease-out; }
@keyframes menuSlide {
  from { opacity: 0; transform: translateY(-8px); }
  to   { opacity: 1; transform: translateY(0); }
}
.menu-section-label {
  padding: 0.4rem 0.85rem 0.2rem;
  font-size: 0.65rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.1em;
  color: rgba(0,0,0,0.3);
}
.menu-item {
  padding: 0.65rem 0.85rem; border-radius: 0.5rem;
  font-size: 0.8rem; font-weight: 500; color: rgba(0,0,0,0.7);
  cursor: pointer; transition: all 0.15s;
  display: flex; align-items: center; justify-content: space-between; gap: 0.5rem;
}
.menu-item:hover  { background: rgba(0,0,0,0.04); color: rgba(0,0,0,0.9); }
.menu-item.active { background: var(--gold); color: #fff; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STYLE SELECTOR ROW â€” always visible
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.style-row {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  gap: 0.375rem;
  padding: 0.625rem 1.5rem;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  background: var(--white);
}
.style-btn {
  background: transparent;
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 2rem;
  padding: 0.35rem 1rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.7rem; font-weight: 700;
  color: rgba(0,0,0,0.38);
  cursor: pointer;
  transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
  min-height: 32px; white-space: nowrap;
}
.style-btn:hover  { border-color: rgba(0,0,0,0.25); color: rgba(0,0,0,0.65); }
.style-btn:active { transform: scale(0.96); }
.style-btn.active { background: var(--ink); border-color: var(--ink); color: var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARAGRAPH STAGE DOTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stage-dots-row {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  gap: 1.5rem;
  padding: 0.75rem 1.5rem 0.625rem;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
.stage-dots-row.hidden { display: none; }
.stage-dot-wrapper {
  display: flex; flex-direction: column; align-items: center; gap: 0.35rem;
  cursor: pointer; transition: all 0.2s;
  padding: 0.25rem 0.5rem; border-radius: 0.5rem;
}
.stage-dot-wrapper:hover { background: rgba(0,0,0,0.04); }
.stage-dot {
  width: 10px; height: 10px; border-radius: 50%;
  background: rgba(0,0,0,0.15);
  transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
}
.stage-dot-label {
  font-size: 0.575rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.06em;
  color: rgba(0,0,0,0.3); transition: color 0.2s;
}
.stage-dot-wrapper.current .stage-dot {
  background: var(--gold);
  box-shadow: 0 0 0 3px rgba(201,169,97,0.2);
  transform: scale(1.25);
}
.stage-dot-wrapper.current .stage-dot-label { color: var(--gold-d); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOL ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tool-row {
  flex-shrink: 0;
  display: flex; align-items: center; gap: 0.5rem;
  padding: 0.5rem 1.5rem;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
.tool-btn {
  background: transparent;
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 2rem;
  padding: 0.3rem 0.875rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.68rem; font-weight: 700;
  color: rgba(0,0,0,0.45);
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4,0,0.2,1);
  display: flex; align-items: center; gap: 0.35rem;
  min-height: 32px; white-space: nowrap;
}
.tool-btn:hover  { border-color: rgba(0,0,0,0.25); color: rgba(0,0,0,0.7); }
.tool-btn.active { background: var(--ink); border-color: var(--ink); color: var(--gold); }
.tool-btn:active { transform: scale(0.96); }
.tool-spacer { flex: 1; }
.phrase-badge {
  font-size: 0.6rem; font-weight: 700;
  background: var(--marker-bg); color: var(--marker);
  padding: 0.1rem 0.4rem; border-radius: 1rem;
  display: none;
}
.phrase-badge.on { display: inline; }

/* View Mode Toggle Switch */
.view-switch {
  display: flex;
  background: rgba(0,0,0,0.06);
  border: 1.5px solid rgba(0,0,0,0.12);
  border-radius: 2rem;
  padding: 0.25rem;
  gap: 0.25rem;
}
.switch-option {
  padding: 0.3rem 0.875rem;
  border-radius: 1.5rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.68rem;
  font-weight: 700;
  color: rgba(0,0,0,0.45);
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
  white-space: nowrap;
  min-height: 32px;
  display: flex;
  align-items: center;
  user-select: none;
}
.switch-option:hover:not(.active) {
  color: rgba(0,0,0,0.65);
  background: rgba(0,0,0,0.04);
}
.switch-option.active {
  background: var(--ink);
  color: var(--gold);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.switch-option:active {
  transform: scale(0.96);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTENT AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.infographic {
  flex: 1;
  padding: 2rem 3rem 1.5rem;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  min-height: 0;
}
.infographic::-webkit-scrollbar { width: 4px; }
.infographic::-webkit-scrollbar-track { background: transparent; }
.infographic::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 2px; }

.para-label {
  font-size: 0.6rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.12em;
  color: rgba(0,0,0,0.28); margin-bottom: 1rem;
}
.para-label.hidden { display: none; }
.para-text {
  font-family: 'DM Sans', sans-serif;
  font-size: 1.05rem; line-height: 1.85;
  color: rgba(0,0,0,0.82); font-weight: 400;
  margin-bottom: 2rem;
}
.para-text:last-child { margin-bottom: 0; }

/* X-Ray: discourse markers go blue */
.xray-on .dm {
  color: var(--marker); font-weight: 600;
  background: var(--marker-bg);
  padding: 0.05em 0.2em; border-radius: 3px;
}

/* Phrase Explorer: matched phrases underlined blue */
.phrase-enhanced { position: relative; display: inline; }
.phrase-text {
  color: var(--marker); font-weight: 600;
  border-bottom: 1.5px solid rgba(37,99,235,0.4);
  cursor: pointer; padding: 0.05em 0;
  transition: background 0.15s;
}
.phrase-text:hover { background: var(--marker-bg); border-radius: 2px; }
.phrase-hint-btn {
  background: rgba(37,99,235,0.1); border: none; border-radius: 50%;
  width: 18px; height: 18px; font-size: 0.6rem;
  cursor: pointer; vertical-align: middle; margin-left: 2px;
  display: inline-flex; align-items: center; justify-content: center;
  transition: background 0.15s;
}
.phrase-hint-btn:hover { background: rgba(37,99,235,0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARAGRAPH NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.para-nav {
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.75rem 1.5rem;
  border-top: 1px solid rgba(0,0,0,0.06);
  gap: 1rem;
}
.para-nav.hidden { display: none; }
.para-arrow {
  background: transparent;
  border: 2px solid rgba(0,0,0,0.15);
  width: 44px; height: 44px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.25rem; color: rgba(0,0,0,0.55);
  cursor: pointer; transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
}
.para-arrow:hover:not(:disabled) { background: var(--gold); border-color: var(--gold); color: #fff; }
.para-arrow:active:not(:disabled) { transform: scale(0.95); }
.para-arrow:disabled { opacity: 0.22; cursor: not-allowed; }
.para-nav-label {
  font-size: 0.8rem; font-weight: 700;
  color: rgba(0,0,0,0.35); text-align: center; user-select: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER PILLS â€” identical to hub
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card-nav {
  flex-shrink: 0;
  display: flex; justify-content: center;
  padding: 0.75rem 1.125rem calc(env(safe-area-inset-bottom,0px) + 0.875rem);
  border-top: 1px solid rgba(0,0,0,0.06);
}
.nav-pill {
  display: flex; gap: 0.15rem;
  background: rgba(10,10,10,0.06);
  border-radius: 2rem; padding: 0.35rem 0.4rem;
}
.nb {
  background: transparent; border: none;
  padding: 0.5rem 1rem; border-radius: 1.5rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.7rem; letter-spacing: 0.02em;
  color: rgba(0,0,0,0.28);
  cursor: pointer; transition: all 0.24s cubic-bezier(0.4,0,0.2,1);
  white-space: nowrap; min-height: 36px; font-weight: 500;
}
.nb.on { background: var(--ink); color: var(--gold); font-weight: 700; }
.nb:hover:not(.on) { color: rgba(0,0,0,0.5); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALTERNATIVES MODAL (bottom sheet)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.alt-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(8px);
  z-index: 500;
  display: none; align-items: flex-end; justify-content: center;
  padding: 1rem;
}
.alt-overlay.open { display: flex; animation: overlayFade 0.2s ease; }
@keyframes overlayFade { from { opacity: 0; } to { opacity: 1; } }

.alt-modal {
  background: var(--white);
  border-radius: 1.25rem 1.25rem 1rem 1rem;
  width: 100%; max-width: 520px; max-height: 65vh;
  overflow: hidden; display: flex; flex-direction: column;
  animation: modalUp 0.3s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 -4px 40px rgba(0,0,0,0.25);
}
@keyframes modalUp {
  from { transform: translateY(40px); opacity: 0; }
  to   { transform: translateY(0);    opacity: 1; }
}
.alt-header {
  padding: 1.125rem 1.25rem 0.875rem;
  border-bottom: 1px solid rgba(0,0,0,0.07);
  display: flex; align-items: flex-start; justify-content: space-between;
  flex-shrink: 0;
}
.alt-title  { font-size: 0.95rem; font-weight: 700; color: var(--ink); }
.alt-phrase { font-size: 0.8rem; color: var(--marker); font-weight: 600; margin-top: 0.2rem; }
.alt-close {
  background: rgba(0,0,0,0.06); border: none;
  width: 30px; height: 30px; border-radius: 50%;
  font-size: 1.1rem; color: rgba(0,0,0,0.45);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; transition: background 0.15s;
}
.alt-close:hover { background: rgba(0,0,0,0.1); }
.alt-body { overflow-y: auto; padding: 0.75rem; flex: 1; }
.alt-category {
  font-size: 0.6rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.1em;
  color: rgba(0,0,0,0.3); padding: 0.5rem 0.5rem 0.625rem;
}
.alt-item {
  padding: 0.7rem 0.875rem; border-radius: 0.625rem;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.9rem; font-weight: 500; color: rgba(0,0,0,0.75);
  cursor: pointer; transition: all 0.15s;
  display: flex; align-items: center; justify-content: space-between; gap: 0.5rem;
}
.alt-item:hover  { background: rgba(37,99,235,0.06); color: var(--marker); }
.alt-item:active { transform: scale(0.98); }
.alt-copy-hint {
  font-size: 0.6rem; font-weight: 700;
  color: rgba(0,0,0,0.22); text-transform: uppercase; flex-shrink: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position: fixed; bottom: 5rem; left: 50%; transform: translateX(-50%);
  background: var(--ink); color: var(--gold);
  padding: 0.5rem 1.25rem; border-radius: 2rem;
  font-size: 0.75rem; font-weight: 700;
  opacity: 0; pointer-events: none;
  transition: opacity 0.25s; z-index: 600; white-space: nowrap;
}
.toast.show { opacity: 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING / ERROR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.state-msg {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  height: 100%; gap: 0.75rem;
  font-size: 0.9rem; color: rgba(0,0,0,0.3);
  text-align: center; line-height: 1.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  .shell { padding: 1vh 2vw; }
  .card  { border-radius: 1rem; }
  .card-brand { padding: 0.75rem 1rem 0.5rem; }
  .brand-word { font-size: 0.55rem; }
  .home-link  { font-size: 0.9rem; padding: 0.3rem 0.5rem; }
  .stage-dots-row { gap: 1rem; padding: 0.625rem 1rem 0.5rem; }
  .stage-dot-label { font-size: 0.525rem; }
  .tool-row { padding: 0.4rem 1rem; gap: 0.375rem; }
  .tool-btn { padding: 0.275rem 0.7rem; font-size: 0.625rem; min-height: 28px; }
  .view-switch { padding: 0.2rem; gap: 0.2rem; }
  .switch-option { padding: 0.25rem 0.7rem; font-size: 0.6rem; min-height: 28px; }
  .infographic { padding: 1.25rem; }
  .para-text { font-size: 0.95rem; line-height: 1.8; }
  .para-nav { padding: 0.625rem 1rem; }
  .para-arrow { width: 40px; height: 40px; font-size: 1.1rem; }
  .nb { padding: 0.4rem 0.75rem; font-size: 0.65rem; min-height: 32px; }
}
@media (max-width: 400px) {
  .shell { padding: 0.5vh 1vw; }
  .card  { border-radius: 0.75rem; }
  .infographic { padding: 1rem; }
  .para-text { font-size: 0.9rem; }
  .nb { padding: 0.35rem 0.65rem; font-size: 0.6rem; }
}
@media (min-width: 1400px) {
  .card { max-width: 1200px; }
  .infographic { padding: 2.5rem 4rem 2rem; }
  .para-text { font-size: 1.2rem; line-height: 1.9; }
  .stage-dot { width: 12px; height: 12px; }
  .stage-dot-label { font-size: 0.65rem; }
  .tool-btn { font-size: 0.8rem; padding: 0.4rem 1.1rem; min-height: 38px; }
  .switch-option { padding: 0.35rem 1rem; font-size: 0.75rem; min-height: 38px; }
  .para-arrow { width: 52px; height: 52px; font-size: 1.4rem; }
  .nb { font-size: 0.8rem; padding: 0.6rem 1.25rem; min-height: 42px; }
}

</style>
</head>
<body>

<div class="shell">
<div class="card">

  <!-- HEADER -->
  <div class="card-brand">
    <a href="essay-question-selector.html" class="home-link">â† Questions</a>
    <span class="brand-word">INTUITY</span>
    <div style="flex:1"></div>
    <div class="menu-btn" id="menuBtn" onclick="toggleMenu()">
      <div class="menu-dots"><span></span><span></span><span></span></div>
    </div>
    <div class="menu-dropdown" id="menuDropdown">
      <div class="menu-section-label">Options</div>
      <div class="menu-item" onclick="copyAllParagraphs()">ğŸ“‹ Copy full essay<span></span></div>
    </div>
  </div>

  <!-- STYLE SELECTOR â€” always visible -->
  <div class="style-row">
    <button class="style-btn active" id="styleDefault"  onclick="selectStyle('default')">Default</button>
    <button class="style-btn"        id="styleAlt1"     onclick="selectStyle('alternative1')">Alternative 1</button>
    <button class="style-btn"        id="styleAlt2"     onclick="selectStyle('alternative2')">Alternative 2</button>
  </div>

  <!-- STAGE DOTS -->
  <div class="stage-dots-row hidden" id="stageDots"></div>

  <!-- TOOL ROW -->
  <div class="tool-row">
    <button class="tool-btn" id="xrayBtn"   onclick="toggleXRay()">X-Ray</button>
    <button class="tool-btn" id="phraseBtn" onclick="togglePhrases()">
      Phrases <span class="phrase-badge" id="phraseBadge"></span>
    </button>
    <div class="tool-spacer"></div>
    <!-- Toggle Switch -->
    <div class="view-switch">
      <div class="switch-option active" id="switchFullText" onclick="setViewMode(true)">
        <span>Full Text</span>
      </div>
      <div class="switch-option" id="switchParagraphs" onclick="setViewMode(false)">
        <span>Paragraphs</span>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="infographic" id="infographic">
    <div class="state-msg">Loading sampleâ€¦</div>
  </div>

  <!-- PARAGRAPH NAVIGATION -->
  <div class="para-nav hidden" id="paraNav">
    <button class="para-arrow" id="btnPrev" onclick="goPrev()" disabled>â†</button>
    <div class="para-nav-label" id="paraLabel">Introduction</div>
    <button class="para-arrow" id="btnNext" onclick="goNext()">â†’</button>
  </div>

  <!-- FOOTER PILLS -->
  <div class="card-nav">
    <div class="nav-pill">
      <button class="nb"    data-dest="question" onclick="navTo('question')">question</button>
      <button class="nb"    data-dest="plan"     onclick="navTo('plan')">plan</button>
      <button class="nb"    data-dest="model"    onclick="navTo('model')">model</button>
      <button class="nb"    data-dest="build"    onclick="navTo('build')">build</button>
      <button class="nb on" data-dest="sample"   onclick="navTo('sample')">sample</button>
    </div>
  </div>

</div>
</div>

<!-- ALTERNATIVES MODAL -->
<div class="alt-overlay" id="altOverlay" onclick="closeAlt(event)">
  <div class="alt-modal" onclick="event.stopPropagation()">
    <div class="alt-header">
      <div>
        <div class="alt-title">Alternative Expressions</div>
        <div class="alt-phrase" id="altPhrase"></div>
      </div>
      <button class="alt-close" onclick="closeAlt()">Ã—</button>
    </div>
    <div class="alt-body" id="altBody"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let question     = null;
let paragraphs   = [];      // raw HTML strings, one per paragraph
let currentPara  = 0;
let currentStyle = 'default';
let xrayOn       = false;
let phrasesOn    = false;
let fullTextMode = true;    // DEFAULT: Start in Full Text mode
let phraseDB     = {};
let phraseReady  = false;
let sampleData   = null;

const PARA_LABELS = ['Introduction', 'Body 1', 'Body 2', 'Body 3', 'Conclusion'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISCOURSE MARKERS â€” X-Ray
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DM = [
  'To begin with','First of all','Firstly','Secondly','Thirdly',
  'In addition','Moreover','Furthermore','What is more','Besides','Additionally',
  'On the other hand','However','Nevertheless','Nonetheless',
  'In contrast','By contrast','Conversely','Whereas','Although','Though',
  'Despite','In spite of',
  'Therefore','Thus','Hence','Consequently',
  'As a result','As a consequence','For this reason',
  'Due to','Because of','Owing to',
  'For example','For instance','Such as','Namely',
  'In particular','Specifically','To illustrate',
  'All things considered','In conclusion','To conclude',
  'To sum up','In summary','Overall','All in all','On the whole',
  'Finally','Lastly',
  'In my opinion','In my view','I believe','Personally',
  'Clearly','Undoubtedly','Certainly','Indeed',
  'Meanwhile','Subsequently','Eventually','Ultimately'
].sort((a,b) => b.length - a.length);

function wrapDM(html) {
  let out = html;
  DM.forEach(dm => {
    const esc = dm.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    const re  = new RegExp(`(?<![a-zA-Z])(${esc})(?![a-zA-Z])`, 'g');
    out = out.replace(re, `<span class="dm">$1</span>`);
  });
  return out;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHRASE DATABASE â€” from JSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildPhraseDB(json) {
  phraseDB = {};
  const addEntry = (category, items) => {
    if (!Array.isArray(items)) return;
    items.forEach(item => {
      const raw = (typeof item === 'string') ? item : (item.phrase || item.text || '');
      const phrase = raw.replace(/[.,;:!?]+$/, '').trim();
      if (!phrase || phrase.split(/\s+/).length < 2) return;
      if (!phraseDB[phrase]) phraseDB[phrase] = { category, alternatives: [] };
      items.forEach(sib => {
        const s = ((typeof sib === 'string') ? sib : (sib.phrase || sib.text || ''))
                  .replace(/[.,;:!?]+$/, '').trim();
        if (s && s !== phrase && !phraseDB[phrase].alternatives.includes(s))
          phraseDB[phrase].alternatives.push(s);
      });
    });
  };

  if (Array.isArray(json)) {
    json.forEach(entry => addEntry(entry.category || 'Phrases', entry.phrases || entry.items || []));
  } else {
    Object.entries(json).forEach(([cat, val]) =>
      addEntry(cat, Array.isArray(val) ? val : (val.phrases || val.items || [])));
  }
  phraseReady = Object.keys(phraseDB).length > 0;
}

function enhancePhrases(html) {
  if (!phraseReady) return { html, count: 0 };
  let out = html, count = 0;
  const seen = new Set();
  Object.keys(phraseDB)
    .filter(p => phraseDB[p].alternatives.length > 0)
    .sort((a,b) => b.length - a.length)
    .forEach(phrase => {
      const esc = phrase.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
      const re  = new RegExp(`(?<![a-zA-Z<"'])(${esc})(?![a-zA-Z<"'])`, 'gi');
      out = out.replace(re, match => {
        const k = match.toLowerCase();
        if (seen.has(k)) return match;
        seen.add(k); count++;
        const safe = phrase.replace(/'/g,"\\'").replace(/"/g,'\\"');
        return `<span class="phrase-enhanced"><span class="phrase-text" onclick="showAlts('${safe}')">${match}</span><button class="phrase-hint-btn" onclick="event.stopPropagation();showAlts('${safe}')">ğŸ’¡</button></span>`;
      });
    });
  return { html: out, count };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXTRACT PARAGRAPHS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function extractParagraphs(html) {
  const div = document.createElement('div');
  div.innerHTML = html;
  const ps = div.querySelectorAll('p');
  if (ps.length) return Array.from(ps).map(p => p.innerHTML.trim()).filter(Boolean);
  return html.split(/\n\n+/).map(s => s.trim()).filter(Boolean);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW MODE TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setViewMode(isFullText) {
  fullTextMode = isFullText;
  
  // Update switch UI
  document.getElementById('switchFullText').classList.toggle('active', isFullText);
  document.getElementById('switchParagraphs').classList.toggle('active', !isFullText);
  
  // Show/hide navigation elements
  document.getElementById('stageDots').classList.toggle('hidden', isFullText);
  document.getElementById('paraNav').classList.toggle('hidden', isFullText);
  
  render();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const box = document.getElementById('infographic');
  if (!paragraphs.length) {
    box.innerHTML = `<div class="state-msg">No sample essay found for this question yet.</div>`;
    return;
  }

  let html = '';
  let totalPhraseCount = 0;

  if (fullTextMode) {
    // FULL TEXT MODE: Show all paragraphs
    html = paragraphs.map((para, idx) => {
      let paraHtml = para;
      
      // Apply phrase highlighting
      if (phrasesOn) {
        const r = enhancePhrases(paraHtml);
        paraHtml = r.html;
        totalPhraseCount += r.count;
      }
      
      // Apply X-Ray
      if (xrayOn) paraHtml = wrapDM(paraHtml);
      
      return `<div class="para-text ${xrayOn ? 'xray-on' : ''}">${paraHtml}</div>`;
    }).join('');
    
    box.innerHTML = html;
    
  } else {
    // PARAGRAPH MODE: Show single paragraph
    html = paragraphs[currentPara] || '';

    // Apply phrase highlighting
    if (phrasesOn) {
      const r = enhancePhrases(html);
      html = r.html;
      totalPhraseCount = r.count;
    }

    // Apply X-Ray
    if (xrayOn) html = wrapDM(html);

    const label = PARA_LABELS[currentPara] || `Paragraph ${currentPara + 1}`;

    box.innerHTML = `
      <div class="para-label">${label}</div>
      <div class="para-text ${xrayOn ? 'xray-on' : ''}">${html}</div>`;
  }

  // Badge
  const badge = document.getElementById('phraseBadge');
  if (phrasesOn && totalPhraseCount > 0) {
    badge.textContent = totalPhraseCount;
    badge.classList.add('on');
  } else {
    badge.classList.remove('on');
  }

  if (!fullTextMode) updateNav();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STAGE_SHORT = ['Intro','Body 1','Body 2','Body 3','Concl.'];

function buildDots(count) {
  document.getElementById('stageDots').innerHTML =
    Array.from({length: count}, (_,i) =>
      `<div class="stage-dot-wrapper${i===0?' current':''}" onclick="goTo(${i})">
         <div class="stage-dot"></div>
         <span class="stage-dot-label">${STAGE_SHORT[i] || 'P'+(i+1)}</span>
       </div>`).join('');
}

function updateNav() {
  document.getElementById('btnPrev').disabled = currentPara === 0;
  document.getElementById('btnNext').disabled = currentPara >= paragraphs.length - 1;
  document.getElementById('paraLabel').textContent = PARA_LABELS[currentPara] || `Paragraph ${currentPara+1}`;
  document.querySelectorAll('.stage-dot-wrapper').forEach((el,i) =>
    el.classList.toggle('current', i === currentPara));
}

function goPrev() { if (currentPara > 0) { currentPara--; render(); } }
function goNext() { if (currentPara < paragraphs.length-1) { currentPara++; render(); } }
function goTo(i)  { if (i >= 0 && i < paragraphs.length) { currentPara = i; render(); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOL BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleXRay() {
  xrayOn = !xrayOn;
  document.getElementById('xrayBtn').classList.toggle('active', xrayOn);
  render();
}

function togglePhrases() {
  if (!phraseReady) { showToast('Phrase bank not loaded'); return; }
  phrasesOn = !phrasesOn;
  document.getElementById('phraseBtn').classList.toggle('active', phrasesOn);
  render();
}

function copyAllParagraphs() {
  const full = paragraphs.map(p => {
    const div = document.createElement('div');
    div.innerHTML = p;
    return (div.textContent || '').trim();
  }).join('\n\n');
  navigator.clipboard.writeText(full)
    .then(() => { showToast('Full essay copied âœ“'); closeMenu(); })
    .catch(() => showToast('Copy failed'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STYLE SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selectStyle(style) {
  currentStyle = style;
  document.getElementById('styleDefault').classList.toggle('active', style === 'default');
  document.getElementById('styleAlt1').classList.toggle('active',    style === 'alternative1');
  document.getElementById('styleAlt2').classList.toggle('active',    style === 'alternative2');

  if (sampleData) {
    const html = sampleData.styles?.[style]
              || sampleData.styles?.default
              || sampleData.html || '';
    paragraphs = extractParagraphs(html);
    currentPara = 0;
    buildDots(paragraphs.length);
    render();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALTERNATIVES MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showAlts(phrase) {
  const key = Object.keys(phraseDB).find(k => k.toLowerCase() === phrase.toLowerCase()) || phrase;
  const data = phraseDB[key];
  if (!data || !data.alternatives.length) { showToast('No alternatives found'); return; }

  document.getElementById('altPhrase').textContent = `"${phrase}"`;
  document.getElementById('altBody').innerHTML =
    `<div class="alt-category">${data.category} â€” ${data.alternatives.length} alternatives</div>` +
    data.alternatives.map(alt => {
      const safe = alt.replace(/'/g,"\\'").replace(/"/g,'\\"');
      return `<div class="alt-item" onclick="copyAlt('${safe}')"><span>${alt}</span><span class="alt-copy-hint">tap to copy</span></div>`;
    }).join('');

  document.getElementById('altOverlay').classList.add('open');
}

function copyAlt(text) {
  navigator.clipboard.writeText(text)
    .then(() => { showToast('Copied: ' + text); closeAlt(); })
    .catch(() => showToast('Copy failed'));
}

function closeAlt(e) {
  if (e && e.target.id !== 'altOverlay') return;
  document.getElementById('altOverlay').classList.remove('open');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleMenu() { document.getElementById('menuDropdown').classList.toggle('open'); }
function closeMenu()  { document.getElementById('menuDropdown').classList.remove('open'); }
document.addEventListener('click', e => {
  if (!document.getElementById('menuDropdown').contains(e.target) &&
      !document.getElementById('menuBtn').contains(e.target)) closeMenu();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _tt;
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(_tt); _tt = setTimeout(() => el.classList.remove('show'), 2200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD + SWIPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('keydown', e => {
  if (fullTextMode) return; // Disable in full text mode
  if (e.key === 'ArrowRight') goNext();
  if (e.key === 'ArrowLeft')  goPrev();
  if (e.key === 'Escape')     closeAlt();
});
let _tx = 0;
if ('ontouchstart' in window) {
  document.addEventListener('touchstart', e => { _tx = e.changedTouches[0].screenX; });
  document.addEventListener('touchend',   e => {
    if (fullTextMode) return; // Disable in full text mode
    const dx = e.changedTouches[0].screenX - _tx;
    if (dx < -50) goNext();
    if (dx >  50) goPrev();
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function navTo(dest) {
  if (dest === 'sample') return;
  if (question) sessionStorage.setItem('currentQuestion', JSON.stringify(question));
  const map = {
    question: 'essay-question-selector.html',
    plan:     'essay-plan.html',
    model:    'essay-builder.html',
    build:    'essay-builder-interactive.html'
  };
  if (map[dest]) window.location.href = map[dest];
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function init() {
  try { question = JSON.parse(sessionStorage.getItem('currentQuestion')); } catch(e) {}
  if (!question) {
    document.getElementById('infographic').innerHTML =
      `<div class="state-msg">No question selected.<br>Return to Questions to choose one.</div>`;
    return;
  }

  // Phrase bank (non-blocking)
  fetch('data/essay-phrases.json')
    .then(r => r.ok ? r.json() : null)
    .then(d => { if (d) buildPhraseDB(d); })
    .catch(() => {});

  // Samples
  try {
    const res  = await fetch('data/samples.json');
    if (!res.ok) throw new Error('samples.json not found');
    const data = await res.json();
    const pool = Array.isArray(data) ? data : (data.opinion || data.samples || data.essays || []);
    const match = pool.find(s => s.id === question.id);

    if (!match) {
      document.getElementById('infographic').innerHTML =
        `<div class="state-msg">No sample essay for this question yet.<br>
         <small style="opacity:0.35;margin-top:0.5rem;display:block;">id: ${question.id}</small></div>`;
      return;
    }

    sampleData = match;
    const html = match.styles?.default || match.html || match.text || '';
    paragraphs = extractParagraphs(html);
    buildDots(paragraphs.length);
    render();

  } catch(err) {
    document.getElementById('infographic').innerHTML =
      `<div class="state-msg">Could not load samples.json<br>
       <small style="opacity:0.35;margin-top:0.5rem;display:block;">${err.message}</small></div>`;
  }
}

init();
</script>
</body>
</html>
