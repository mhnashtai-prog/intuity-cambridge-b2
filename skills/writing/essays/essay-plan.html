<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Plan — INTUITY</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:      #0c0c0c;
  --gold:    #C9A961;
  --gold-d:  #9B7D3A;
  --gold-l:  #E8D4A0;
  --white:   #FAFAF8;
  --ink:     #0d0d0d;
  --soft:    rgba(13,13,13,0.55);
  --settled: rgba(13,13,13,0.82);
  --rule:    rgba(0,0,0,0.07);
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body { width:100%; height:100%; overflow:hidden; position:fixed; background:var(--bg); font-family:'Inter',sans-serif; -webkit-font-smoothing:antialiased; }
.shell { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:2vh 3vw; }
.card { width:100%; height:100%; max-width:900px; max-height:95vh; background:var(--white); border-radius:1.5rem; box-shadow:0 0 0 1px rgba(201,169,97,0.15),0 24px 80px rgba(0,0,0,0.65),0 4px 16px rgba(0,0,0,0.4); display:flex; flex-direction:column; overflow:hidden; position:relative; }
.card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background:linear-gradient(90deg,var(--gold-d),var(--gold-l),var(--gold-d)); z-index:5; }
.card-brand { flex-shrink:0; display:flex; align-items:center; justify-content:space-between; padding:1rem 1.5rem 0.75rem; margin-top:3px; border-bottom:1px solid var(--rule); position:relative; z-index:10; }
.home-link { text-decoration:none; font-size:1rem; font-weight:600; color:var(--gold); padding:0.4rem 0.6rem; border-radius:0.5rem; transition:all 0.2s; }
.home-link:hover { background:rgba(201,169,97,0.1); color:var(--gold-d); }
.home-link:active { transform:scale(0.95); }
.brand-word { position:absolute; left:50%; transform:translateX(-50%); font-size:0.65rem; font-weight:800; letter-spacing:0.22em; text-transform:uppercase; color:rgba(0,0,0,0.18); pointer-events:none; }
.menu-btn { background:#000; border:none; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.2s; }
.menu-btn:hover { background:rgba(0,0,0,0.8); }
.menu-btn:active { transform:scale(0.95); }
.menu-dots { display:flex; gap:4px; }
.menu-dots span { width:4px; height:4px; border-radius:50%; background:#fff; }

/* Question strip */
.q-strip {
  flex-shrink:0;
  padding:0.75rem 1.5rem;
  border-bottom:1px solid var(--rule);
  background:rgba(201,169,97,0.03);
}
.q-text {
  font-family:'DM Sans',sans-serif;
  font-size:0.9rem;
  line-height:1.6;
  color:var(--settled);
  font-style:italic;
  font-weight:400;
}

/* Plan canvas */
.plan-canvas {
  flex:1;
  min-height:0;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  padding:2rem 3rem 2.5rem;
}
.plan-canvas::-webkit-scrollbar { width:4px; }
.plan-canvas::-webkit-scrollbar-track { background:transparent; }
.plan-canvas::-webkit-scrollbar-thumb { background:rgba(0,0,0,0.1); border-radius:2px; }

/* Paragraph block */
.para-plan {
  margin-bottom:1.75rem;
  opacity:0;
  transform:translateY(8px);
  animation:fadeIn 0.4s ease forwards;
}
.para-plan:nth-child(1) { animation-delay:0.05s; }
.para-plan:nth-child(2) { animation-delay:0.12s; }
.para-plan:nth-child(3) { animation-delay:0.19s; }
.para-plan:nth-child(4) { animation-delay:0.26s; }
.para-plan:nth-child(5) { animation-delay:0.33s; }
@keyframes fadeIn { to { opacity:1; transform:translateY(0); } }

/* Paragraph label */
.para-plan-label {
  font-size:0.55rem;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:0.14em;
  color:rgba(0,0,0,0.25);
  margin-bottom:0.5rem;
}

/* Main argument - hero statement */
.main-arg {
  font-family:'DM Sans',sans-serif;
  font-size:1.15rem;
  line-height:1.6;
  color:var(--ink);
  font-weight:600;
  margin-bottom:0.75rem;
}

/* Supporting ideas - clean bullet list */
.support-list {
  list-style:none;
  display:flex;
  flex-direction:column;
  gap:0.4rem;
  margin-left:1.5rem;
}

.support-item {
  display:flex;
  align-items:flex-start;
  gap:0.75rem;
  font-family:'DM Sans',sans-serif;
  font-size:0.9rem;
  line-height:1.6;
  color:var(--settled);
}

.support-item::before {
  content:'•';
  color:var(--gold);
  font-size:1.2rem;
  font-weight:700;
  flex-shrink:0;
  margin-top:-0.15rem;
}

/* Verb chips - inline highlighting */
.verb {
  display:inline;
  color:var(--gold-d);
  font-weight:600;
  font-style:italic;
}

/* Key verbs strip */
.verbs-strip {
  flex-shrink:0;
  padding:0.875rem 1.5rem;
  border-top:1px solid var(--rule);
  background:rgba(201,169,97,0.03);
  display:flex;
  align-items:center;
  gap:0.75rem;
  flex-wrap:wrap;
}
.verbs-label {
  font-size:0.55rem;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:0.14em;
  color:var(--gold-d);
  white-space:nowrap;
}
.verb-pill {
  background:var(--gold);
  color:#fff;
  font-size:0.7rem;
  font-weight:700;
  padding:0.25rem 0.75rem;
  border-radius:2rem;
  opacity:0;
  transform:scale(0.8);
  animation:verbPop 0.3s cubic-bezier(0.34,1.56,0.64,1) forwards;
}
.verb-pill:nth-child(2) { animation-delay:0.4s; }
.verb-pill:nth-child(3) { animation-delay:0.48s; }
.verb-pill:nth-child(4) { animation-delay:0.56s; }
.verb-pill:nth-child(5) { animation-delay:0.64s; }
.verb-pill:nth-child(6) { animation-delay:0.72s; }
@keyframes verbPop { to { opacity:1; transform:scale(1); } }

/* Footer nav */
.card-nav { flex-shrink:0; display:flex; justify-content:center; padding:0.75rem 1.125rem calc(env(safe-area-inset-bottom,0px) + 0.875rem); border-top:1px solid var(--rule); background:var(--white); }
.nav-pill { display:flex; gap:0.15rem; background:rgba(10,10,10,0.06); border-radius:2rem; padding:0.35rem 0.4rem; }
.nb { background:transparent; border:none; padding:0.5rem 1rem; border-radius:1.5rem; font-family:'Inter',sans-serif; font-size:0.7rem; letter-spacing:0.02em; color:rgba(0,0,0,0.28); cursor:pointer; transition:all 0.24s cubic-bezier(0.4,0,0.2,1); white-space:nowrap; min-height:36px; font-weight:500; }
.nb.on { background:var(--ink); color:var(--gold); font-weight:700; }
.nb:hover:not(.on) { color:rgba(0,0,0,0.5); }

/* State message */
.state-msg { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; gap:0.75rem; font-size:0.9rem; color:rgba(0,0,0,0.3); text-align:center; line-height:1.6; padding:2rem; }

/* Mobile */
@media(max-width:768px){ 
  .shell{padding:0} 
  .card{border-radius:0; max-height:100vh} 
  .card-brand{padding:0.625rem 1rem 0.5rem} 
  .brand-word{font-size:0.5rem} 
  .q-strip{padding:0.625rem 1rem} 
  .q-text{font-size:0.75rem; line-height:1.4} 
  .plan-canvas{padding:0.875rem 1rem 0.75rem} 
  .para-plan{margin-bottom:1rem}
  .para-plan-label{font-size:0.5rem; margin-bottom:0.375rem}
  .main-arg{font-size:0.85rem; line-height:1.4; margin-bottom:0.5rem} 
  .support-list{gap:0.25rem; margin-left:1rem}
  .support-item{font-size:0.75rem; line-height:1.4; gap:0.5rem} 
  .support-item::before{font-size:1rem; margin-top:-0.1rem}
  .verbs-strip{padding:0.5rem 1rem; gap:0.5rem}
  .verbs-label{font-size:0.5rem}
  .verb-pill{font-size:0.6rem; padding:0.2rem 0.5rem}
  .nb{padding:0.35rem 0.7rem; font-size:0.6rem; min-height:30px} 
  .card-nav{padding:0.5rem 1rem}
}
@media(max-width:400px){ 
  .plan-canvas{padding:0.75rem 0.875rem 0.625rem} 
  .para-plan{margin-bottom:0.875rem}
  .main-arg{font-size:0.8rem} 
  .support-item{font-size:0.7rem} 
  .nb{padding:0.3rem 0.6rem; font-size:0.55rem} 
}

/* Large screens */
@media(min-width:1400px){ .card{max-width:1200px} .q-text{font-size:1.1rem} .plan-canvas{padding:3rem 5rem 3rem} .main-arg{font-size:1.4rem} .support-item{font-size:1.05rem} .nb{font-size:0.8rem;padding:0.6rem 1.25rem;min-height:42px} }
</style>
</head>
<body>

<div class="shell">
<div class="card">

  <div class="card-brand">
    <a class="home-link" href="essay-question-selector.html">← Questions</a>
    <span class="brand-word">INTUITY</span>
    <div style="flex:1"></div>
    <div class="menu-btn" onclick="toggleMenu()">
      <div class="menu-dots"><span></span><span></span><span></span></div>
    </div>
  </div>

  <div class="q-strip" id="qStrip" style="display:none">
    <div class="q-text" id="qText"></div>
  </div>

  <div class="plan-canvas" id="planCanvas">
    <div class="state-msg">Loading plan…</div>
  </div>

  <div class="verbs-strip" id="verbsStrip" style="display:none">
    <span class="verbs-label">Key verbs</span>
    <div id="verbsPills"></div>
  </div>

  <div class="card-nav">
    <div class="nav-pill">
      <button class="nb"    onclick="navTo('question')">question</button>
      <button class="nb on" onclick="navTo('plan')">plan</button>
      <button class="nb"    onclick="navTo('model')">model</button>
      <button class="nb"    onclick="navTo('build')">build</button>
      <button class="nb"    onclick="navTo('sample')">sample</button>
    </div>
  </div>

</div>
</div>

<script>
// ==================== STATE ====================
let question = null;

// ==================== RENDER PLAN ====================
function renderPlan(essay) {
  const canvas = document.getElementById('planCanvas');
  canvas.innerHTML = '';

  // Question
  if (essay.question) {
    document.getElementById('qText').textContent = essay.question;
    document.getElementById('qStrip').style.display = 'block';
  }

  // Paragraphs
  (essay.skeleton || []).forEach(para => {
    const block = document.createElement('div');
    block.className = 'para-plan';

    // Label
    const label = document.createElement('div');
    label.className = 'para-plan-label';
    label.textContent = para.title || '';
    block.appendChild(label);

    // Main argument (first note)
    if (para.notes && para.notes.length > 0) {
      const mainNote = para.notes[0];
      const mainArg = document.createElement('div');
      mainArg.className = 'main-arg';
      
      // Add verb highlighting if present
      let text = mainNote.text || '';
      if (mainNote.verb) {
        text += ` <span class="verb">${mainNote.verb}</span>`;
      }
      mainArg.innerHTML = text;
      block.appendChild(mainArg);

      // Supporting ideas (rest of notes)
      if (para.notes.length > 1) {
        const list = document.createElement('ul');
        list.className = 'support-list';

        para.notes.slice(1).forEach(note => {
          const item = document.createElement('li');
          item.className = 'support-item';
          
          let supportText = note.text || '';
          if (note.verb) {
            supportText += ` <span class="verb">${note.verb}</span>`;
          }
          
          const textSpan = document.createElement('span');
          textSpan.innerHTML = supportText;
          item.appendChild(textSpan);
          list.appendChild(item);
        });

        block.appendChild(list);
      }
    }

    canvas.appendChild(block);
  });

  // Key verbs
  const verbs = essay.magic_verbs || [];
  if (verbs.length) {
    const pillsContainer = document.getElementById('verbsPills');
    pillsContainer.innerHTML = '';
    verbs.forEach(v => {
      const pill = document.createElement('span');
      pill.className = 'verb-pill';
      pill.textContent = v;
      pillsContainer.appendChild(pill);
    });
    document.getElementById('verbsStrip').style.display = 'flex';
  }
}

// ==================== NAVIGATION ====================
function navTo(dest) {
  if (dest === 'plan') return;
  if (question) sessionStorage.setItem('currentQuestion', JSON.stringify(question));
  const map = {
    question: 'essay-question-selector.html',
    model:    'essay-builder.html',
    build:    'essay-builder-interactive.html',
    sample:   'essay-master.html'
  };
  if (map[dest]) window.location.href = map[dest];
}

function toggleMenu() {
  // Menu functionality can be added here
}

// ==================== INIT ====================
async function init() {
  try {
    question = JSON.parse(sessionStorage.getItem('currentQuestion'));
  } catch(e) { question = null; }

  if (!question) {
    document.getElementById('planCanvas').innerHTML =
      `<div class="state-msg">No question selected.<br>Return to Questions to choose one.</div>`;
    return;
  }

  try {
    const res = await fetch('data/ideas.json');
    if (!res.ok) throw new Error('ideas.json not found');
    const data = await res.json();

    const pool = data.opinion || data.essays || data;
    const essay = Array.isArray(pool)
      ? pool.find(e => e.id === question.id)
      : pool[question.id];

    if (!essay) {
      document.getElementById('planCanvas').innerHTML =
        `<div class="state-msg">No plan for this question yet.<br>
         <small style="opacity:0.35;margin-top:0.5rem;display:block;">id: ${question.id}</small></div>`;
      return;
    }

    renderPlan(essay);

  } catch(err) {
    document.getElementById('planCanvas').innerHTML =
      `<div class="state-msg">Could not load ideas.json<br>
       <small style="opacity:0.35;margin-top:0.5rem;display:block;">${err.message}</small></div>`;
  }
}

init();
</script>
</body>
</html>
