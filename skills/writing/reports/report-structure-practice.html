<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INTUITY - Report Structures Guide</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800;900&family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'DM Sans', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
      color: #e5e5e7;
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(201, 169, 97, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 70% 80%, rgba(201, 169, 97, 0.08) 0%, transparent 45%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 900px;
      margin: 0 auto;
      padding: 0.5rem;
    }

    /* UNIFIED HEADER */
    .global-header {
      background: rgba(28, 28, 30, 0.95);
      backdrop-filter: blur(40px);
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      padding: 0.75rem 1.5rem;
      margin-bottom: 1rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .header-row-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .brand {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }

    .header-brand-logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #C9A961 0%, rgba(255,255,255,0.85) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: -0.04em;
    }

    .header-brand-subtitle {
      font-size: 0.7rem;
      color: #636366;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .home-link {
      color: #8e8e93;
      text-decoration: none;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.4rem 0.75rem;
      border-radius: 0.5rem;
      transition: all 0.3s;
    }

    .home-link:hover {
      color: #C9A961;
      background: rgba(201, 169, 97, 0.1);
    }

    /* MODE TABS */
    .mode-tabs {
      display: flex;
      gap: 0.25rem;
      padding: 0.25rem;
      border-radius: 0.625rem;
    }

    .tab {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.125rem;
      padding: 0.375rem 0.5rem;
      background: transparent;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      color: #8e8e93;
    }

    .tab:hover {
      background: rgba(142, 142, 147, 0.1);
    }

    .tab.active {
      background: rgba(201, 169, 97, 0.15);
      color: #C9A961;
    }

    .tab-icon {
      font-size: 1.125rem;
      line-height: 1;
    }

    .tab-label {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      font-family: 'DM Sans', sans-serif;
    }
    
    /* CENTRAL CARD */
    .unified-box {
      background: rgba(28, 28, 30, 0.6);
      backdrop-filter: blur(40px);
      border-radius: 1.25rem;
      border: 1px solid rgba(84, 84, 88, 0.25);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      margin-bottom: 1.5rem;
      margin-top: 0.5rem;
    }

    /* REPORT TYPE SELECTOR */
    .type-selector-section {
      padding: 0.75rem 1rem;
      background: rgba(0, 0, 0, 0.15);
      border-bottom: 1px solid rgba(84, 84, 88, 0.15);
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .type-selector-section::-webkit-scrollbar {
      display: none;
    }

    .type-btn {
      flex-shrink: 0;
      padding: 0.4rem 0.9rem;
      background: transparent;
      border: none;
      color: #8e8e93;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: capitalize;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'DM Sans', sans-serif;
      white-space: nowrap;
      min-height: 36px;
    }

    .type-btn:hover {
      background: rgba(255, 255, 255, 0.03);
      color: #C9A961;
    }

    .type-btn:active {
      transform: scale(0.98);
    }

    .type-btn.active {
      color: #C9A961;
      font-weight: 600;
      background: transparent;
    }

    /* PARAGRAPH NAVIGATION */
    .paragraph-nav {
      padding: 0.6rem 1rem;
      background: rgba(0, 0, 0, 0.08);
      border-bottom: 1px solid rgba(84, 84, 88, 0.15);
      display: flex;
      gap: 0.4rem;
      overflow-x: auto;
      scrollbar-width: none;
      justify-content: center;
      flex-wrap: wrap;
    }

    .paragraph-nav::-webkit-scrollbar {
      display: none;
    }

    .para-btn {
      flex-shrink: 0;
      padding: 0.35rem 0.75rem;
      background: transparent;
      border: none;
      color: #8e8e93;
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: capitalize;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'DM Sans', sans-serif;
      white-space: nowrap;
      min-height: 32px;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .para-btn:hover {
      background: rgba(255, 255, 255, 0.03);
      color: #C9A961;
    }

    .para-btn:active {
      transform: scale(0.98);
    }

    .para-btn.active {
      color: #C9A961;
      font-weight: 600;
      background: transparent;
    }

    /* VIEW MODE TOGGLE - PROMINENT */
    .view-toggle-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1.25rem 1rem;
      background: rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(84, 84, 88, 0.15);
      gap: 1rem;
    }

    .view-mode-label {
      font-size: 0.7rem;
      color: #636366;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .view-toggle-group {
      display: flex;
      gap: 0.5rem;
    }

    .view-option {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #8e8e93;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      background: transparent;
    }

    .view-option:hover {
      background: rgba(142, 142, 147, 0.1);
      color: #9ca3af;
    }

    .view-option.active {
      background: rgba(201, 169, 97, 0.15);
      color: #C9A961;
    }

    .view-option span:first-child {
      font-size: 1.125rem;
    }

    /* CONTENT AREA */
    .content-area {
      padding: 2rem 1.5rem;
      min-height: 500px;
      scroll-behavior: smooth;
      position: relative;
    }

    /* VIEW MODES */
    .view-mode {
      display: none;
    }

    .view-mode.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ============ LIBRARY VIEW ============ */
    .section-card {
      background: linear-gradient(145deg, rgba(25, 25, 27, 0.6), rgba(15, 15, 17, 0.8));
      border-left: 4px solid #C9A961;
      border-radius: 0.75rem;
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 
        8px 8px 16px rgba(0, 0, 0, 0.4),
        -4px -4px 12px rgba(40, 40, 42, 0.1);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .section-label {
      font-size: 0.65rem;
      color: #ff9500;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 600;
      padding: 0.2rem 0.5rem;
      background: rgba(255, 149, 0, 0.1);
      border-radius: 0.375rem;
      border: 1px solid rgba(255, 149, 0, 0.2);
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: #e5e5e7;
      font-family: 'Space Grotesk', sans-serif;
    }

    .section-purpose-text {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 1rem;
      font-style: italic;
    }

    .phrase-list {
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
    }

    .phrase-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.625rem 0.875rem;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 0.5rem;
      transition: all 0.3s;
      border-left: 2px solid transparent;
      cursor: pointer;
    }

    .phrase-item:hover {
      background: rgba(201, 169, 97, 0.08);
      border-left-color: #C9A961;
      transform: translateX(3px);
    }

    .phrase-item:active {
      transform: translateX(3px) scale(0.98);
    }

    .phrase-bullet {
      color: #C9A961;
      font-weight: 700;
      font-size: 1rem;
      line-height: 1.6;
      flex-shrink: 0;
    }

    .phrase-content {
      flex: 1;
    }

    .variation-label {
      font-size: 0.7rem;
      color: #ff9500;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.375rem;
      display: inline-block;
      padding: 0.125rem 0.5rem;
      background: rgba(255, 149, 0, 0.1);
      border-radius: 0.25rem;
    }

    .phrase-text {
      color: #e5e7eb;
      font-size: 0.9rem;
      line-height: 1.6;
      font-weight: 500;
      display: block;
    }

    .phrase-highlight {
      color: #7dd3fc;
      font-weight: 600;
    }

    /* ============ SLIDES VIEW ============ */
    .slides-container {
      padding: 2rem 0;
    }

    .slide-card {
      background: linear-gradient(145deg, rgba(25, 25, 27, 0.7), rgba(15, 15, 17, 0.9));
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 1rem;
      padding: 2.5rem 2rem;
      min-height: 450px;
      display: flex;
      flex-direction: column;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
    }

    .slide-card::before {
      content: '';
      position: absolute;
      top: -80px;
      right: -80px;
      width: 250px;
      height: 250px;
      background: radial-gradient(circle, rgba(201, 169, 97, 0.15) 0%, transparent 70%);
      pointer-events: none;
    }

    /* SOUND ICON */
    .sound-icon {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(28, 28, 30, 0.7);
      border: 1px solid rgba(84, 84, 88, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.125rem;
      z-index: 10;
      color: #636366;
      opacity: 0.6;
    }

    .sound-icon:hover {
      background: rgba(201, 169, 97, 0.2);
      border-color: rgba(201, 169, 97, 0.4);
      transform: scale(1.05);
      opacity: 1;
    }

    .sound-icon.active {
      color: #C9A961;
      border-color: rgba(201, 169, 97, 0.5);
      background: rgba(201, 169, 97, 0.15);
      opacity: 1;
    }

    .section-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.875rem;
      background: rgba(201, 169, 97, 0.1);
      border: 1px solid rgba(201, 169, 97, 0.3);
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 1.25rem;
      align-self: flex-start;
    }

    .slide-purpose {
      font-size: 0.875rem;
      color: #9ca3af;
      line-height: 1.5;
      margin-bottom: 2rem;
      font-style: italic;
    }

    .phrase-showcase {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem 0;
    }

    .phrase-display {
      font-size: 1.35rem;
      line-height: 1.7;
      color: #e5e5e7;
      text-align: center;
      font-weight: 400;
      max-width: 700px;
      animation: phraseAppear 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes phraseAppear {
      from { 
        opacity: 0; 
        transform: translateY(15px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .phrase-display .bracket {
      color: #ffd89c;
      font-weight: 600;
      background: rgba(255, 216, 156, 0.12);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
    }

    .slide-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(84, 84, 88, 0.2);
    }

    .progress-info {
      display: flex;
      align-items: center;
      gap: 0.875rem;
      color: #636366;
      font-size: 0.8125rem;
      font-weight: 600;
    }

    .progress-bar {
      width: 100px;
      height: 3px;
      background: rgba(201, 169, 97, 0.2);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #C9A961, #d4a574);
      border-radius: 999px;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 8px rgba(201, 169, 97, 0.5);
    }

    .slide-nav {
      display: flex;
      gap: 0.625rem;
    }

    .slide-nav-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(28, 28, 30, 0.6);
      border: 1px solid rgba(84, 84, 88, 0.25);
      color: #C9A961;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slide-nav-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.2);
      border-color: rgba(201, 169, 97, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    .slide-nav-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .slide-nav-btn:disabled {
      opacity: 0.2;
      cursor: not-allowed;
    }

    .slide-nav-btn.play {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #C9A961, #d4a574);
      border-color: transparent;
      color: #0a0a0a;
      font-weight: 700;
    }

    .slide-nav-btn.play:hover {
      transform: scale(1.05);
    }

    /* FOOTER */
    .footer-actions {
      padding: 0.85rem 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(84, 84, 88, 0.2);
      display: flex;
      justify-content: center;
      gap: 0.75rem;
    }

    .action-btn {
      padding: 0.5rem 1.25rem;
      background: rgba(28, 28, 30, 0.6);
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 999px;
      color: #C9A961;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'DM Sans';
      text-transform: uppercase;
      letter-spacing: 0.05em;
      min-height: 44px;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .action-btn:hover {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      transform: translateY(-1px);
    }

    .action-btn:active {
      transform: scale(0.95);
    }

    /* SLIDE CONTROLS BAR */
    .slide-controls-bar {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.25);
      border-top: 1px solid rgba(84, 84, 88, 0.2);
      display: flex;
      justify-content: center;
      gap: 1rem;
    }

    .slide-control-btn {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: rgba(28, 28, 30, 0.7);
      border: 1px solid rgba(84, 84, 88, 0.3);
      color: #C9A961;
      font-size: 1.25rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .slide-control-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.2);
      border-color: rgba(201, 169, 97, 0.4);
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(201, 169, 97, 0.3);
    }

    .slide-control-btn:active:not(:disabled) {
      transform: translateY(-1px);
    }

    .slide-control-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .slide-control-btn:first-child {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, #C9A961, #d4a574);
      border-color: transparent;
      color: #0a0a0a;
      font-weight: 700;
      box-shadow: 0 8px 24px rgba(201, 169, 97, 0.4);
    }

    .slide-control-btn:first-child:hover {
      transform: scale(1.08);
      box-shadow: 0 12px 32px rgba(201, 169, 97, 0.5);
    }

    /* ============ SKELETON VIEW ============ */
    .skeleton-container {
      padding: 2rem 1.5rem;
      min-height: 500px;
    }

    .skeleton-card {
      background: linear-gradient(145deg, rgba(25, 25, 27, 0.7), rgba(15, 15, 17, 0.9));
      border: 1px solid rgba(84, 84, 88, 0.25);
      border-radius: 1rem;
      padding: 2.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      margin-bottom: 2rem;
    }

    .skeleton-section {
      margin-bottom: 2.5rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid rgba(84, 84, 88, 0.2);
    }

    .skeleton-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .skeleton-section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .skeleton-section-icon {
      font-size: 1.5rem;
    }

    .skeleton-section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.125rem;
      font-weight: 700;
      color: #C9A961;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .skeleton-section-text {
      font-size: 1rem;
      line-height: 1.8;
      color: #e5e7eb;
      font-weight: 400;
    }

    .skeleton-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 0.75rem;
    }

    .skeleton-nav-btn {
      padding: 0.625rem 1.5rem;
      background: rgba(28, 28, 30, 0.6);
      border: 1px solid rgba(84, 84, 88, 0.3);
      border-radius: 999px;
      color: #C9A961;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'DM Sans';
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .skeleton-nav-btn:hover:not(:disabled) {
      background: rgba(201, 169, 97, 0.15);
      border-color: rgba(201, 169, 97, 0.4);
      transform: translateY(-1px);
    }

    .skeleton-nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .skeleton-btn-gen {
      padding: 0.75rem 1.75rem;
      background: linear-gradient(135deg, #C9A961, #d4a574);
      border: none;
      border-radius: 999px;
      color: #0a0a0a;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'DM Sans';
      text-transform: uppercase;
      letter-spacing: 0.05em;
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
    }

    .skeleton-btn-gen:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(201, 169, 97, 0.5);
    }

    .skeleton-btn-gen:active {
      transform: translateY(0);
    }

    .skeleton-counter {
      font-size: 0.875rem;
      color: #8e8e93;
      font-weight: 600;
      min-width: 80px;
      text-align: center;
    }
    /* ============ END SKELETON VIEW ============ */

    /* LOADING STATE */
    .loading {
      text-align: center;
      padding: 3rem;
      color: #8e8e93;
      font-size: 0.875rem;
    }

    .loading-sub {
      font-size: 0.75rem;
      color: #636366;
      margin-top: 0.5rem;
    }

    /* ERROR STATE */
    .error-state {
      text-align: center;
      padding: 3rem;
    }

    .error-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .error-title {
      font-size: 1.125rem;
      color: #f5f5f7;
      margin-bottom: 0.5rem;
    }

    .error-message {
      font-size: 0.875rem;
      color: #8e8e93;
      margin-bottom: 1rem;
    }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(16, 185, 129, 0.95);
      color: #000;
      padding: 0.875rem 1.5rem;
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      z-index: 3000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* MOBILE OPTIMIZATION */
    @media (max-width: 768px) {
      .container {
        padding: 0.375rem;
      }

      .global-header {
        padding: 0.5rem 0.75rem;
        margin-bottom: 0.75rem;
      }

      .header-brand-logo {
        font-size: 1.2rem;
      }

      .header-brand-subtitle {
        font-size: 0.6rem;
      }

      .tab {
        padding: 0.3rem 0.25rem;
      }

      .tab-icon {
        font-size: 1rem;
      }

      .tab-label {
        font-size: 0.5625rem;
      }

      .type-selector-section {
        padding: 0.65rem 0.75rem;
        gap: 0.375rem;
      }

      .type-btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.6rem;
      }

      .para-btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.6rem;
      }

      .content-area {
        padding: 1.5rem 1.25rem;
        min-height: 400px;
      }

      .slide-card {
        padding: 2rem 1.5rem;
        min-height: 380px;
      }

      .phrase-display {
        font-size: 1.125rem;
      }

      .section-card {
        padding: 1rem 1.25rem;
        margin-bottom: 1.25rem;
      }

      .phrase-item {
        padding: 0.5rem 0.75rem;
        gap: 0.5rem;
      }

      .phrase-text {
        font-size: 0.8rem;
      }

      .footer-actions {
        padding: 0.65rem 0.75rem;
        flex-wrap: wrap;
      }

      .action-btn {
        padding: 0.4rem 1rem;
        font-size: 0.65rem;
      }
    }

    /* Scrollbar styling */
    .content-area::-webkit-scrollbar {
      width: 6px;
    }

    .content-area::-webkit-scrollbar-thumb {
      background: rgba(99, 99, 102, 0.3);
      border-radius: 6px;
    }

    .content-area::-webkit-scrollbar-thumb:hover {
      background: rgba(99, 99, 102, 0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- UNIFIED HEADER (PRESERVED) -->
    <header class="global-header">
      <div class="header-row-main">
        <div class="brand">
          <span class="header-brand-logo">INTUITY</span>
          <span class="header-brand-subtitle">Report Structures</span>
        </div>
        <a href="../../../index.html?openModal=writing&submenu=reports" class="home-link">‚Üê Reports</a>
      </div>
      
      <nav class="mode-tabs">
        <a href="report-question-selector.html" class="tab">
          <span class="tab-icon">üìä</span>
          <span class="tab-label">Browse</span>
        </a>
        <a href="report-structure-practice.html" class="tab active">
          <span class="tab-icon">üèóÔ∏è</span>
          <span class="tab-label">Structures</span>
        </a>
        <a href="report-master.html" class="tab">
          <span class="tab-icon">üìñ</span>
          <span class="tab-label">Samples</span>
        </a>
        <a href="report-writer.html?mode=write" class="tab">
          <span class="tab-icon">‚úçÔ∏è</span>
          <span class="tab-label">Write</span>
        </a>
        <a href="report-language.html" class="tab">
          <span class="tab-icon">üìö</span>
          <span class="tab-label">Language</span>
        </a>
      </nav>
    </header>

    <!-- CENTRAL CARD -->
    <div class="unified-box">
      
      <!-- Report Type Selector -->
      <div class="type-selector-section" id="typeSelector">
        <!-- Buttons will be populated dynamically -->
      </div>

      <!-- Paragraph Navigation -->
      <div class="paragraph-nav" id="paragraphNav">
        <!-- Paragraph buttons will be populated dynamically -->
      </div>

      <!-- VIEW MODE TOGGLE (PROMINENT POSITION) -->
      <div class="view-toggle-container">
        <span class="view-mode-label">View Mode:</span>
        <div class="view-toggle-group">
          <div class="view-option active" id="listOption" onclick="switchViewMode('list')">
            <span>üìö</span>
            <span>List</span>
          </div>
          <div class="view-option" id="slidesOption" onclick="switchViewMode('slides')">
            <span>üé¨</span>
            <span>Slides</span>
          </div>
          <div class="view-option" id="skeletonOption" onclick="switchViewMode('skeleton')">
            <span>üíÄ</span>
            <span>Skeleton</span>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area" id="contentArea">
        
        <!-- LIST VIEW -->
        <div class="view-mode active" id="listView">
          <div class="loading">
            <div>Loading report structures...</div>
            <div class="loading-sub" id="loadingStatus">Initializing...</div>
          </div>
        </div>

        <!-- SLIDES VIEW -->
        <div class="view-mode" id="slidesView">
          <div class="slides-container">
            <div class="slide-card">
              
              <!-- SOUND ICON -->
              <div class="sound-icon" id="soundIcon" title="Click to enable sound">
                <span id="soundEmoji">üîá</span>
              </div>

              <div class="section-badge" id="slideSectionBadge">
                <span id="slideSectionIcon">üìù</span>
                <span id="slideSectionName">Loading...</span>
              </div>
              
              <p class="slide-purpose" id="slidePurpose"></p>
              
              <div class="phrase-showcase">
                <p class="phrase-display" id="phraseDisplay">
                  Loading phrases...
                </p>
              </div>

              <div class="slide-controls">
                <div class="progress-info">
                  <span id="currentNum">1</span>
                  <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                  </div>
                  <span id="totalNum">10</span>
                </div>

                <div class="slide-nav">
                  <button class="slide-nav-btn" id="prevBtn" onclick="prevPhrase()">‚Üê</button>
                  <button class="slide-nav-btn play" id="playBtn" onclick="toggleAutoPlay()">‚ñ∂</button>
                  <button class="slide-nav-btn" id="nextBtn" onclick="nextPhrase()">‚Üí</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SKELETON VIEW (NEW!) -->
        <div class="view-mode" id="skeletonView">
          <div class="skeleton-container">
            <div class="skeleton-card" id="skeletonCard">
              Loading complete report structure...
            </div>
            <div class="skeleton-nav">
              <button class="skeleton-nav-btn" id="prevSkeletonBtn" onclick="prevSkeleton()">‚Üê Previous</button>
              <span class="skeleton-counter" id="skeletonCounter">1 / 10</span>
              <button class="skeleton-btn-gen" onclick="generateRandomSkeleton()">üé≤ Generate Random</button>
              <button class="skeleton-nav-btn" id="nextSkeletonBtn" onclick="nextSkeleton()">Next ‚Üí</button>
            </div>
          </div>
        </div>

      </div>

      <!-- Footer Actions -->
      <div class="footer-actions">
        <button class="action-btn" onclick="copyCurrentContent()">
          <span>üìã</span>
          <span id="copyBtnText">Copy All</span>
        </button>
        <button class="action-btn" onclick="shufflePhrases()" id="shuffleBtn">
          <span>üîÄ</span>
          <span>Shuffle</span>
        </button>
        <button class="action-btn" onclick="printGuide()">
          <span>üñ®Ô∏è</span>
          <span>Print</span>
        </button>
      </div>

      <!-- Slide Controls (Visible only in Slides mode) -->
      <div class="slide-controls-bar" id="slideControlsBar" style="display: none;">
        <button class="slide-control-btn" onclick="toggleAutoPlay()" id="autoPlayBtn">
          <span>‚ñ∂</span>
        </button>
        <button class="slide-control-btn" onclick="prevPhrase()" id="prevSlideBtn">
          <span>‚Üê</span>
        </button>
        <button class="slide-control-btn" onclick="nextPhrase()" id="nextSlideBtn">
          <span>‚Üí</span>
        </button>
        <button class="slide-control-btn" onclick="repeatPhrase()">
          <span>‚Üª</span>
        </button>
      </div>

    </div>

  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script>
    // ==================== STATE ====================
    let REPORT_STRUCTURES_LIST = null;  // For list mode (generic phrases)
    let REPORT_STRUCTURES_SLIDES = null; // For slides mode (full context)
    let REPORT_STRUCTURES_SKELETON = null; // For skeleton mode (complete reports)
    let currentType = null;
    let currentSectionKey = null;
    let currentPhraseIndex = 0;
    let currentPhrases = [];
    let autoPlayInterval = null;
    let isAutoPlaying = false;
    let viewMode = 'list'; // 'list', 'slides', or 'skeleton'
    let typeKeys = [];
    let soundEnabled = false; // OFF by default
    let currentUtterance = null;
    let speechFinished = true;
    
    // Skeleton mode state
    let skeletonSlides = []; // Array of 10 generated complete reports
    let currentSkeletonIndex = 0; // 0 = fixed template, 1-9 = random

    const SECTION_ICONS = {
      'introduction': 'üìù',
      'neutral': '‚öñÔ∏è',
      'praising': '‚≠ê',
      'criticising': '‚ö†Ô∏è',
      'recommending': 'üí°',
      'conclusion': '‚úÖ'
    };

    const SECTION_LABELS = {
      'introduction': 'A: Introduction & Context',
      'neutral': 'B: Neutral General Views',
      'praising': 'C: Praising',
      'criticising': 'D: Criticising',
      'recommending': 'E: Recommending',
      'conclusion': 'F: Conclusion'
    };

    // ==================== INITIALIZATION ====================
    async function init() {
      try {
        updateLoadingStatus('Loading structures data...');
        
        // Load ALL THREE JSON files
        const [listResponse, slidesResponse, skeletonResponse] = await Promise.all([
          fetch('data/report-structures.json'),
          fetch('data/report-structures-text.json'),
          fetch('data/report-structures-skeleton.json')
        ]);
        
        if (!listResponse.ok) {
          throw new Error(`Failed to load report-structures.json (${listResponse.status})`);
        }
        if (!slidesResponse.ok) {
          throw new Error(`Failed to load report-structures-text.json (${slidesResponse.status})`);
        }
        if (!skeletonResponse.ok) {
          throw new Error(`Failed to load report-structures-skeleton.json (${skeletonResponse.status})`);
        }
        
        REPORT_STRUCTURES_LIST = await listResponse.json();
        REPORT_STRUCTURES_SLIDES = await slidesResponse.json();
        REPORT_STRUCTURES_SKELETON = await skeletonResponse.json();
        
        console.log('‚úÖ List structures loaded:', Object.keys(REPORT_STRUCTURES_LIST).length, 'types');
        console.log('‚úÖ Slides structures loaded:', Object.keys(REPORT_STRUCTURES_SLIDES).length, 'types');
        console.log('‚úÖ Skeleton structures loaded:', Object.keys(REPORT_STRUCTURES_SKELETON).length, 'types');
        
        // Get available types (use list as primary)
        typeKeys = Object.keys(REPORT_STRUCTURES_LIST);
        
        if (typeKeys.length === 0) {
          throw new Error('No report structures found in data');
        }
        
        currentType = typeKeys[0];
        currentSectionKey = 'all';
        
        // Build type selector buttons
        buildTypeSelector();
        
        // Build paragraph navigation
        buildParagraphNav();
        
        // Setup view toggle
        setupViewToggle();
        
        // Setup sound icon
        setupSoundIcon();
        
        // Initialize skeleton mode
        initializeSkeleton();
        
        // Render all sections in list view initially
        renderAllSections();
        
      } catch (error) {
        console.error('Error loading structures:', error);
        showError(error.message);
      }
    }

    function updateLoadingStatus(message) {
      const status = document.getElementById('loadingStatus');
      if (status) status.textContent = message;
    }

    function showError(message) {
      const container = document.getElementById('listView');
      container.innerHTML = `
        <div class="error-state">
          <div class="error-icon">‚ö†Ô∏è</div>
          <div class="error-title">Error Loading Structures</div>
          <div class="error-message">${escapeHtml(message)}</div>
          <button class="action-btn" onclick="location.reload()" style="margin: 0 auto;">
            <span>üîÑ</span>
            <span>Reload</span>
          </button>
        </div>
      `;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ==================== DATA ACCESS HELPER ====================
    function getCurrentDataset() {
      // List mode uses generic phrases, Slides mode uses full context
      return viewMode === 'list' ? REPORT_STRUCTURES_LIST : REPORT_STRUCTURES_SLIDES;
    }

    // ==================== VIEW TOGGLE ====================
    // ==================== VIEW MODE SWITCHING ====================
    function switchViewMode(mode) {
      if (mode === viewMode) return;
      
      viewMode = mode;
      
      // Update active states
      document.querySelectorAll('.view-option').forEach(opt => opt.classList.remove('active'));
      if (mode === 'list') document.getElementById('listOption').classList.add('active');
      if (mode === 'slides') document.getElementById('slidesOption').classList.add('active');
      if (mode === 'skeleton') document.getElementById('skeletonOption').classList.add('active');
      
      // Show/hide views
      document.getElementById('listView').classList.toggle('active', mode === 'list');
      document.getElementById('slidesView').classList.toggle('active', mode === 'slides');
      document.getElementById('skeletonView').classList.toggle('active', mode === 'skeleton');
      
      // Show/hide slide controls bar (only for slides mode)
      document.getElementById('slideControlsBar').style.display = mode === 'slides' ? 'flex' : 'none';
      
      // Update button text
      const copyBtn = document.getElementById('copyBtnText');
      if (mode === 'list') copyBtn.textContent = 'Copy All';
      else if (mode === 'slides') copyBtn.textContent = 'Copy Phrase';
      else copyBtn.textContent = 'Copy Report';
      
      // Handle mode-specific initialization
      if (mode === 'list') {
        if (currentSectionKey === 'all') {
          renderAllSections();
        } else {
          renderList(currentType, currentSectionKey);
        }
        if (isAutoPlaying) toggleAutoPlay();
        if (window.speechSynthesis) window.speechSynthesis.cancel();
        speechFinished = true;
        
      } else if (mode === 'slides') {
        if (currentSectionKey === 'all') {
          const firstSection = Object.keys(REPORT_STRUCTURES_SLIDES[currentType].sections)[0];
          loadSection(firstSection);
        } else {
          loadSection(currentSectionKey);
        }
        
      } else if (mode === 'skeleton') {
        renderSkeletonSlide();
      }
    }

    // Legacy function - view toggle now handled by switchViewMode
    function setupViewToggle() {
      // View mode switching is now handled by switchViewMode() function
      // called directly from HTML onclick events
      console.log('‚úÖ View mode system initialized (3-mode buttons)');
    }

    // ==================== PARAGRAPH NAVIGATION ====================
    function buildParagraphNav() {
      const nav = document.getElementById('paragraphNav');
      nav.innerHTML = '';
      
      const structure = getCurrentDataset()[currentType];
      if (!structure || !structure.sections) return;
      
      // Add "All Sections" button first
      const allBtn = document.createElement('button');
      allBtn.className = 'para-btn active';
      allBtn.setAttribute('data-section', 'all');
      allBtn.innerHTML = `<span>üìö</span><span>All Sections</span>`;
      allBtn.onclick = () => selectSection('all', allBtn);
      nav.appendChild(allBtn);
      
      // Add individual section buttons
      Object.keys(structure.sections).forEach((key, index) => {
        const btn = document.createElement('button');
        btn.className = 'para-btn';
        btn.setAttribute('data-section', key);
        btn.innerHTML = `<span>${SECTION_ICONS[key] || 'üìù'}</span><span>${SECTION_LABELS[key]}</span>`;
        btn.onclick = () => selectSection(key, btn);
        nav.appendChild(btn);
      });
    }

    function selectSection(sectionKey, btnElement) {
      document.querySelectorAll('.para-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      btnElement.classList.add('active');
      
      currentSectionKey = sectionKey;
      
      // Update view based on current mode
      if (viewMode === 'list') {
        if (sectionKey === 'all') {
          renderAllSections();
        } else {
          renderList(currentType, sectionKey);
        }
      } else {
        // Slides mode - can't show "all", so show first section or selected section
        if (sectionKey === 'all') {
          const firstSection = Object.keys(getCurrentDataset()[currentType].sections)[0];
          loadSection(firstSection);
        } else {
          loadSection(sectionKey);
        }
      }
    }

    // ==================== TYPE SELECTOR ====================
    function buildTypeSelector() {
      const selector = document.getElementById('typeSelector');
      selector.innerHTML = '';
      
      typeKeys.forEach((key, index) => {
        const structure = REPORT_STRUCTURES_LIST[key]; // Always use list for type names
        const btn = document.createElement('button');
        btn.className = 'type-btn' + (index === 0 ? ' active' : '');
        btn.setAttribute('data-type', key);
        btn.textContent = structure.title || key.charAt(0).toUpperCase() + key.slice(1);
        btn.onclick = () => selectType(key, btn);
        selector.appendChild(btn);
      });
    }

    function selectType(type, btnElement) {
      currentType = type;
      
      document.querySelectorAll('.type-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      btnElement.classList.add('active');
      
      buildParagraphNav();
      
      // Reset to "All Sections" view
      currentSectionKey = 'all';
      
      if (viewMode === 'list') {
        renderAllSections();
      } else {
        loadFirstSection();
      }
    }

    // ==================== LIST VIEW ====================
    function renderList(type, sectionKey = null) {
      const container = document.getElementById('listView');
      const structure = REPORT_STRUCTURES_LIST[type]; // Always use LIST data for list view
      
      if (!structure) {
        container.innerHTML = '<div class="loading">Structure not found</div>';
        return;
      }

      if (!sectionKey && structure.sections) {
        sectionKey = Object.keys(structure.sections)[0];
      }

      let html = '';

      if (structure.sections && sectionKey && structure.sections[sectionKey]) {
        html += renderSection(structure.sections[sectionKey], sectionKey);
      }

      container.innerHTML = html;
    }

    function renderAllSections() {
      const container = document.getElementById('listView');
      const structure = REPORT_STRUCTURES_LIST[currentType]; // Always use LIST data for list view
      
      if (!structure) {
        container.innerHTML = '<div class="loading">Structure not found</div>';
        return;
      }

      let html = '';
      
      Object.entries(structure.sections).forEach(([key, section]) => {
        html += renderSection(section, key);
      });

      container.innerHTML = html;
    }

    function renderSection(section, key) {
      let html = `
        <div class="section-card">
          <div class="section-header">
            <span class="section-label">${escapeHtml(SECTION_LABELS[key] || section.label)}</span>
          </div>
          <div class="section-purpose-text">${escapeHtml(section.purpose)}</div>
          <div class="phrase-list">
      `;

      if (section.examples && Array.isArray(section.examples)) {
        section.examples.forEach((example) => {
          const variationLabel = example.variation ? `Variation ${example.variation}` : '';
          const displayText = escapeHtml(example.text || example);
          
          html += `
            <div class="phrase-item" data-phrase-text="${escapeHtml(example.text || example)}" onclick="copyPhraseFromElement(this)">
              <span class="phrase-bullet">‚Ä¢</span>
              <div class="phrase-content">
                ${variationLabel ? `<div class="variation-label">${variationLabel}</div>` : ''}
                <span class="phrase-text">${displayText}</span>
              </div>
            </div>
          `;
        });
      } else if (section.phrases && Array.isArray(section.phrases)) {
        // Fallback for old structure
        section.phrases.forEach((phrase) => {
          const highlightedPhrase = escapeHtml(phrase).replace(
            /\[([^\]]+)\]/g, 
            '<span class="phrase-highlight">[$1]</span>'
          );
          
          html += `
            <div class="phrase-item" data-phrase-text="${escapeHtml(phrase)}" onclick="copyPhraseFromElement(this)">
              <span class="phrase-bullet">‚Ä¢</span>
              <span class="phrase-text">${highlightedPhrase}</span>
            </div>
          `;
        });
      }

      html += `
          </div>
        </div>
      `;

      return html;
    }

    // ==================== SLIDES VIEW ====================
    function loadFirstSection() {
      const structure = REPORT_STRUCTURES_SLIDES[currentType]; // Always use SLIDES data for slides view
      const sections = structure.sections;
      currentSectionKey = Object.keys(sections)[0];
      loadSection(currentSectionKey);
    }

    function loadSection(sectionKey) {
      currentSectionKey = sectionKey;
      const section = REPORT_STRUCTURES_SLIDES[currentType].sections[sectionKey]; // Always use SLIDES data
      
      // Handle both new structure (examples) and old structure (phrases)
      if (section.examples && Array.isArray(section.examples)) {
        currentPhrases = section.examples.map(ex => ex.text || ex);
      } else if (section.phrases && Array.isArray(section.phrases)) {
        currentPhrases = [...section.phrases];
      } else {
        currentPhrases = [];
      }
      
      currentPhraseIndex = 0;
      
      document.getElementById('slideSectionIcon').textContent = SECTION_ICONS[sectionKey] || 'üìù';
      document.getElementById('slideSectionName').textContent = SECTION_LABELS[sectionKey] || section.label;
      document.getElementById('slidePurpose').textContent = section.purpose;
      
      renderPhrase();
    }

    function renderPhrase() {
      if (currentPhrases.length === 0) return;
      
      const phrase = currentPhrases[currentPhraseIndex];
      const display = document.getElementById('phraseDisplay');
      
      // Cancel any ongoing speech
      if (window.speechSynthesis) {
        window.speechSynthesis.cancel();
      }
      speechFinished = false;
      
      const highlighted = phrase.replace(/\[([^\]]+)\]/g, '<span class="bracket">[$1]</span>');
      
      display.style.opacity = '0';
      
      setTimeout(() => {
        display.innerHTML = highlighted;
        display.style.opacity = '1';
        
        // Speak if sound is enabled
        if (soundEnabled) {
          speakPhrase(phrase);
        } else {
          speechFinished = true;
        }
      }, 200);
      
      updateProgress();
    }

    // ==================== TEXT-TO-SPEECH ====================
    function toggleSound() {
      soundEnabled = !soundEnabled;
      const soundIcon = document.getElementById('soundIcon');
      const soundEmoji = document.getElementById('soundEmoji');
      
      if (soundEnabled) {
        soundIcon.classList.add('active');
        soundEmoji.textContent = 'üîä';
        soundIcon.title = 'Sound ON - Click to mute';
        showToast('Sound enabled');
        
        // Speak current phrase if in slides view
        if (viewMode === 'slides' && currentPhrases.length > 0) {
          speakPhrase(currentPhrases[currentPhraseIndex]);
        }
      } else {
        soundIcon.classList.remove('active');
        soundEmoji.textContent = 'üîá';
        soundIcon.title = 'Sound OFF - Click to enable';
        
        // Stop any ongoing speech
        if (window.speechSynthesis) {
          window.speechSynthesis.cancel();
        }
        speechFinished = true;
        showToast('Sound disabled');
      }
    }

    function speakPhrase(phrase) {
      if (!('speechSynthesis' in window) || !soundEnabled) {
        speechFinished = true;
        return;
      }
      
      // Cancel any ongoing speech
      window.speechSynthesis.cancel();
      speechFinished = false;
      
      // Remove [brackets] for cleaner speech
      const cleanText = phrase.replace(/\[([^\]]+)\]/g, '$1');
      
      setTimeout(() => {
        currentUtterance = new SpeechSynthesisUtterance(cleanText);
        currentUtterance.lang = 'en-GB';
        currentUtterance.rate = 0.85; // Slightly slower for clarity
        currentUtterance.pitch = 1.0;
        currentUtterance.volume = 1.0;

        // Try to use UK English voice
        const voices = window.speechSynthesis.getVoices();
        const ukVoice = voices.find(v => v.lang === 'en-GB' || v.lang.startsWith('en-GB'));
        if (ukVoice) {
          currentUtterance.voice = ukVoice;
        }
        
        currentUtterance.onend = () => {
          speechFinished = true;
        };
        
        currentUtterance.onerror = (error) => {
          console.error('Speech error:', error);
          speechFinished = true;
        };
        
        window.speechSynthesis.speak(currentUtterance);
      }, 300);
    }

    function updateProgress() {
      document.getElementById('currentNum').textContent = currentPhraseIndex + 1;
      document.getElementById('totalNum').textContent = currentPhrases.length;
      
      const progress = ((currentPhraseIndex + 1) / currentPhrases.length) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const prevSlideBtn = document.getElementById('prevSlideBtn');
      const nextSlideBtn = document.getElementById('nextSlideBtn');
      
      if (prevBtn) prevBtn.disabled = currentPhraseIndex === 0;
      if (nextBtn) nextBtn.disabled = currentPhraseIndex === currentPhrases.length - 1;
      if (prevSlideBtn) prevSlideBtn.disabled = currentPhraseIndex === 0;
      if (nextSlideBtn) nextSlideBtn.disabled = currentPhraseIndex === currentPhrases.length - 1;
    }

    function nextPhrase() {
      if (currentPhraseIndex < currentPhrases.length - 1) {
        currentPhraseIndex++;
        renderPhrase();
      }
    }

    function prevPhrase() {
      if (currentPhraseIndex > 0) {
        currentPhraseIndex--;
        renderPhrase();
      }
    }

    function toggleAutoPlay() {
      isAutoPlaying = !isAutoPlaying;
      const btn = document.getElementById('playBtn');
      const controlBtn = document.getElementById('autoPlayBtn');
      
      if (isAutoPlaying) {
        if (btn) btn.textContent = '‚è∏';
        if (controlBtn) controlBtn.innerHTML = '<span>‚è∏</span>';
        
        autoPlayInterval = setInterval(() => {
          // If sound is enabled, wait for speech to finish
          if (soundEnabled && !speechFinished) {
            return;
          }
          
          // If sound is disabled, use fixed timing
          if (!soundEnabled) {
            clearInterval(autoPlayInterval);
            setTimeout(() => {
              if (isAutoPlaying) {
                advanceToNextPhrase();
                if (isAutoPlaying) toggleAutoPlay(); // Restart interval
              }
            }, 5000); // 5 seconds when no sound
            return;
          }
          
          advanceToNextPhrase();
        }, 500); // Check every 500ms if speech is finished
        
      } else {
        if (btn) btn.textContent = '‚ñ∂';
        if (controlBtn) controlBtn.innerHTML = '<span>‚ñ∂</span>';
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
      }
    }

    function advanceToNextPhrase() {
      if (currentPhraseIndex < currentPhrases.length - 1) {
        nextPhrase();
      } else {
        // Stop at the end
        toggleAutoPlay();
      }
    }

    function repeatPhrase() {
      if (viewMode === 'slides') {
        renderPhrase();
        showToast('Phrase repeated');
      }
    }

    function shufflePhrases() {
      if (viewMode === 'slides') {
        currentPhrases.sort(() => Math.random() - 0.5);
        currentPhraseIndex = 0;
        renderPhrase();
        showToast('Phrases shuffled!');
      } else {
        showToast('Switch to Slides view to shuffle');
      }
    }

    // ==================== ACTIONS ====================
    function copyPhraseFromElement(element) {
      const phrase = element.getAttribute('data-phrase-text');
      if (phrase) {
        navigator.clipboard.writeText(phrase).then(() => {
          showToast(`Copied!`);
          element.style.background = 'rgba(16, 185, 129, 0.15)';
          element.style.borderLeftColor = '#10b981';
          setTimeout(() => {
            element.style.background = '';
            element.style.borderLeftColor = '';
          }, 1000);
        });
      }
    }

    function copyCurrentContent() {
      if (viewMode === 'slides') {
        const phrase = currentPhrases[currentPhraseIndex];
        navigator.clipboard.writeText(phrase).then(() => {
          showToast('Phrase copied!');
        });
      } else {
        copyAllPhrases();
      }
    }

    function copyAllPhrases() {
      const structure = getCurrentDataset()[currentType];
      if (!structure) return;
      
      let text = `${structure.title}\n${'='.repeat(structure.title.length)}\n\n`;
      text += `${structure.purpose}\n\n`;
      
      Object.entries(structure.sections).forEach(([key, section]) => {
        text += `${SECTION_LABELS[key] || section.label}\n`;
        text += `${'-'.repeat((SECTION_LABELS[key] || section.label).length)}\n`;
        text += `${section.purpose}\n\n`;
        
        // Handle both structures
        if (section.examples && Array.isArray(section.examples)) {
          section.examples.forEach((example) => {
            if (example.variation) {
              text += `Variation ${example.variation}:\n`;
            }
            text += `‚Ä¢ ${example.text || example}\n\n`;
          });
        } else if (section.phrases && Array.isArray(section.phrases)) {
          section.phrases.forEach(phrase => {
            text += `‚Ä¢ ${phrase}\n`;
          });
        }
        text += '\n';
      });

      navigator.clipboard.writeText(text).then(() => {
        showToast('All phrases copied to clipboard ‚úì');
      }).catch(err => {
        console.error('Failed to copy:', err);
        showToast('Failed to copy to clipboard', false);
      });
    }

    function printGuide() {
      window.print();
    }

    // ==================== TOAST ====================
    function showToast(message, success = true) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.background = success 
        ? 'rgba(16, 185, 129, 0.95)' 
        : 'rgba(239, 68, 68, 0.95)';
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2500);
    }

    // ==================== KEYBOARD SHORTCUTS ====================
    document.addEventListener('keydown', (e) => {
      if (viewMode !== 'slides') return;
      
      if (e.key === 'ArrowRight') nextPhrase();
      if (e.key === 'ArrowLeft') prevPhrase();
      if (e.key === ' ') {
        e.preventDefault();
        toggleAutoPlay();
      }
      if (e.key === 'r' || e.key === 'R') shufflePhrases();
      if (e.key === 's' || e.key === 'S') toggleSound();
    });

    // ==================== EVENT LISTENERS ====================
    // Setup sound icon click listener when DOM is ready
    function setupSoundIcon() {
      const soundIcon = document.getElementById('soundIcon');
      if (soundIcon) {
        soundIcon.addEventListener('click', toggleSound);
      }
    }

    // Load voices when available
    if (window.speechSynthesis) {
      window.speechSynthesis.onvoiceschanged = () => {
        console.log('‚úÖ Speech voices loaded');
      };
    }

    // ==================== SKELETON MODE ====================
    function initializeSkeleton() {
      // Generate the initial 10 slides (1 fixed + 9 random)
      skeletonSlides = [];
      
      console.log('ü¶¥ Initializing skeleton mode...');
      console.log('Current type:', currentType);
      console.log('Skeleton data:', REPORT_STRUCTURES_SKELETON);
      
      if (!REPORT_STRUCTURES_SKELETON[currentType]) {
        console.error('‚ùå No skeleton data for type:', currentType);
        return;
      }
      
      const skeletonData = REPORT_STRUCTURES_SKELETON[currentType];
      console.log('Skeleton data for type:', skeletonData);
      
      if (!skeletonData.fixed_template) {
        console.error('‚ùå No fixed_template found in skeleton data');
        return;
      }
      
      skeletonSlides[0] = skeletonData.fixed_template;
      console.log('‚úÖ Fixed template loaded');
      
      // Generate 9 random reports
      for (let i = 1; i < 10; i++) {
        try {
          skeletonSlides[i] = generateRandomReport();
          console.log(`‚úÖ Random report ${i} generated`);
        } catch (error) {
          console.error(`‚ùå Error generating random report ${i}:`, error);
        }
      }
      
      currentSkeletonIndex = 0;
      console.log('‚úÖ Skeleton initialization complete');
    }

    function generateRandomReport() {
      const skeletonData = REPORT_STRUCTURES_SKELETON[currentType];
      
      if (!skeletonData || !skeletonData.random_pools) {
        console.error('‚ùå No random_pools found in skeleton data');
        console.log('Available properties:', Object.keys(skeletonData || {}));
        throw new Error('Missing random_pools in skeleton data');
      }
      
      const pools = skeletonData.random_pools;
      const report = {};
      
      // Introduction = random aim + topic + method
      if (pools.introduction) {
        const aim = pools.introduction.aims[Math.floor(Math.random() * pools.introduction.aims.length)];
        const topic = pools.introduction.topics[Math.floor(Math.random() * pools.introduction.topics.length)];
        const method = pools.introduction.methods[Math.floor(Math.random() * pools.introduction.methods.length)];
        report.introduction = `${aim} ${topic}. ${method}`;
      }
      
      // Neutral = random opening + assessment + reason
      if (pools.neutral) {
        const neutralOpen = pools.neutral.opening[Math.floor(Math.random() * pools.neutral.opening.length)];
        const assessment = pools.neutral.assessment[Math.floor(Math.random() * pools.neutral.assessment.length)];
        const reason = pools.neutral.reason[Math.floor(Math.random() * pools.neutral.reason.length)];
        report.neutral = `${neutralOpen} ${assessment}. ${reason}`;
      }
      
      // Praising = random opening + subject + elaboration
      if (pools.praising) {
        const praiseOpen = pools.praising.opening[Math.floor(Math.random() * pools.praising.opening.length)];
        const subject = pools.praising.subject[Math.floor(Math.random() * pools.praising.subject.length)];
        const elaboration = pools.praising.elaboration[Math.floor(Math.random() * pools.praising.elaboration.length)];
        report.praising = `${praiseOpen} ${subject}. ${elaboration}`;
      }
      
      // Criticising = random opening + problem + impact
      if (pools.criticising) {
        const critOpen = pools.criticising.opening[Math.floor(Math.random() * pools.criticising.opening.length)];
        const problem = pools.criticising.problem[Math.floor(Math.random() * pools.criticising.problem.length)];
        const impact = pools.criticising.impact[Math.floor(Math.random() * pools.criticising.impact.length)];
        report.criticising = `${critOpen} ${problem}. ${impact}`;
      }
      
      // Recommending = random opening + action + benefit
      if (pools.recommending) {
        const recOpen = pools.recommending.opening[Math.floor(Math.random() * pools.recommending.opening.length)];
        const action = pools.recommending.action[Math.floor(Math.random() * pools.recommending.action.length)];
        const benefit = pools.recommending.benefit[Math.floor(Math.random() * pools.recommending.benefit.length)];
        report.recommending = `${recOpen} ${action}. ${benefit}`;
      }
      
      // Conclusion = random summary + priority + final
      if (pools.conclusion) {
        const summary = pools.conclusion.summary[Math.floor(Math.random() * pools.conclusion.summary.length)];
        const priority = pools.conclusion.priority[Math.floor(Math.random() * pools.conclusion.priority.length)];
        const final = pools.conclusion.final[Math.floor(Math.random() * pools.conclusion.final.length)];
        report.conclusion = `${summary}. ${priority} ${final}`;
      }
      
      return report;
    }

    function renderSkeletonSlide() {
      const report = skeletonSlides[currentSkeletonIndex];
      const card = document.getElementById('skeletonCard');
      
      let html = '';
      
      const sections = [
        { key: 'introduction', icon: 'üìù', title: 'A: Introduction' },
        { key: 'neutral', icon: '‚öñÔ∏è', title: 'B: General View' },
        { key: 'praising', icon: '‚≠ê', title: 'C: Praising' },
        { key: 'criticising', icon: '‚ö†Ô∏è', title: 'D: Criticising' },
        { key: 'recommending', icon: 'üí°', title: 'E: Recommending' },
        { key: 'conclusion', icon: '‚úÖ', title: 'F: Conclusion' }
      ];
      
      sections.forEach(section => {
        html += `
          <div class="skeleton-section">
            <div class="skeleton-section-header">
              <span class="skeleton-section-icon">${section.icon}</span>
              <span class="skeleton-section-title">${section.title}</span>
            </div>
            <p class="skeleton-section-text">${escapeHtml(report[section.key])}</p>
          </div>
        `;
      });
      
      card.innerHTML = html;
      
      // Update counter
      document.getElementById('skeletonCounter').textContent = `${currentSkeletonIndex + 1} / 10`;
      
      // Update navigation buttons
      document.getElementById('prevSkeletonBtn').disabled = currentSkeletonIndex === 0;
      document.getElementById('nextSkeletonBtn').disabled = currentSkeletonIndex === 9;
    }

    function prevSkeleton() {
      if (currentSkeletonIndex > 0) {
        currentSkeletonIndex--;
        renderSkeletonSlide();
      }
    }

    function nextSkeleton() {
      if (currentSkeletonIndex < 9) {
        currentSkeletonIndex++;
        renderSkeletonSlide();
      }
    }

    function generateRandomSkeleton() {
      // Regenerate all 9 random reports (keep fixed template at index 0)
      for (let i = 1; i < 10; i++) {
        skeletonSlides[i] = generateRandomReport();
      }
      
      // If currently viewing a random slide, re-render it
      if (currentSkeletonIndex > 0) {
        renderSkeletonSlide();
      }
      
      showToast('üé≤ New random reports generated!');
    }
    // ==================== END SKELETON MODE ====================

    // ==================== START ====================
    init();
  </script>
</body>
</html>
