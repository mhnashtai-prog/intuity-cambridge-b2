<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTUITY - Cohesion Tools</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --accent: #C9A961;
      --accent-soft: rgba(201, 169, 97, 0.32);
      --accent-bg: rgba(201, 169, 97, 0.2);
      --correct: #10b981;
      --incorrect: #ef4444;
    }

    body {
      font-family: 'DM Sans', 'Inter', sans-serif;
      background: radial-gradient(circle at top, #1a1a1a 0, #050505 45%, #000 100%);
      color: #e5e5e7;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 20% 10%, rgba(201, 169, 97, 0.12) 0%, transparent 55%),
        radial-gradient(circle at 80% 90%, rgba(201, 169, 97, 0.06) 0%, transparent 45%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    /* HEADER - MATCHING ESSAY-MASTER.HTML */
    .header {
      background: rgba(28, 28, 30, 0.95);
      backdrop-filter: blur(40px);
      border-bottom: 1px solid rgba(84, 84, 88, 0.3);
      padding: 0.75rem 1.5rem;
      margin-bottom: 1rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

   .brand-logo {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 1.6rem;
  font-weight: 700;
  background: linear-gradient(135deg, #C9A961 0%, rgba(255,255,255,0.85) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-transform: uppercase;
  letter-spacing: -0.04em;
  margin-bottom: 0.25rem;
}
    
    .brand-subtitle {
      font-size: 0.75rem;
      color: #636366;
      margin-top: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    /* BACK BUTTON - MATCHING ESSAY-MASTER.HTML */
    .back-btn {
      position: absolute;
      top: 1rem;
      left: 1rem;
      padding: 0.4rem 0.85rem;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      color: #C9A961;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 100;
      min-height: 44px;
    }

    .back-btn:hover {
      background: rgba(0, 0, 0, 0.6);
      border-color: rgba(201, 169, 97, 0.3);
      transform: translateX(-2px);
    }

    .back-btn:active {
      transform: scale(0.95);
    }

    /* MAIN CARD */
    .card {
      background: rgba(20, 20, 22, 0.85);
      backdrop-filter: blur(30px) saturate(160%);
      -webkit-backdrop-filter: blur(30px) saturate(160%);
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.9),
        inset 0 1px 0 rgba(255, 255, 255, 0.04);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      flex: 1;
      margin-bottom: 1rem;
    }

    /* MODE SELECTOR */
    .mode-selector {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .mode-btn {
      padding: 0.5rem 1.25rem;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: #8e8e93;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.3s;
    }

    .mode-btn.active {
      background: var(--accent-bg);
      border-color: var(--accent);
      color: #fef3c7;
    }

    .mode-btn:hover:not(.active) {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(255, 255, 255, 0.12);
    }

    /* EXERCISE AREA */
    .exercise-area {
      padding: 1.5rem;
      border-radius: 1rem;
      background: linear-gradient(145deg, rgba(25, 25, 27, 0.7), rgba(15, 15, 17, 0.85));
      box-shadow: 
        inset 6px 6px 12px rgba(0, 0, 0, 0.6),
        inset -6px -6px 12px rgba(40, 40, 42, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.02);
      min-height: 400px;
    }

    /* EXERCISE TITLE */
    .exercise-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .exercise-instruction {
      font-size: 0.85rem;
      color: #a1a1aa;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    /* TEXT PASSAGE */
    .passage {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 0.75rem;
      padding: 1.25rem;
      font-size: 1rem;
      line-height: 1.8;
      color: #e5e7eb;
      margin-bottom: 1.5rem;
    }

    .passage p {
      margin-bottom: 1rem;
    }

    .passage p:last-child {
      margin-bottom: 0;
    }

    /* BLANK SPACES */
    .blank {
      display: inline-block;
      min-width: 120px;
      padding: 0.25rem 0.75rem;
      border-bottom: 2px solid var(--accent-soft);
      background: rgba(201, 169, 97, 0.1);
      border-radius: 0.25rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      color: var(--accent);
    }

    .blank:hover {
      background: rgba(201, 169, 97, 0.2);
      border-color: var(--accent);
    }

    .blank.filled {
      background: rgba(59, 130, 246, 0.15);
      border-color: #3b82f6;
      color: #93c5fd;
    }

    .blank.correct {
      background: rgba(16, 185, 129, 0.2);
      border-color: var(--correct);
      color: #6ee7b7;
    }

    .blank.incorrect {
      background: rgba(239, 68, 68, 0.2);
      border-color: var(--incorrect);
      color: #fca5a5;
    }

    /* HIGHLIGHT COLORS */
    .highlight-subject {
      background: rgba(59, 130, 246, 0.2);
      padding: 0.1rem 0.3rem;
      border-radius: 0.25rem;
      color: #93c5fd;
      font-weight: 600;
    }

    .highlight-pronoun {
      background: rgba(168, 85, 247, 0.2);
      padding: 0.1rem 0.3rem;
      border-radius: 0.25rem;
      color: #c4b5fd;
      font-weight: 600;
    }

    .highlight-repetition {
      background: rgba(239, 68, 68, 0.2);
      padding: 0.1rem 0.3rem;
      border-radius: 0.25rem;
      color: #fca5a5;
      text-decoration: line-through;
    }

    .highlight-substitute {
      background: rgba(16, 185, 129, 0.2);
      padding: 0.1rem 0.3rem;
      border-radius: 0.25rem;
      color: #6ee7b7;
      font-weight: 600;
    }

    /* OPTIONS PANEL */
    .options-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .option-card {
      padding: 0.75rem 1rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 0.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.85rem;
      font-weight: 600;
      color: #e5e7eb;
    }

    .option-card:hover:not(.used) {
      background: rgba(201, 169, 97, 0.15);
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .option-card.selected {
      background: rgba(59, 130, 246, 0.2);
      border-color: #3b82f6;
      color: #93c5fd;
    }

    .option-card.used {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* FEEDBACK BOX */
    .feedback {
      padding: 1rem 1.25rem;
      border-radius: 0.75rem;
      margin-top: 1rem;
      display: none;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .feedback.show {
      display: flex;
    }

    .feedback.correct {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #6ee7b7;
    }

    .feedback.incorrect {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .feedback-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    /* SCORE DISPLAY */
    .score-display {
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.75rem;
      margin-bottom: 1rem;
    }

    .score-item {
      text-align: center;
    }

    .score-label {
      font-size: 0.7rem;
      color: #8e8e93;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 0.25rem;
    }

    .score-value {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    /* LEGEND */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 0.75rem 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.75rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-box {
      width: 20px;
      height: 20px;
      border-radius: 0.25rem;
    }

    /* BOTTOM NAVIGATION */
    .bottom-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 0.5rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn {
      min-height: 2.5rem;
      padding: 0 1.25rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      color: #e5e5e7;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover:not(.btn-disabled) {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(201, 169, 97, 0.3);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0%, #fef9c3 100%);
      color: #111827;
      border-color: var(--accent);
      box-shadow: 0 3px 10px var(--accent-soft);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #d4b46e 0%, #fef9c3 100%);
      box-shadow: 0 4px 12px var(--accent-soft);
      transform: translateY(-2px);
    }

    .btn-disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* MOBILE */
    @media (max-width: 768px) {
      body {
        padding: 0.4rem;
        padding-top: 0.4rem;
      }

      .back-btn {
        top: 0.4rem;
        left: 0.4rem;
        padding: 0.3rem 0.5rem;
        font-size: 0.55rem;
      }

      .header {
        padding: 0.4rem 0.6rem;
        margin-bottom: 0.5rem;
      }

      .brand-logo {
        font-size: 1rem;
      }

      .brand-subtitle {
        font-size: 0.55rem;
      }

      .card {
        padding: 0.75rem;
      }

      .exercise-area {
        padding: 1rem;
        min-height: 350px;
      }

      .exercise-title {
        font-size: 0.95rem;
      }

      .exercise-instruction {
        font-size: 0.75rem;
      }

      .passage {
        font-size: 0.9rem;
        padding: 1rem;
      }

      .options-panel {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 0.5rem;
      }

      .option-card {
        padding: 0.6rem 0.75rem;
        font-size: 0.75rem;
      }

      .mode-selector {
        flex-wrap: wrap;
      }

      .mode-btn {
        font-size: 0.65rem;
        padding: 0.4rem 1rem;
      }

      .score-display {
        gap: 1rem;
        padding: 0.75rem;
      }

      .score-value {
        font-size: 1.25rem;
      }

      .btn {
        min-height: 2.25rem;
        font-size: 0.65rem;
        padding: 0 0.85rem;
      }
    }
  </style>
</head>
<body>

<button class="back-btn" onclick="window.location.href='../../../index.html?openModal=writing&submenu=sentence-structure'">
  <span>‚Üê</span>
  <span>Back</span>
</button>

<div class="container">
  <!-- HEADER -->
  <header class="header">
    <div class="brand-logo">INTUITY</div>
    <div class="brand-subtitle">Cohesion Tools</div>
  </header>

  <!-- MAIN CARD -->
  <main class="card">
    <!-- MODE SELECTOR -->
    <div class="mode-selector">
      <button class="mode-btn active" data-mode="reference" onclick="switchMode('reference')">
        üîó Pronoun Reference
      </button>
      <button class="mode-btn" data-mode="substitution" onclick="switchMode('substitution')">
        üîÑ Substitution
      </button>
      <button class="mode-btn" data-mode="linking" onclick="switchMode('linking')">
        ‚ö° Linking Words
      </button>
    </div>

    <!-- EXERCISE AREA -->
    <section class="exercise-area" id="exerciseArea">
      <!-- Content will be rendered here -->
    </section>

    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav" id="bottomNav">
      <!-- Buttons will be rendered here -->
    </div>
  </main>
</div>

<script>
// ==================== DATA ====================
const exercises = {
  reference: [
    {
      title: "Pronoun Reference - Technology",
      instruction: "Click each blank to select the correct pronoun. Make sure pronouns clearly refer to their antecedents.",
      passage: `<span class="highlight-subject">Digital cameras</span> have revolutionized photography. <span class="blank" data-answer="They" data-id="1"></span> allow photographers to see results instantly. <span class="blank" data-answer="This" data-id="2"></span> means mistakes can be corrected immediately. Modern <span class="highlight-subject">smartphones</span> now include powerful cameras, making <span class="blank" data-answer="them" data-id="3"></span> perfect for everyday photography. Professional photographers still prefer dedicated cameras because <span class="blank" data-answer="they" data-id="4"></span> offer better control and image quality.`,
      options: ["They", "This", "them", "they", "It", "These", "Those"],
      correctAnswers: {
        "1": "They",
        "2": "This",
        "3": "them",
        "4": "they"
      },
      explanation: "Pronouns must agree in number with their antecedents and clearly refer to the correct noun."
    },
    {
      title: "Pronoun Reference - Education",
      instruction: "Choose pronouns that maintain clear reference chains throughout the passage.",
      passage: `<span class="highlight-subject">Students</span> benefit from regular reading practice. <span class="blank" data-answer="It" data-id="1"></span> improves vocabulary and comprehension skills. When <span class="highlight-subject">teachers</span> assign reading homework, <span class="blank" data-answer="they" data-id="2"></span> should ensure the material matches ability levels. <span class="blank" data-answer="This" data-id="3"></span> prevents frustration and maintains motivation. The <span class="highlight-subject">school library</span> offers many books, but <span class="blank" data-answer="it" data-id="4"></span> needs more funding to update its collection.`,
      options: ["It", "they", "This", "it", "They", "These", "them"],
      correctAnswers: {
        "1": "It",
        "2": "they",
        "3": "This",
        "4": "it"
      },
      explanation: "Clear pronoun reference helps readers track ideas across sentences."
    }
  ],
  
  substitution: [
    {
      title: "Avoiding Repetition - Environment",
      instruction: "Replace repeated words with appropriate substitutes to improve text flow.",
      passage: `Many <span class="highlight-repetition">teenagers</span> are concerned about climate change. <span class="blank" data-answer="Young people" data-id="1"></span> often participate in environmental campaigns. Some <span class="highlight-repetition">teenagers</span> organize school protests, while other <span class="blank" data-answer="students" data-id="2"></span> focus on reducing their carbon footprint. <span class="blank" data-answer="These activists" data-id="3"></span> inspire adults to take environmental issues more seriously.`,
      options: ["Young people", "students", "These activists", "They", "The youth", "Learners"],
      correctAnswers: {
        "1": "Young people",
        "2": "students",
        "3": "These activists"
      },
      explanation: "Using varied vocabulary prevents repetition and makes writing more sophisticated."
    },
    {
      title: "Avoiding Repetition - Exercise",
      instruction: "Choose alternatives that maintain meaning while avoiding word repetition.",
      passage: `Regular <span class="highlight-repetition">exercise</span> improves physical health. <span class="blank" data-answer="Physical activity" data-id="1"></span> also benefits mental wellbeing. Many doctors recommend at least 30 minutes of <span class="highlight-repetition">exercise</span> daily. <span class="blank" data-answer="This routine" data-id="2"></span> can include walking, swimming, or cycling. When people maintain consistent <span class="highlight-repetition">exercise</span> habits, <span class="blank" data-answer="these practices" data-id="3"></span> become part of their lifestyle.`,
      options: ["Physical activity", "This routine", "these practices", "movement", "Training", "workouts"],
      correctAnswers: {
        "1": "Physical activity",
        "2": "This routine",
        "3": "these practices"
      },
      explanation: "Substitution creates lexical variety and demonstrates advanced vocabulary control."
    }
  ],
  
  linking: [
    {
      title: "Linking Words - Contrast",
      instruction: "Select appropriate linking words to show logical relationships between ideas.",
      passage: `Online shopping offers convenience and variety. <span class="blank" data-answer="However" data-id="1"></span>, many people still prefer physical stores. Traditional shopping allows customers to examine products directly. <span class="blank" data-answer="In contrast" data-id="2"></span>, online purchases require trust in product descriptions. Some retailers combine both approaches. <span class="blank" data-answer="For example" data-id="3"></span>, they offer online ordering with in-store pickup.`,
      options: ["However", "In contrast", "For example", "Therefore", "Similarly", "Moreover"],
      correctAnswers: {
        "1": "However",
        "2": "In contrast",
        "3": "For example"
      },
      explanation: "Linking words signal relationships: contrast (however), comparison (in contrast), and exemplification (for example)."
    },
    {
      title: "Linking Words - Cause & Effect",
      instruction: "Choose linkers that correctly express cause-effect relationships.",
      passage: `Many teenagers spend excessive time on social media. <span class="blank" data-answer="As a result" data-id="1"></span>, they sometimes neglect homework and sleep. Parents often set screen time limits. <span class="blank" data-answer="This" data-id="2"></span> helps establish healthier habits. Schools are also addressing the issue. <span class="blank" data-answer="For instance" data-id="3"></span>, some ban phones during lessons to improve concentration.`,
      options: ["As a result", "This", "For instance", "However", "Therefore", "Nevertheless"],
      correctAnswers: {
        "1": "As a result",
        "2": "This",
        "3": "For instance"
      },
      explanation: "Effective linking shows consequences (as a result), reference (this), and examples (for instance)."
    }
  ]
};

// ==================== STATE ====================
let currentMode = 'reference';
let currentExerciseIndex = 0;
let selectedOption = null;
let userAnswers = {};
let score = { correct: 0, total: 0 };

// ==================== FUNCTIONS ====================
function getCurrentExercise() {
  return exercises[currentMode][currentExerciseIndex];
}

function switchMode(mode) {
  currentMode = mode;
  currentExerciseIndex = 0;
  resetExercise();
  
  // Update mode buttons
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === mode);
  });
  
  render();
}

function resetExercise() {
  selectedOption = null;
  userAnswers = {};
  score = { correct: 0, total: 0 };
}

function selectOption(option) {
  selectedOption = option;
  
  // Update visual state of options
  document.querySelectorAll('.option-card').forEach(card => {
    card.classList.toggle('selected', card.textContent.trim() === option);
  });
}

function fillBlank(blankId) {
  if (!selectedOption) return;
  
  const exercise = getCurrentExercise();
  const correctAnswer = exercise.correctAnswers[blankId];
  
  // Store answer
  userAnswers[blankId] = selectedOption;
  
  // Update blank display
  const blankElement = document.querySelector(`[data-id="${blankId}"]`);
  blankElement.textContent = selectedOption;
  blankElement.classList.add('filled');
  
  // Mark option as used
  document.querySelectorAll('.option-card').forEach(card => {
    if (card.textContent.trim() === selectedOption) {
      card.classList.add('used');
    }
  });
  
  selectedOption = null;
  document.querySelectorAll('.option-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Check if all blanks filled
  const totalBlanks = Object.keys(exercise.correctAnswers).length;
  if (Object.keys(userAnswers).length === totalBlanks) {
    // Enable check button
    document.getElementById('checkBtn').classList.remove('btn-disabled');
  }
}

function checkAnswers() {
  const exercise = getCurrentExercise();
  let correct = 0;
  let total = Object.keys(exercise.correctAnswers).length;
  
  // Check each answer
  Object.keys(exercise.correctAnswers).forEach(blankId => {
    const userAnswer = userAnswers[blankId];
    const correctAnswer = exercise.correctAnswers[blankId];
    const blankElement = document.querySelector(`[data-id="${blankId}"]`);
    
    if (userAnswer === correctAnswer) {
      correct++;
      blankElement.classList.remove('filled', 'incorrect');
      blankElement.classList.add('correct');
    } else {
      blankElement.classList.remove('filled', 'correct');
      blankElement.classList.add('incorrect');
    }
  });
  
  score.correct = correct;
  score.total = total;
  
  // Show feedback
  const feedbackElement = document.getElementById('feedback');
  const isAllCorrect = correct === total;
  
  feedbackElement.className = `feedback show ${isAllCorrect ? 'correct' : 'incorrect'}`;
  feedbackElement.innerHTML = `
    <span class="feedback-icon">${isAllCorrect ? '‚úÖ' : '‚ö†Ô∏è'}</span>
    <div>
      ${isAllCorrect 
        ? `<strong>Perfect!</strong> You got all ${total} answers correct. ${exercise.explanation}` 
        : `You got ${correct} out of ${total} correct. ${exercise.explanation} Try again or move to the next exercise.`
      }
    </div>
  `;
  
  renderBottomNav();
}

function nextExercise() {
  const maxIndex = exercises[currentMode].length - 1;
  if (currentExerciseIndex < maxIndex) {
    currentExerciseIndex++;
  } else {
    currentExerciseIndex = 0;
  }
  
  resetExercise();
  render();
}

function renderExercise() {
  const exercise = getCurrentExercise();
  const area = document.getElementById('exerciseArea');
  
  let html = `
    <div class="exercise-title">${exercise.title}</div>
    <div class="exercise-instruction">${exercise.instruction}</div>
  `;
  
  // Add legend for reference mode
  if (currentMode === 'reference') {
    html += `
      <div class="legend">
        <div class="legend-item">
          <div class="legend-box highlight-subject"></div>
          <span>Antecedent (what pronoun refers to)</span>
        </div>
        <div class="legend-item">
          <div class="legend-box" style="background: rgba(168, 85, 247, 0.2);"></div>
          <span>Pronoun (refers back)</span>
        </div>
      </div>
    `;
  }
  
  if (currentMode === 'substitution') {
    html += `
      <div class="legend">
        <div class="legend-item">
          <div class="legend-box" style="background: rgba(239, 68, 68, 0.2);"></div>
          <span>Repetition (avoid this)</span>
        </div>
        <div class="legend-item">
          <div class="legend-box highlight-substitute"></div>
          <span>Substitution (better)</span>
        </div>
      </div>
    `;
  }
  
  // Passage
  html += `<div class="passage">${exercise.passage}</div>`;
  
  // Options
  html += `<div class="options-panel">`;
  exercise.options.forEach(option => {
    const isUsed = Object.values(userAnswers).includes(option);
    html += `
      <div class="option-card ${isUsed ? 'used' : ''}" onclick="selectOption('${option}')">
        ${option}
      </div>
    `;
  });
  html += `</div>`;
  
  // Score display if checked
  if (score.total > 0) {
    html += `
      <div class="score-display">
        <div class="score-item">
          <div class="score-label">Correct</div>
          <div class="score-value">${score.correct}</div>
        </div>
        <div class="score-item">
          <div class="score-label">Total</div>
          <div class="score-value">${score.total}</div>
        </div>
        <div class="score-item">
          <div class="score-label">Score</div>
          <div class="score-value">${Math.round((score.correct / score.total) * 100)}%</div>
        </div>
      </div>
    `;
  }
  
  // Feedback area
  html += `<div class="feedback" id="feedback"></div>`;
  
  area.innerHTML = html;
  
  // Attach click handlers to blanks
  document.querySelectorAll('.blank').forEach(blank => {
    blank.addEventListener('click', () => {
      const blankId = blank.dataset.id;
      if (!userAnswers[blankId] && selectedOption) {
        fillBlank(blankId);
      }
    });
  });
}

function renderBottomNav() {
  const nav = document.getElementById('bottomNav');
  const exercise = getCurrentExercise();
  const totalBlanks = Object.keys(exercise.correctAnswers).length;
  const allFilled = Object.keys(userAnswers).length === totalBlanks;
  const hasChecked = score.total > 0;
  
  nav.innerHTML = `
    <button class="btn ${!allFilled || hasChecked ? 'btn-disabled' : ''}" id="checkBtn" onclick="checkAnswers()">
      <span>‚úì</span>
      <span>Check Answers</span>
    </button>
    
    <button class="btn" onclick="resetExercise(); render()">
      <span>üîÑ</span>
      <span>Reset</span>
    </button>
    
    <button class="btn btn-primary" onclick="nextExercise()">
      <span>‚Üí</span>
      <span>Next Exercise</span>
    </button>
  `;
}

function render() {
  renderExercise();
  renderBottomNav();
}

// ==================== INITIALIZE ====================
render();
</script>
</body>
</html>
